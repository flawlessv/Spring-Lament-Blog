---
created: 2025-10-22T19:47:28 (UTC +08:00)
tags:
  [
    NestJS,
    å‰ç«¯,
    åç«¯ä¸­æ–‡æŠ€æœ¯ç¤¾åŒº,
    å‰ç«¯å¼€å‘ç¤¾åŒº,
    å‰ç«¯æŠ€æœ¯äº¤æµ,
    å‰ç«¯æ¡†æ¶æ•™ç¨‹,
    JavaScript å­¦ä¹ èµ„æº,
    CSS æŠ€å·§ä¸æœ€ä½³å®è·µ,
    HTML5 æœ€æ–°åŠ¨æ€,
    å‰ç«¯å·¥ç¨‹å¸ˆèŒä¸šå‘å±•,
    å¼€æºå‰ç«¯é¡¹ç›®,
    å‰ç«¯æŠ€æœ¯è¶‹åŠ¿,
  ]
source: https://juejin.cn/post/7407260232664186930
author: è èçš„èœœ
---

# NestJS ğŸ§‘ğŸ³Â  å¨å­å¿…ä¿®è¯¾ï¼ˆä¸€ï¼‰ï¼šåç«¯çš„æœ¬è´¨NestJS ğŸ§‘ğŸ³ å¨å­å¿…ä¿®ç¬¬ä¸€è¯¾ï¼ˆåç«¯çš„æœ¬è´¨ï¼‰ã€‚å¦‚æœå‰ç«¯ - æ˜é‡‘

> ## Excerpt
>
> NestJS ğŸ§‘ğŸ³ å¨å­å¿…ä¿®ç¬¬ä¸€è¯¾ï¼ˆåç«¯çš„æœ¬è´¨ï¼‰ã€‚å¦‚æœå‰ç«¯æ˜¯ç›˜ä¸æ´ï¼Œé‚£ä¹ˆåç«¯å°±æ˜¯åœ°åŸºï¼Œç¨³å›ºå¯é çš„çŸ³å£æ‰èƒ½æ‰¿è½½ç»šçƒ‚å¤šå½©çš„æ•¦ç…Œå£ç”»ã€‚---

## theme: fancy

1.  å‰è¨€

å‰æ®µæ—¶é—´çœ‹å®Œé©¬ä¼¯åº¸çš„ã€Šé£Ÿå—ä¹‹å¿—ã€‹ï¼Œå°±æƒ³è¦åšä¸€ä¸ªå¨å­ã€‚ä¸€ä¸ªå¥½å¨å­ä¸èƒ½åªä¼šç«¯èœï¼Œæ›´è¦ä¼šåšèœï¼Œäºæ˜¯å°±æœ‰æ­¤ç³»åˆ—â€”â€”NestJS å¨å­å¿…

---

## 1\. å‰è¨€

å‰æ®µæ—¶é—´çœ‹å®Œé©¬ä¼¯åº¸çš„ã€Šé£Ÿå—ä¹‹å¿—ã€‹ï¼Œå°±æƒ³è¦åšä¸€ä¸ªå¨å­ã€‚ä¸€ä¸ªå¥½å¨å­ä¸èƒ½åªä¼šç«¯èœï¼Œæ›´è¦ä¼šåšèœï¼Œäºæ˜¯å°±æœ‰æ­¤ç³»åˆ—â€”â€”NestJS å¨å­å¿…ä¿®è¯¾ã€‚

è¿™ä¸€ç¯‡ï¼Œç¬”è€…å¹¶ä¸æ‰“ç®—è®²å®é™…çš„ä»£ç å¼€å‘ï¼Œè€Œæ˜¯ç”±ç”Ÿæ´»ä¸­çš„å®é™…åœºæ™¯æ¥ç†è§£åç«¯å¼€å‘è¿‡ç¨‹ï¼Œè½¬å˜å‰ç«¯å›ºæœ‰æ€ç»´ï¼Œå…ˆè§‚å¯Ÿå…¨å±€ï¼Œç„¶ååœ¨æ­¤åŸºç¡€ä¸Šè¿›å…¥ç»†èŠ‚ã€‚

æ•´ä¸ªç³»åˆ—æš‚æ—¶è§„åˆ’å¦‚ä¸‹ï¼š

1.  åç«¯çš„æœ¬è´¨
2.  æå®š CRUD
3.  æå®šæ•°æ®åº“ï¼ˆPrisma + å…±äº«æ¨¡å—ï¼‰
4.  æå®šç™»å½•æ³¨å†Œï¼ˆAuth æ¨¡å— + JWT + è·¯ç”±å®ˆå«ï¼‰
5.  æå®š API æ–‡æ¡£ï¼ˆSwaggerï¼‰
6.  æå®š API éƒ¨ç½²ï¼ˆå¤šç¯å¢ƒ + docker-composeï¼‰

ç¬”è€…è§‰å¾—å¦‚æœä½ ä¸æƒ³å˜æˆâ€œbug è·¯ç”±å™¨â€ï¼Œä¸æƒ³å¬é‚£äº›ä¸ä¸“ä¸šçš„æŠ€æœ¯äººå‘˜é¬¼æ‰¯ ğŸ‘»ï¼Œå…³æ³¨ä¸“æ å°±å¯¹äº†ã€‚

å¦‚æœå‰ç«¯å¯ä»¥æ¯”å–»ä¸ºé”™ç»¼å¤æ‚çš„ç›˜ä¸æ´ï¼Œå……æ»¡äº†å„ç§ç”¨æˆ·ç•Œé¢å’Œäº¤äº’ç»†èŠ‚ï¼Œé‚£ä¹ˆåç«¯åˆ™å¯ä»¥æ¯”ä½œæ˜¯ç¨³å›ºçš„åœ°åŸºæˆ–æ”¯æ’‘ç»“æ„ã€‚åç«¯æ˜¯åº”ç”¨ç¨‹åºçš„æœåŠ¡å™¨ç«¯ï¼Œè´Ÿè´£å¤„ç†ä¸šåŠ¡é€»è¾‘ã€æ•°æ®åº“ç®¡ç†ã€æœåŠ¡å™¨é€šä¿¡ç­‰ï¼Œæ˜¯æ•´ä¸ªåº”ç”¨æ¶æ„çš„æ”¯æ’‘ï¼Œç¡®ä¿å‰ç«¯èƒ½å¤Ÿç¨³å®šè¿è¡Œã€‚å°±åƒå»ºç­‘çš„åœ°åŸºä¸€æ ·ï¼Œåç«¯éœ€è¦ç¨³å›ºå¯é ï¼Œä»¥æ”¯æ’‘å‰ç«¯çš„å¤æ‚å¤šå˜ã€‚

![æ•¦ç…Œé£å¤©å£ç”».png](https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f9ae672926f1489cb8fedbf2ebd19b58~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I-g6JCd55qE6Jyc:q75.awebp?rk3s=f64ab15b&x-expires=1761660480&x-signature=jwgf7cJMwGEiMPDLAgusWSwIIYA%3D)

![æ‚¬ç©ºå¯º.png](https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1d6b05e0a3bf47ceb5d85f2491d91281~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I-g6JCd55qE6Jyc:q75.awebp?rk3s=f64ab15b&x-expires=1761660480&x-signature=QVrGGBzcGmVqbNX8Xq6%2FDdQNg%2BU%3D)

æ¬¢è¿åŠ å…¥[æŠ€æœ¯äº¤æµç¾¤](https://juejin.cn/user/2154698521972423/pins "https://juejin.cn/user/2154698521972423/pins")ã€‚

![image.png](https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dd5e4b8be907402d9d882517ff6a0e0c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I-g6JCd55qE6Jyc:q75.awebp?rk3s=f64ab15b&x-expires=1761660480&x-signature=5H%2F6Qlln7R4ZpvGzQbhEbHcgiSA%3D)

1.  [NestJS ğŸ§‘ğŸ³Â  å¨å­å¿…ä¿®è¯¾ï¼ˆä¸€ï¼‰ï¼šåç«¯çš„æœ¬è´¨](https://juejin.cn/post/7407260232664186930 "https://juejin.cn/post/7407260232664186930")
2.  [NestJS ğŸ§‘ğŸ³Â å¨å­å¿…ä¿®è¯¾ï¼ˆäºŒï¼‰ï¼šé¡¹ç›®åˆ›å»º](https://juejin.cn/post/7408021285768445961 "https://juejin.cn/post/7408021285768445961")
3.  [NestJS ğŸ§‘ğŸ³Â å¨å­å¿…ä¿®è¯¾ï¼ˆä¸‰ï¼‰ï¼šæ§åˆ¶å™¨](https://juejin.cn/post/7408778862283096102 "https://juejin.cn/post/7408778862283096102")
4.  [NestJS ğŸ§‘ğŸ³Â å¨å­å¿…ä¿®è¯¾ï¼ˆå››ï¼‰ï¼šæœåŠ¡ç±»](https://juejin.cn/post/7416235834938212403 "https://juejin.cn/post/7416235834938212403")
5.  [NestJS ğŸ§‘ğŸ³Â å¨å­å¿…ä¿®è¯¾ï¼ˆäº”ï¼‰ï¼šPrisma é›†æˆï¼ˆä¸Šï¼‰](https://juejin.cn/post/7416908856868110374 "https://juejin.cn/post/7416908856868110374")
6.  [NestJS ğŸ§‘ğŸ³Â å¨å­å¿…ä¿®è¯¾ï¼ˆå…­ï¼‰ï¼šPrisma é›†æˆï¼ˆä¸‹ï¼‰](https://juejin.cn/post/7418460243502792731 "https://juejin.cn/post/7418460243502792731")
7.  [NestJS ğŸ§‘ğŸ³Â å¨å­å¿…ä¿®è¯¾ï¼ˆä¸ƒï¼‰ï¼šç®¡é“](https://juejin.cn/post/7419887372463554601 "https://juejin.cn/post/7419887372463554601")
8.  [NestJS ğŸ§‘ğŸ³Â å¨å­å¿…ä¿®è¯¾ï¼ˆå…«ï¼‰ï¼šå¼‚å¸¸è¿‡æ»¤å™¨](https://juejin.cn/post/7420272008146239514 "https://juejin.cn/post/7420272008146239514")

åœ¨å¼€å§‹ä¹‹å‰ï¼Œè¦è®²æ¸…æ¥šçš„æ˜¯ CRUD ç©¶ç«Ÿæ˜¯ä»€ä¹ˆï¼Ÿæ‰€æœ‰ä¹¦ä¸Šéƒ½ä¼šè¯´ï¼š

- Cï¼šcreate åˆ›å»ºï¼ˆå¢ï¼‰
- Rï¼šread è¯»å–ï¼ˆæŸ¥ï¼‰
- Uï¼šupdate æ›´æ–°ï¼ˆæ”¹ï¼‰
- Dï¼šdelete åˆ é™¤ï¼ˆåˆ ï¼‰

## 2\. ç†è§£è´¦æˆ¿è®°å½•

è®©æ—¶é—´å›åˆ°å¤ä»£ï¼Œæˆ‘ä»¬æ¥åˆ°ä¸€é—´è´¦æˆ¿ï¼Œè´¦æˆ¿å…ˆç”Ÿæ­£æŠ“è€³æŒ è…®ï¼Œè´¦æœ¬å¡äº†æ»¡æ»¡ä¸€å±‹å­ã€‚

è´¦æœ¬æ˜¾ç„¶ç”¨äºè®°å½•å•†å®¶å¾€æ¥çš„äº¤æ˜“ï¼Œä¸Šé¢è®°å½•ç€å®¢äººä»¬å„è‡ªåœ¨ä»€ä¹ˆæ—¶å€™è´­ä¹°äº†ä»€ä¹ˆä¸œè¥¿ã€åˆä¹°äº†å¤šå°‘ã€æ€»å…±å‡ é’±ç­‰ç­‰ã€‚

### 2.1 å…¥è´¦

æ¯æ¬¡æˆäº¤ä¸€ç¬”è®°å½•æ—¶ï¼Œè´¦æˆ¿å…ˆç”Ÿæ€»ä¼šåœ¨è´¦æœ¬ä¸Šè®°å½•ä¸€ç¬”ï¼š

- å´æ‰¿æ©ã€Šé»‘ç¥è¯ï¼šæ‚Ÿç©ºã€‹æ ‡å‡†ç‰ˆ x 1 Â¥268 PC 2024.8.19
- ç‰çš‡å¤§å¸ ã€Šé»‘ç¥è¯ï¼šæ‚Ÿç©ºã€‹è±ªåç‰ˆ x 1 Â¥328 PC 2024.8.20

è¿™å°±æ˜¯å…¥è´¦ï¼Œåˆ›å»ºæ–°çš„äº¤æ˜“è®°å½•ï¼Œå¯¹åº”çš„æ˜¯ Cï¼Œcreateï¼Œåˆ›å»ºã€æ–°å¢ã€‚

### 2.2 æŸ¥è´¦

ä¸€ä¸ªæœˆè¿‡å»äº†ï¼ŒæŒæŸœçš„èµšå¾—é‡‘æ»¡é’µæ»¡ï¼Œè´¦æœ¬è®°å¾—åˆæ˜¯å¯†å¯†éº»éº»ï¼Œè¿™æ—¶å€™æŒæŸœçš„å°±è¦è®©ä¸»ç°¿æ ¡å¯¹è´¦æœ¬è®°å½•ï¼Œä»–æ‰“å¼€è´¦æœ¬ä¸€çœ‹ï¼Œä¾¿ä¸€ç›®äº†ç„¶ï¼Œè¿™å°±æ˜¯æŸ¥è´¦ï¼Œå°±æ˜¯ Rï¼Œreadï¼Œè¯»å–ã€æŸ¥æ‰¾ã€‚

ä»”ç»†çœ‹ï¼Œå…¶å®è´¦æœ¬å°±æ˜¯ä¸€ä¸ª excel è¡¨æ ¼ï¼š

| id  | å§“å     | åç§°               | ç‰ˆæœ¬   | æ•°é‡ | å•ä»· | æ€»ä»· | åˆ›å»ºæ—¶é—´  | æ›´æ–°æ—¶é—´  |
| --- | -------- | ------------------ | ------ | ---- | ---- | ---- | --------- | --------- |
| 1   | å´æ‰¿æ©   | ã€Šé»‘ç¥è¯ï¼šæ‚Ÿç©ºã€‹   | æ ‡å‡†ç‰ˆ | 1    | 268  | 268  | 2024.8.19 | 2024.8.19 |
| 2   | ç‰çš‡å¤§å¸ | ã€Šé»‘ç¥è¯ï¼šæ‚Ÿç©ºã€‹   | è±ªåç‰ˆ | 1    | 328  | 328  | 2024.8.20 | 2024.8.20 |
| 3   | å§¬å‘     | ã€Šé»‘ç¥è¯ï¼šå§œå­ç‰™ã€‹ | è±ªåç‰ˆ | 2    | 328  | 652  | 2030.8.21 | 2030.8.21 |

### 2.3 ä¿®è´¦

æœ‰æ—¶å€™è´¦æœ¬è®°å½•æœ‰è¯¯ï¼Œå°±è¦é‡æ–°è®°å½•ï¼Œæˆ–æ˜¯åˆ’æ‰åŸæ¥çš„é”™è¯¯æ”¹æ­£ï¼Œè¿™å°±æ˜¯ Uï¼Œupdateï¼Œæ›´æ–°ã€ç¼–è¾‘ã€ä¿®æ”¹ã€‚å¦‚ä¸‹æ–¹ id ä¸º 2 çš„è®°å½•ï¼š

| id  | å§“å     | åç§°               | ç‰ˆæœ¬   | æ•°é‡ | å•ä»· | æ€»ä»· | åˆ›å»ºæ—¶é—´  | æ›´æ–°æ—¶é—´  |
| --- | -------- | ------------------ | ------ | ---- | ---- | ---- | --------- | --------- |
| 1   | å´æ‰¿æ©   | ã€Šé»‘ç¥è¯ï¼šæ‚Ÿç©ºã€‹   | æ ‡å‡†ç‰ˆ | 1    | 268  | 268  | 2024.8.19 | 2024.8.19 |
| 2   | ç‰çš‡å¤§å¸ | ã€Šé»‘ç¥è¯ï¼šæ‚Ÿç©ºã€‹   | è±ªåç‰ˆ | 2    | 328  | 652  | 2024.8.20 | 2024.8.25 |
| 3   | å§¬å‘     | ã€Šé»‘ç¥è¯ï¼šå§œå­ç‰™ã€‹ | è±ªåç‰ˆ | 2    | 328  | 652  | 2030.8.21 | 2030.8.21 |

### 2.4 åˆ è´¦

å¶å°”ç¿»åˆ°ä¸€æ¡è®°å½•è¢«åˆ’æ‰ï¼Œè¿™å°±æ˜¯ Dï¼Œdeleteï¼Œåˆ é™¤ã€‚å¦‚ã€Šé»‘ç¥è¯ï¼šå§œå­ç‰™ã€‹è¿˜æ²¡æœ‰å‘å¸ƒï¼Œè¿™æ¡è®°å½•åº”è¯¥è¢«åˆ æ‰ï¼š

| id  | å§“å     | åç§°             | ç‰ˆæœ¬   | æ•°é‡ | å•ä»· | æ€»ä»· | åˆ›å»ºæ—¶é—´  | æ›´æ–°æ—¶é—´  |
| --- | -------- | ---------------- | ------ | ---- | ---- | ---- | --------- | --------- |
| 1   | å´æ‰¿æ©   | ã€Šé»‘ç¥è¯ï¼šæ‚Ÿç©ºã€‹ | æ ‡å‡†ç‰ˆ | 1    | 268  | 268  | 2024.8.19 | 2024.8.19 |
| 2   | ç‰çš‡å¤§å¸ | ã€Šé»‘ç¥è¯ï¼šæ‚Ÿç©ºã€‹ | è±ªåç‰ˆ | 2    | 328  | 652  | 2024.8.20 | 2024.8.21 |

ä»¥ä¸Šï¼Œè¿™äº›è®°å½•æ’å¸ƒåœ¨ä¸€èµ·å°±å½¢æˆäº†ä¸€å¼ è´¦å•ï¼Œæœ‰è”ç³»çš„è´¦å•ä¹‹é—´å°†ä¼šå»ºç«‹ç´¢å¼•ï¼Œæ€»ä¹‹ï¼Œè´¦å•èšé›†åœ¨ä¸€èµ·å°±å˜æˆäº†è´¦æœ¬ï¼Œè¿™é—´å †æ»¡è´¦æœ¬çš„å±‹å­å°±æ˜¯è´¦æˆ¿ã€‚æ€»ç»“ä¸€ä¸‹ï¼Œè´¦å•ç›¸å½“äºæ•°æ®åº“ä¸­çš„æ•°æ®è¡¨ï¼Œè´¦æœ¬å¯¹åº”ä¸åŒç¯å¢ƒä¸‹çš„æ•°æ®åº“ï¼Œè€Œè´¦æˆ¿æ˜¯ä¸åŒçš„æ•°æ®åº“ç³»ç»Ÿã€‚

## 3\. æ€»ç»“

å›åˆ°å½“ä¸‹ï¼Œåœ¨ç”¨æˆ·æ‰“å¼€æµè§ˆå™¨é¡µé¢çœ‹åˆ°è‡ªå·±çš„è®¢å•è®°å½•æ—¶ï¼Œå®é™…ä¸Šæ˜¯é€šè¿‡ HTTP åè®®å‘èµ·è¯·æ±‚ï¼ŒæœåŠ¡å™¨æ ¹æ®å½“å‰è·¯ç”±çš„åŒ¹é…è§„æ‰¾åˆ°å¯¹åº”çš„æ§åˆ¶å™¨ï¼Œä»è€Œæ‰§è¡Œä¸€ä¸ªæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•ä¼šå¯¹æ•°æ®åº“åš CRUD çš„æŸç§æ“ä½œï¼Œæœ€åç”±æœåŠ¡å™¨å“åº”ç»™å‰ç«¯ï¼Œå‰ç«¯æµè§ˆå™¨å®Œæˆæ¸²æŸ“ï¼Œç”¨æˆ·å°±çœ‹åˆ°äº†æ–°çš„ç•Œé¢ã€‚

![å‰åç«¯é€»è¾‘å¤„ç†.png](https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/72c88fa135844bdcb2965dbd8f92689c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I-g6JCd55qE6Jyc:q75.awebp?rk3s=f64ab15b&x-expires=1761660480&x-signature=JA6QJnWg4DWMPh9y7a4Z28t92fk%3D)

æ‰€ä»¥ï¼Œæœ¬è´¨ä¸Šæ•´ä¸ªä¸šåŠ¡æµç¨‹å°±æ˜¯ä¸€ä¸ªè´¦æœ¬ç®¡ç†çš„è¿‡ç¨‹ã€‚è¯´èµ·æ¥ï¼Œç°ä»£çš„è´¦æˆ¿å…ˆç”Ÿå¯æ¯”å¤æ—¶å€™è½»æ¾å¾ˆå¤šäº†ã€‚ä¸‹ä¸€èŠ‚å°†ä¼šè¿›å…¥åˆ°å®é™…çš„ä»£ç å¼€å‘ä¸­ï¼Œçœ‹çœ‹å¦‚ä½•åˆ›å»ºä¸€ä¸ªé¡¹ç›®ã€‚

---

created: 2025-10-22T19:47:36 (UTC +08:00)
tags: [NestJS,å‰ç«¯,åç«¯ä¸­æ–‡æŠ€æœ¯ç¤¾åŒº,å‰ç«¯å¼€å‘ç¤¾åŒº,å‰ç«¯æŠ€æœ¯äº¤æµ,å‰ç«¯æ¡†æ¶æ•™ç¨‹,JavaScript å­¦ä¹ èµ„æº,CSS æŠ€å·§ä¸æœ€ä½³å®è·µ,HTML5 æœ€æ–°åŠ¨æ€,å‰ç«¯å·¥ç¨‹å¸ˆèŒä¸šå‘å±•,å¼€æºå‰ç«¯é¡¹ç›®,å‰ç«¯æŠ€æœ¯è¶‹åŠ¿]
source: https://juejin.cn/post/7408021285768445961
author: è èçš„èœœ

---

# NestJS ğŸ§‘ğŸ³Â å¨å­å¿…ä¿®è¯¾ï¼ˆäºŒï¼‰ï¼šé¡¹ç›®åˆ›å»ºNestJS ğŸ§‘ğŸ³ å¨å­å¿…ä¿®ç¬¬äºŒè¯¾ï¼ˆé¡¹ç›®åˆ›å»ºï¼‰ã€‚ä»¥æ­¦æ—å¤–ä¼ çš„æ•… - æ˜é‡‘

> ## Excerpt
>
> NestJS ğŸ§‘ğŸ³ å¨å­å¿…ä¿®ç¬¬äºŒè¯¾ï¼ˆé¡¹ç›®åˆ›å»ºï¼‰ã€‚ä»¥æ­¦æ—å¤–ä¼ çš„æ•…äº‹ä¸²è”èµ·æ•´ä¸ªä¸šåŠ¡æµç¨‹ï¼Œä»‹ç»äº†å¦‚ä½•ä½¿ç”¨ NestJS å»åˆ›å»ºå’Œæ„å»ºå¹¶è¿è¡Œä¸€ä¸ªé¡¹ç›®ï¼Œä»¥åŠ NestJS ä¸­çš„ src æ–‡ä»¶æ„æˆã€‚---

## theme: fancy

1.  å‰è¨€

ä¸Šç¯‡ä»¥è´¦æˆ¿ä¸ºä¾‹è§£é‡Šäº†åç«¯çš„æœ¬è´¨ï¼Œç°åœ¨è¿›å…¥åˆ°ä»£ç éƒ¨åˆ†ï¼Œçœ‹çœ‹å¦‚ä½•ä½¿ç”¨ N

---

## 1\. å‰è¨€

ä¸Šç¯‡ä»¥è´¦æˆ¿ä¸ºä¾‹è§£é‡Šäº†åç«¯çš„æœ¬è´¨ï¼Œç°åœ¨è¿›å…¥åˆ°ä»£ç éƒ¨åˆ†ï¼Œçœ‹çœ‹å¦‚ä½•ä½¿ç”¨ NestJS åˆ›å»ºä¸€ä¸ªé¡¹ç›®ã€‚

å…ˆæ¥çœ‹ä¸ªå°æ•…äº‹ï¼Œä»æ„Ÿæ€§è§’åº¦ç»§ç»­ç†è§£æµç¨‹ï¼š

æœ‰ä¸€å¤©ï¼Œé‚¢æ•å¤´æ¥åŒç¦å®¢æ ˆåƒé¥­ï¼Œçœ‹äº†çœ‹èœå•ï¼Œæƒ³è¦ç‚¹ä¸ªé±¼é¦™è‚‰ä¸ã€‚ä½ŸæŒæŸœå°±å»å®‰æ’ä¸‹å»äº†ï¼Œç™½å±•å ‚æŠŠæ¶ˆæ¯å‘Šè¯‰äº†æå¤§å˜´ï¼Œå¤§å˜´çœ‹äº†çœ‹é£Ÿæåº“å­˜è¿˜å¤Ÿï¼Œå°±å¼€å§‹å¿™æ´»äº†ï¼Œè¿™è¾¹åˆ€åŠŸé£å¿«ï¼Œåˆæ˜¯çƒ­é”…å†·æ²¹â€¦â€¦åªå¬å‘²å•¦å‘²å•¦ï¼Œç‰‡åˆ»ä¹‹é—´ï¼Œç™½å±•å ‚å°±æŠŠèœç«¯äº†ä¸Šæ¥ï¼Œè¿™å¾€æ¡Œä¸Šä¸€æ‘†ï¼Œé‚¢æ•å¤´æ‹¿èµ·ç­·å­å°±å¤§å£åƒäº†èµ·æ¥ã€‚é¡·é—´ï¼Œå•ç§€æ‰å·²ç»åšå¥½äº†è´¦é¢è®°å½•ï¼Œéšåæ’•äº†ä¸€å¼ ç¥¨æ®ç»™è€é‚¢ã€‚

è®°ä½è¿™ä¸ªæ•…äº‹ï¼Œå¾€ä¸‹çœ‹ï¼š

- åŒç¦å®¢æ ˆçš„èœå•å°±æ˜¯å„è·¯ç”±
- é±¼é¦™è‚‰ä¸å°±æ˜¯æŸä¸€ä¸ªè·¯ç”±
- å½“é‚¢æ•å¤´ç‚¹äº†é±¼é¦™è‚‰ä¸å°±æ˜¯å‘é€äº†ä¸€ä¸ª HTTP è¯·æ±‚
- ä½ŸæŒæŸœçš„å®‰æ’ï¼ˆè‡ªç„¶çŸ¥é“è¦å»æ‰¾è°ï¼šè®©è€ç™½å»å¨æˆ¿æ‰¾å¤§å˜´ï¼‰å°±æ˜¯ Controllerï¼ˆæ§åˆ¶å™¨ï¼Œæ¥æ”¶å’Œå¤„ç†è¯·æ±‚ï¼‰
- çœŸæ­£æ‡‚ç‚’èœä¸šåŠ¡çš„æ˜¯å¤§å˜´ï¼Œç‚’èœä¸šåŠ¡æœ¬èº«å°±æ˜¯ Serviceï¼ˆä¸šåŠ¡é€»è¾‘å±‚ï¼‰ï¼Œæ£€æŸ¥é£Ÿæåº“å­˜å®é™…ä¸Šå°±åœ¨å’Œæ•°æ®åº“äº¤äº’
- é¤æ¡Œä¸Šæœ‰åœ°æ–¹æ”¾ç­·å­ã€æœ‰åœ°æ–¹æ”¾é†‹ç¢Ÿï¼Œé‚¢æ•å¤´ä½å¤´çš„ä½ç½®å°±æ˜¯æ”¾ç¢—çš„ï¼Œè¿™å°±æ˜¯ Viewï¼ˆè§†å›¾æ¨¡ç‰ˆï¼‰
- ç‚’å®Œèœï¼Œé‚¢æ•å¤´çœ‹åˆ°ç¢—é‡Œçš„é±¼é¦™è‚‰ä¸ï¼Œï¼ˆæœ¬æ¥ç¢—é‡Œæ²¡æœ‰é±¼é¦™è‚‰ä¸åˆ°æœ‰é±¼é¦™è‚‰ä¸ï¼‰å°±æ˜¯æµè§ˆå™¨æ¸²æŸ“é¡µé¢ï¼ŒæŠŠè¯·æ±‚çš„æ•°æ®æ¸²æŸ“äº†å‡ºæ¥

å¦‚æœä» Bç«¯ã€Cç«¯è§’åº¦ï¼š

- ä½ŸæŒæŸœæ‹¿å‡ºèœå•ç»™è€é‚¢ï¼Œè€é‚¢ç‚¹èœï¼ˆC ç«¯ï¼‰
- ç‚’èœå½“ç„¶è¦æ£€æŸ¥é£Ÿæåº“å­˜ï¼Œæ‰€ä»¥å¯¹äºå¤§å˜´æ¥è¯´å¨æˆ¿çš„åº“å­˜å°±æ˜¯ä¸€æœ¬è´¦æœ¬ï¼ˆB ç«¯ï¼‰
- ç‚’å®Œäº†ç«¯å‡ºæ¥ï¼Œç§€æ‰å°±çŸ¥é“è¿™å•æˆäº†ï¼Œæˆäº¤è®°å½• +1ï¼ˆB ç«¯ï¼‰
- é‚¢æ•å¤´é«˜é«˜å…´å…´æ‹¿ç€ç¥¨æ®å›è¡™é—¨æŠ¥é”€ï¼ˆC ç«¯ï¼‰

æ¬¢è¿åŠ å…¥[æŠ€æœ¯äº¤æµç¾¤](https://juejin.cn/user/2154698521972423/pins "https://juejin.cn/user/2154698521972423/pins")ã€‚

![image.png](https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dd5e4b8be907402d9d882517ff6a0e0c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I-g6JCd55qE6Jyc:q75.awebp?rk3s=f64ab15b&x-expires=1761694509&x-signature=YEJ0yCiJAE3ycPeJRk3Gg0m2vM4%3D)

1.  [NestJS ğŸ§‘ğŸ³Â  å¨å­å¿…ä¿®è¯¾ï¼ˆä¸€ï¼‰ï¼šåç«¯çš„æœ¬è´¨](https://juejin.cn/post/7407260232664186930 "https://juejin.cn/post/7407260232664186930")
2.  [NestJS ğŸ§‘ğŸ³Â å¨å­å¿…ä¿®è¯¾ï¼ˆäºŒï¼‰ï¼šé¡¹ç›®åˆ›å»º](https://juejin.cn/post/7408021285768445961 "https://juejin.cn/post/7408021285768445961")
3.  [NestJS ğŸ§‘ğŸ³Â å¨å­å¿…ä¿®è¯¾ï¼ˆä¸‰ï¼‰ï¼šæ§åˆ¶å™¨](https://juejin.cn/post/7408778862283096102 "https://juejin.cn/post/7408778862283096102")
4.  [NestJS ğŸ§‘ğŸ³Â å¨å­å¿…ä¿®è¯¾ï¼ˆå››ï¼‰ï¼šæœåŠ¡ç±»](https://juejin.cn/post/7416235834938212403 "https://juejin.cn/post/7416235834938212403")
5.  [NestJS ğŸ§‘ğŸ³Â å¨å­å¿…ä¿®è¯¾ï¼ˆäº”ï¼‰ï¼šPrisma é›†æˆï¼ˆä¸Šï¼‰](https://juejin.cn/post/7416908856868110374 "https://juejin.cn/post/7416908856868110374")
6.  [NestJS ğŸ§‘ğŸ³Â å¨å­å¿…ä¿®è¯¾ï¼ˆå…­ï¼‰ï¼šPrisma é›†æˆï¼ˆä¸‹ï¼‰](https://juejin.cn/post/7418460243502792731 "https://juejin.cn/post/7418460243502792731")
7.  [NestJS ğŸ§‘ğŸ³Â å¨å­å¿…ä¿®è¯¾ï¼ˆä¸ƒï¼‰ï¼šç®¡é“](https://juejin.cn/post/7419887372463554601 "https://juejin.cn/post/7419887372463554601")
8.  [NestJS ğŸ§‘ğŸ³Â å¨å­å¿…ä¿®è¯¾ï¼ˆå…«ï¼‰ï¼šå¼‚å¸¸è¿‡æ»¤å™¨](https://juejin.cn/post/7420272008146239514 "https://juejin.cn/post/7420272008146239514")

## 2\. åˆ›å»ºé¡¹ç›®

ç°åœ¨ä½¿ç”¨ Nest åˆ›å»ºä¸€ä¸ªé¡¹ç›®ã€‚

### 2.1 å®‰è£…

```ruby
$ npm i -g @nestjs/cli
```

### 2.2 åˆå§‹åŒ–é¡¹ç›®

```cpp
# $ nest new [name]
$ nest new cook-api-1
```

cook-api-1 å°±æ˜¯è¿™ä¸ª Nest é¡¹ç›®çš„åå­—ï¼Œéšä¾¿èµ·ã€‚

### 2.3 å¯åŠ¨é¡¹ç›®

```shell
$ cd cook-api-1
$ npm install
$ npm run start:dev
```

è®¿é—® [http://localhost:3000/](https://link.juejin.cn/?target=http%3A%2F%2Flocalhost%3A3000%2F "http://localhost:3000/") å¯ä»¥çœ‹åˆ° Hello World! çš„ç”»é¢ã€‚

![Hello World!.png](https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/54e27c65b419406d96ab617a4fec02b0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I-g6JCd55qE6Jyc:q75.awebp?rk3s=f64ab15b&x-expires=1761694509&x-signature=ykFPVY30MsRaB24C1Iar3geSJ8g%3D)

### 2.4 æ‰“åŒ…æ„å»º

```ruby
$ npm run build
```

è¿è¡Œä»¥ä¸Šå‘½ä»¤å³å¯å®Œæˆé¡¹ç›®æ‰“åŒ…æ„å»ºï¼Œå¹¶åœ¨é¡¹ç›®ç›®å½•ä¸‹ç”Ÿæˆä¸€ä¸ª dist ç›®å½•ã€‚

### 2.5 è¿è¡Œç”Ÿäº§ç¯å¢ƒä»£ç 

æœ‰äº† dist äº§ç‰©ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤å³å¯è¿è¡Œæ‰“åŒ…åçš„é¡¹ç›®ï¼Œè¿™ä¹Ÿæ˜¯ä¸Šçº¿åçš„è¿è¡Œæ•ˆæœã€‚

```r
$ npm run start:prod
```

âš ï¸Â æ³¨æ„ï¼šåœ¨ package.json ä¸­çš„è¿™æ¡è„šæœ¬å‘½ä»¤æ˜¯ï¼š`"start:prod": "node dist/main"` ï¼Œè¿™è¡¨ç¤ºè¯´è¿è¡Œçš„å…¥å£æ–‡ä»¶æ˜¯ dist ä¸‹çš„ main.jsï¼Œå¦‚æœæ˜¯æ¥å…¥ prisma ç­‰ ORM å·¥å…·ï¼Œæ‰“åŒ…åçš„ç›®å½•ç»“æ„æœ‰æ‰€ä¸åŒï¼Œè¿™é‡Œæ˜¯éœ€è¦ä¿®æ”¹çš„ã€‚

## 3\. çº¦å®šå¤§äºé…ç½®

Nest æä¾›äº†ä¸€ç§â€œçº¦å®šå¤§äºé…ç½®â€çš„æ¶æ„å½¢å¼ï¼Œå®ƒçš„æ„ä¹‰åœ¨äºå‡å°‘é…ç½®ï¼Œè®©å¼€å‘è€…åœ¨è§„å®šåŒºåŸŸç¼–å†™ä»£ç ï¼Œå‡è½»å¼€å‘å‹åŠ›å’Œå¿ƒæ™ºè´Ÿæ‹…ã€‚

åœ¨ src ç›®å½•ä¸‹æœ‰ä»¥ä¸‹æ–‡ä»¶ï¼š

![src ç›®å½•æ–‡ä»¶.png](https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ffceca5da67643e99f3681757af75543~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I-g6JCd55qE6Jyc:q75.awebp?rk3s=f64ab15b&x-expires=1761694509&x-signature=A%2Fk4jOc1V3KTEl0U%2BuyHelo87TU%3D)

- .controller.tsï¼šå¤„ç† http è¯·æ±‚ä»¥åŠè°ƒç”¨ service å±‚æ–¹æ³•
- .service.tsï¼šå°è£…é€šç”¨çš„ä¸šåŠ¡é€»è¾‘ã€ä¸æ•°æ®å±‚äº¤äº’ï¼ˆæ•°æ®åº“ CRUD æ“ä½œï¼‰ã€å…¶ä»–é¢å¤–çš„ç¬¬ä¸‰æ–¹è¯·æ±‚
- .module.tsï¼šæ¨¡å—ï¼Œæ³¨å…¥æ§åˆ¶å™¨å’ŒæœåŠ¡

ç»§ç»­å¾€ä¸‹çœ‹å¯ä»¥å‘ç°æ¯ä¸€ç»„èµ„æºéƒ½å¯¹åº”äº†è¿™ä¸‰ç§æ–‡ä»¶ï¼Œå®ƒä»¬å„è‡ªçº¦å¥½äº†åœ¨å…¶ä¸­åº”è¯¥å†™ä»€ä¹ˆå†…å®¹ï¼Œè€Œä¸æ˜¯è‡ªå·±å»é…ç½®ã€å»å°è£…ã€‚å°±å¥½åƒæ„Ÿå†’äº†ä¸ä¼šå»åƒå’³å—½è¯ä¸€æ ·ã€‚

## 4\. æ€»ç»“

è¿™ç¯‡åšå®¢ä»¥æ­¦æ—å¤–ä¼ çš„æ•…äº‹ä¸²è”èµ·æ•´ä¸ªä¸šåŠ¡æµç¨‹ï¼Œå¦å¤–è¿˜ä»‹ç»äº†å¦‚ä½•ä½¿ç”¨ NestJS å»åˆ›å»ºå’Œæ„å»ºå¹¶è¿è¡Œä¸€ä¸ªé¡¹ç›®ï¼Œä»¥åŠ NestJS ä¸­çš„ src æ–‡ä»¶æ„æˆã€‚

æœ¬æ–‡æ”¶å½•äºä»¥ä¸‹ä¸“æ 

![cover](https://p26-juejin-sign.byteimg.com/tos-cn-i-k3u1fbpfcp/f60476322d8a42288f3f5c4cea750f89~tplv-k3u1fbpfcp-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I-g6JCd55qE6Jyc:q75.awebp?rk3s=f64ab15b&x-expires=1761738416&x-signature=LLzGQGU%2BzSar3ZaRCEx8sLXES%2FA%3D)

è®²è§£ NestJS ç›¸å…³å†…å®¹ï¼Œæ•™å‰ç«¯å­¦ä¼šåç«¯å¼€å‘ã€‚å¦‚éœ€è½¬è½½è¯·ç§ä¿¡ï½

ä¸Šä¸€ç¯‡

NestJS ğŸ§‘ğŸ³Â  å¨å­å¿…ä¿®è¯¾ï¼ˆä¸€ï¼‰ï¼šåç«¯çš„æœ¬è´¨

ä¸‹ä¸€ç¯‡

NestJS ğŸ§‘ğŸ³Â å¨å­å¿…ä¿®è¯¾ï¼ˆä¸‰ï¼‰ï¼šæ§åˆ¶å™¨

---

created: 2025-10-22T19:47:46 (UTC +08:00)
tags: [NestJSä¸­æ–‡æŠ€æœ¯ç¤¾åŒº,å‰ç«¯å¼€å‘ç¤¾åŒº,å‰ç«¯æŠ€æœ¯äº¤æµ,å‰ç«¯æ¡†æ¶æ•™ç¨‹,JavaScript å­¦ä¹ èµ„æº,CSS æŠ€å·§ä¸æœ€ä½³å®è·µ,HTML5 æœ€æ–°åŠ¨æ€,å‰ç«¯å·¥ç¨‹å¸ˆèŒä¸šå‘å±•,å¼€æºå‰ç«¯é¡¹ç›®,å‰ç«¯æŠ€æœ¯è¶‹åŠ¿]
source: https://juejin.cn/post/7408778862283096102
author: è èçš„èœœ

---

# NestJS ğŸ§‘ğŸ³Â å¨å­å¿…ä¿®è¯¾ï¼ˆä¸‰ï¼‰ï¼šæ§åˆ¶å™¨NestJS ğŸ§‘ğŸ³ å¨å­å¿…ä¿®ç¬¬ä¸‰è¯¾ï¼ˆæ§åˆ¶å™¨ï¼‰ã€‚ä»‹ç»äº†å¦‚ä½•å¿«é€Ÿç”Ÿæˆ - æ˜é‡‘

> ## Excerpt
>
> NestJS ğŸ§‘ğŸ³ å¨å­å¿…ä¿®ç¬¬ä¸‰è¯¾ï¼ˆæ§åˆ¶å™¨ï¼‰ã€‚ä»‹ç»äº†å¦‚ä½•å¿«é€Ÿç”Ÿæˆä¸€ä¸ªèµ„æºï¼Œä»¥åŠæ§åˆ¶å™¨ç›¸å…³çš„å†…å®¹ï¼Œæœ€å°é™åº¦å¿«é€Ÿå®ç°ä¸€ä¸ªæ¥å£ã€‚

---

## 1\. å‰è¨€

åŒç¦å®¢æ ˆåº”è¯¥æœ‰ä¸€ä¸ªèœå•ä¾›å®¢äººç‚¹é¤ï¼Œæ¯ä¸€é“èœéƒ½æœ‰è‡ªå·±çš„ä¿¡æ¯ï¼ˆæ¯”å¦‚é…æ–™æ˜¯ä»€ä¹ˆã€ä»·æ ¼å¤šå°‘ï¼‰ï¼Œé…æ–™å’Œä»·æ ¼å¯ä»¥è°ƒæ•´ï¼Œå¯ä»¥ä¸æä¾›è¿™é“èœã€‚

ç®€è€Œè¨€ä¹‹ï¼Œèœå•å°±æ˜¯ä¸€ä¸ªèµ„æºï¼ŒRESTful é£æ ¼çš„ API æ¥å£å¦‚ä¸‹ï¼š

- GET /menus è·å–æ‰€æœ‰èœå“
- GET /menus/:id è·å–æŸä¸ªèœå“è¯¦æƒ…
- POST /menus æ·»åŠ æ–°çš„èœå“
- PATCH /menus/:id ä¿®æ”¹èœå“è¯¦æƒ…
- DELETE /menus/:id åˆ é™¤æŸä¸ªèœå“

æ¬¢è¿åŠ å…¥[æŠ€æœ¯äº¤æµç¾¤](https://juejin.cn/user/2154698521972423/pins "https://juejin.cn/user/2154698521972423/pins")ã€‚

![image.png](https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dd5e4b8be907402d9d882517ff6a0e0c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I-g6JCd55qE6Jyc:q75.awebp?rk3s=f64ab15b&x-expires=1761552197&x-signature=8V4V%2F89eba3akXtRVL4bcHJFgHQ%3D)

1.  [NestJS ğŸ§‘ğŸ³Â  å¨å­å¿…ä¿®è¯¾ï¼ˆä¸€ï¼‰ï¼šåç«¯çš„æœ¬è´¨](https://juejin.cn/post/7407260232664186930 "https://juejin.cn/post/7407260232664186930")
2.  [NestJS ğŸ§‘ğŸ³Â å¨å­å¿…ä¿®è¯¾ï¼ˆäºŒï¼‰ï¼šé¡¹ç›®åˆ›å»º](https://juejin.cn/post/7408021285768445961 "https://juejin.cn/post/7408021285768445961")
3.  [NestJS ğŸ§‘ğŸ³Â å¨å­å¿…ä¿®è¯¾ï¼ˆä¸‰ï¼‰ï¼šæ§åˆ¶å™¨](https://juejin.cn/post/7408778862283096102 "https://juejin.cn/post/7408778862283096102")
4.  [NestJS ğŸ§‘ğŸ³Â å¨å­å¿…ä¿®è¯¾ï¼ˆå››ï¼‰ï¼šæœåŠ¡ç±»](https://juejin.cn/post/7416235834938212403 "https://juejin.cn/post/7416235834938212403")
5.  [NestJS ğŸ§‘ğŸ³Â å¨å­å¿…ä¿®è¯¾ï¼ˆäº”ï¼‰ï¼šPrisma é›†æˆï¼ˆä¸Šï¼‰](https://juejin.cn/post/7416908856868110374 "https://juejin.cn/post/7416908856868110374")
6.  [NestJS ğŸ§‘ğŸ³Â å¨å­å¿…ä¿®è¯¾ï¼ˆå…­ï¼‰ï¼šPrisma é›†æˆï¼ˆä¸‹ï¼‰](https://juejin.cn/post/7418460243502792731 "https://juejin.cn/post/7418460243502792731")
7.  [NestJS ğŸ§‘ğŸ³Â å¨å­å¿…ä¿®è¯¾ï¼ˆä¸ƒï¼‰ï¼šç®¡é“](https://juejin.cn/post/7419887372463554601 "https://juejin.cn/post/7419887372463554601")
8.  [NestJS ğŸ§‘ğŸ³Â å¨å­å¿…ä¿®è¯¾ï¼ˆå…«ï¼‰ï¼šå¼‚å¸¸è¿‡æ»¤å™¨](https://juejin.cn/post/7420272008146239514 "https://juejin.cn/post/7420272008146239514")

## 2\. å¿«é€Ÿç”Ÿæˆ menus èµ„æº

é€šè¿‡ä»¥ä¸‹å‘½ä»¤å¿«é€Ÿç”Ÿæˆä¸€ä¸ªæœ‰å…³ menus èµ„æºçš„æ§åˆ¶å™¨æ–‡ä»¶ï¼š

```ruby
$ nest g resource menus
```

æ‰§è¡Œåä¼šåœ¨ src ç›®å½•ä¸‹ç”Ÿæˆä¸€ä¸ªæœ‰å…³ menus èµ„æºçš„æ–‡ä»¶å¤¹ï¼š

![menus èµ„æº.png](https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3c59aefeeea74e93b7304bc6d1215d19~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I-g6JCd55qE6Jyc:q75.awebp?rk3s=f64ab15b&x-expires=1761552197&x-signature=lnr%2BZP%2BNJAEted3O%2FSQJAkZvUGc%3D)

å¯ä»¥çœ‹åˆ°è¿™ç»„èµ„æºçš„æ„æˆä¸å¤–å±‚çš„ app æ˜¯ç±»ä¼¼çš„ï¼Œéƒ½ç”± controllerã€serviceã€module æ–‡ä»¶æ„æˆã€‚

å…ˆå‰è¯´è¿‡â€œçº¦å®šå¤§äºé…ç½®â€ï¼Œå› æ­¤å¯ä»¥é¢„è§çš„æ˜¯ controller æ–‡ä»¶é‡Œåº”è¯¥å†™äº† menus ç›¸å…³çš„è·¯ç”±åŒ¹é…ä»¥åŠå¯¹åº”æ‰§è¡Œçš„ service æ–¹æ³•ï¼Œè€Œ service æ–‡ä»¶ä¸­åŒ…å«äº†ä¸šåŠ¡å¤„ç†é€»è¾‘å’Œå…·ä½“å“åº”ç»™å‰ç«¯çš„å†…å®¹ï¼Œmodule åˆ™è´Ÿè´£å¦‚ä½•ç»„ç»‡å®ƒä»¬ã€‚

## 3\. æ§åˆ¶å™¨

æ‰“å¼€ menus.controller.ts æ–‡ä»¶å¯ä»¥çœ‹åˆ°å·²ç»è‡ªåŠ¨ç”Ÿæˆäº†ç›¸å…³ä»£ç ï¼Œæ•´ä½“ç»“æ„å¦‚ä¸‹ï¼š

```perl
// å¼•å…¥ç›¸å…³ä¾èµ–...

@Controller('menus')
export class MenusController {
  // ç›¸å…³ä»£ç ...
}
```

åœ¨ Nest ä¸­ä½¿ç”¨äº†å¤§é‡çš„è£…é¥°å™¨è¯­æ³•ï¼Œå¯ä»¥ç†è§£ä¸º\*\*â€œæ­¦å™¨èµ‹é­”â€ï¼Œä½¿ä¹‹å…·å¤‡æŸç§èƒ½åŠ›\*\*ã€‚

`@Controller` ç”¨äºå°†ç±» `MenusController` æ ‡è®°ä¸ºæ§åˆ¶å™¨ï¼Œæ§åˆ¶å™¨æ˜¯ç”¨äºå¤„ç†ä¼ å…¥çš„ HTTP è¯·æ±‚çš„ç±»ã€‚å®ƒå®šä¹‰äº†åº”ç”¨ç¨‹åºçš„è·¯ç”±ï¼Œå¹¶æ ¹æ®ä¸åŒçš„ HTTP æ–¹æ³•ï¼ˆå¦‚ `GET`ã€`POST`ã€`PUT`ã€`DELETE` ç­‰ï¼‰æ¥å¤„ç†è¯·æ±‚ã€‚

`@Controller('menus')` ä¸­çš„å­—ç¬¦ä¸²å‚æ•° `'menus'` \*\*\*\*æŒ‡å®šäº†æ§åˆ¶å™¨å¤„ç†çš„åŸºç¡€è·¯ç”±è·¯å¾„ï¼Œåœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæ‰€æœ‰ä¸è¿™ä¸ªæ§åˆ¶å™¨ç›¸å…³çš„è·¯ç”±éƒ½ä¼šä»¥ `/menus` å¼€å¤´ã€‚

### 3.1 ä¾èµ–æ³¨å…¥

åœ¨æ§åˆ¶å™¨ç±» MenusController ä¸­æœ‰å¦‚ä¸‹ä»£ç ï¼š

```typescript
// ä¾èµ–æ³¨å…¥
constructor(private readonly menusService: MenusService) {}

@Get()
findAll() {
  // ä½¿ç”¨æœåŠ¡ç±»å®ä¾‹æ–¹æ³•
  return this.menusService.findAll();
}

// å…¶ä»–ä»£ç ...
```

åœ¨ Nest ä¸­æœ‰ä¸¤ä¸ªå¾ˆé‡è¦çš„æ¦‚å¿µï¼š

- **æ§åˆ¶åè½¬ï¼ˆInversion of Controlï¼Œç®€ç§° IOCï¼‰**
- **ä¾èµ–æ³¨å…¥ï¼ˆDependency Injectionï¼Œç®€ç§° DIï¼‰**

`constructor(private readonly menusService: MenusService) {}` ï¼šè°ƒç”¨æ„é€ å‡½æ•°æ—¶ï¼ŒNest ä¼šé€šè¿‡ IOC å®¹å™¨æ¥è‡ªåŠ¨å®ä¾‹åŒ–ä¾èµ–é¡¹ï¼ˆè¿™é‡ŒæŒ‡çš„æ˜¯ `MenusService`ï¼šä¸€ä¸ªæœåŠ¡ç±»ï¼Œè´Ÿè´£å¤„ç†ä¸èœå•ç›¸å…³çš„ä¸šåŠ¡é€»è¾‘ï¼‰ï¼Œå¹¶è‡ªåŠ¨å°† `MenusService` çš„å®ä¾‹æ³¨å…¥åˆ°è¿™ä¸ªæ§åˆ¶å™¨ç±» `MenusController` ä¸­ã€‚

è¿™æ ·ä¸€æ¥ï¼Œå°±èƒ½åœ¨æ§åˆ¶ç±» `MenusController` ä¸­é€šè¿‡ `this.menusService` æ¥è°ƒç”¨ `MenusService` ä¸­çš„å®ä¾‹æ–¹æ³•äº†ã€‚

âš ï¸Â æ³¨æ„ï¼šé€šè¿‡ `private readonly` å£°æ˜ï¼Œè¿™ä¸ªä¾èµ–åªèƒ½åœ¨ç±»å†…éƒ¨ä½¿ç”¨ï¼Œå¹¶ä¸”ä¸èƒ½è¢«ä¿®æ”¹ã€‚

ä¾èµ–æ³¨å…¥è¿™ç§è§£è€¦è®¾è®¡ä¸å†éœ€è¦å°†ç¹æ‚çš„ä¸šåŠ¡é€»è¾‘å†™åœ¨æ§åˆ¶å™¨ä¸­ï¼Œè€Œæ˜¯å°†ä¾èµ–å…³ç³»ä»å†…éƒ¨è½¬ç§»åˆ°å¤–éƒ¨ï¼Œè¿™æ„å‘³ç€å¯ä»¥æ ¹æ®éœ€æ±‚è‡ªç”±æ·»åŠ æˆ–æ›´æ¢ä¾èµ–é¡¹ã€‚

åœ¨è¿™é‡Œå¯ä»¥è¯´ `MenusController` ä¾èµ– `MenusService`ï¼Œ`MenusService` ä¸º `MenusController` çš„ä¾èµ–é¡¹ã€‚

é™¤äº†èƒ½å¤ŸåŒ¹é…åˆ°è·¯ç”±ï¼Œä¸‹ä¸€æ­¥æ˜¯è¦å¤„ç†å¯¹åº”çš„ HTTP è¯·æ±‚ï¼ˆPOSTã€GETã€PATCHã€DELETEï¼‰ã€‚

### 3.2 `@Post()`

```less
@Post()
create(@Body() createMenuDto: CreateMenuDto) {
  return this.menusService.create(createMenuDto);
}
```

- **`@Post()`**ï¼šè¿™ä¸ªè£…é¥°å™¨æ ‡è¯†æ­¤æ–¹æ³•å¤„ç† POST è¯·æ±‚ã€‚é€šå¸¸ç”¨äºåˆ›å»ºæ–°çš„èµ„æºã€‚
- **`create(@Body() createMenuDto: CreateMenuDto)`**ï¼šè¿™ä¸ªæ–¹æ³•æ¥æ”¶ä¸€ä¸ª `createMenuDto` å‚æ•°ï¼Œè¡¨ç¤ºè¯·æ±‚ä½“ä¸­çš„æ•°æ®ã€‚`@Body()` è£…é¥°å™¨ä» HTTP è¯·æ±‚çš„ body ä¸­æå–æ•°æ®ï¼Œå¹¶å°†å…¶è½¬æ¢ä¸º `CreateMenuDto` å¯¹è±¡ã€‚**ä»è¿™é‡Œå¯ä»¥çœ‹å‡ºï¼šç±»ä¸­çš„æ–¹æ³•æ˜¯å¯ä»¥ä½¿ç”¨è£…é¥°å™¨çš„ï¼Œç”šè‡³æ˜¯æ–¹æ³•ä¸­çš„å…¥å‚ã€‚**
- **`this.menusService.create(createMenuDto)`**ï¼šè°ƒç”¨ `MenusService` å®ä¾‹çš„ `create` æ–¹æ³•ï¼Œå°† `createMenuDto` ä¼ é€’ç»™å®ƒã€‚`MenusService` å°†è´Ÿè´£å¤„ç†å®é™…çš„åˆ›å»ºé€»è¾‘ã€‚

æœ‰äº†è¿™æ®µä»£ç ï¼ŒæŒæŸœçš„å¯ä»¥æ·»åŠ æ–°çš„èœå“äº†ï¼š

![POSTè¯·æ±‚.png](https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8c1e2f38b2b747b2adb6a72217f44cdd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I-g6JCd55qE6Jyc:q75.awebp?rk3s=f64ab15b&x-expires=1761552197&x-signature=b%2Fk0f4Ymft9zal%2BJ1ayFzjoIPFc%3D)

### 3.3 `@Get()`

```kotlin
@Get()
findAll() {
  return this.menusService.findAll();
}
```

- **`@Get()`**ï¼šè¿™ä¸ªè£…é¥°å™¨æ ‡è¯†æ­¤æ–¹æ³•å¤„ç† GET è¯·æ±‚ã€‚é€šå¸¸ç”¨äºè·å–èµ„æºçš„åˆ—è¡¨ã€‚
- **`findAll()`**ï¼šç›´æ¥è°ƒç”¨ `MenusService` çš„ `findAll` æ–¹æ³•æ¥è·å–æ‰€æœ‰èœå•ã€‚

æœ‰äº†è¿™æ®µä»£ç ï¼Œå®¢äººä»¬å¯ä»¥æŸ¥çœ‹æ‰€æœ‰çš„èœå“äº†ï¼š

![GETè¯·æ±‚.png](https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4de80b6aea5a4cd2ab91984f08c33be6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I-g6JCd55qE6Jyc:q75.awebp?rk3s=f64ab15b&x-expires=1761552197&x-signature=p4%2FwU2D0hMgxp49Dwev4nMiZdMg%3D)

### 3.4 `@Get(':id')`

```less
@Get(':id')
findOne(@Param('id') id: string) {
  return this.menusService.findOne(+id);
}
```

- **`@Get(':id')`**ï¼šè¿™ä¸ªè£…é¥°å™¨æ ‡è¯†æ­¤æ–¹æ³•å¤„ç† GET è¯·æ±‚ï¼Œå¹¶ä¸”è·¯å¾„ä¸­å¸¦æœ‰ä¸€ä¸ª `id` å‚æ•°ã€‚`:id` æ˜¯ä¸€ä¸ªè·¯å¾„å‚æ•°ï¼Œè¡¨ç¤ºç‰¹å®šèµ„æºçš„æ ‡è¯†ç¬¦ã€‚
- **`findOne(@Param('id') id: string)`**ï¼šè¿™ä¸ªæ–¹æ³•ä½¿ç”¨ `@Param('id')` ä»è¯·æ±‚è·¯å¾„ä¸­æå– `id` å‚æ•°ï¼Œå¹¶å°†å…¶è½¬æ¢ä¸ºå­—ç¬¦ä¸²ç±»å‹ä¼ é€’ç»™ `findOne` æ–¹æ³•ã€‚
- **`this.menusService.findOne(+id)`**ï¼šè°ƒç”¨ `MenusService` çš„ `findOne` æ–¹æ³•ï¼Œä¼ å…¥çš„ `id` å‚æ•°å‰åŠ ä¸Š `+` è¡¨ç¤ºå°†å­—ç¬¦ä¸² `id` è½¬æ¢ä¸ºæ•°å­—ã€‚

æœ‰äº†è¿™æ®µä»£ç ï¼Œå®¢äººä»¬å¯ä»¥æŸ¥çœ‹æŸä¸€é“èœå“çš„è¯¦æƒ…äº†ï¼š

![GETè¯·æ±‚è¯¦æƒ….png](https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f1922f53119344cba503250cb005577b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I-g6JCd55qE6Jyc:q75.awebp?rk3s=f64ab15b&x-expires=1761552197&x-signature=JaUMo0dqJWYxDfGV58WAE4IspSI%3D)

### 3.5 `@Patch(':id')`

```less
@Patch(':id')
update(@Param('id') id: string, @Body() updateMenuDto: UpdateMenuDto) {
  return this.menusService.update(+id, updateMenuDto);
}
```

- **`@Patch(':id')`**ï¼šè¿™ä¸ªè£…é¥°å™¨æ ‡è¯†æ­¤æ–¹æ³•å¤„ç† PATCH è¯·æ±‚ã€‚PATCH è¯·æ±‚é€šå¸¸ç”¨äºæ›´æ–°éƒ¨åˆ†èµ„æºã€‚
- **`update(@Param('id') id: string, @Body() updateMenuDto: UpdateMenuDto)`**ï¼šè¯¥æ–¹æ³•ä»è¯·æ±‚è·¯å¾„ä¸­æå– `id` å‚æ•°ï¼Œä»è¯·æ±‚ä½“ä¸­æå–æ›´æ–°æ•°æ® `updateMenuDto`ã€‚
- **`this.menusService.update(+id, updateMenuDto)`**ï¼šè°ƒç”¨ `MenusService` çš„ `update` æ–¹æ³•ï¼Œæ›´æ–°æŒ‡å®š `id` çš„èœå•ã€‚

æœ‰äº†è¿™æ®µä»£ç ï¼ŒæŒæŸœçš„å¯ä»¥ä¿®æ”¹èœå“ä¿¡æ¯äº†ï¼š

![PATCHè¯·æ±‚.png](https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d86aa281cb4f443995763b5eefb1d3ee~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I-g6JCd55qE6Jyc:q75.awebp?rk3s=f64ab15b&x-expires=1761552197&x-signature=RTXn%2BA8TvK7P6%2FzStwS7DICjQLM%3D)

### 3.6 `@Delete(':id')`

```less
@Delete(':id')
remove(@Param('id') id: string) {
  return this.menusService.remove(+id);
}
```

- **`@Delete(':id')`**ï¼šè¿™ä¸ªè£…é¥°å™¨æ ‡è¯†æ­¤æ–¹æ³•å¤„ç† DELETE è¯·æ±‚ï¼Œé€šå¸¸ç”¨äºåˆ é™¤èµ„æºã€‚
- **`remove(@Param('id') id: string)`**ï¼šä»è¯·æ±‚è·¯å¾„ä¸­æå– `id` å‚æ•°ã€‚
- **`this.menusService.remove(+id)`**ï¼šè°ƒç”¨ `MenusService` çš„ `remove` æ–¹æ³•ï¼Œåˆ é™¤æŒ‡å®š `id` çš„èœå•ã€‚

æœ‰äº†è¿™æ®µä»£ç ï¼ŒæŒæŸœçš„å¯ä»¥åˆ é™¤èœå“ä¿¡æ¯äº†ï¼š

![DELETEè¯·æ±‚.png](https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a1bb1b9b67a04e69af0a35c3f0fee3b3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I-g6JCd55qE6Jyc:q75.awebp?rk3s=f64ab15b&x-expires=1761552197&x-signature=roSOlMHuKPpJMtR8Q78%2B%2B4UOTPQ%3D)

è‡³æ­¤ï¼Œå¯ä»¥è¯´å‰è¨€éƒ¨åˆ†çš„ API æ¥å£éƒ½å·²ç»å®Œæˆäº†ã€‚

### 3.7 `@Query()`

é€šè¿‡ 3.3 çš„ä»£ç å°±å¯ä»¥æŸ¥çœ‹æ‰€æœ‰çš„èœå“ï¼Œä½†æ˜¯æœ‰æ—¶å€™å¸Œæœ›é€šè¿‡åç§° name å’Œç±»å‹ category å»è¿‡æ»¤èœå•ï¼Œè¿™å°±è¦ç”¨åˆ°æŸ¥è¯¢å­—ç¬¦ä¸²çš„è£…é¥°å™¨ `@Query` ï¼Œå‡è®¾ç”¨æˆ·å¯ä»¥é€šè¿‡ä»¥ä¸‹æ¥å£æ‹¿åˆ°è¿‡æ»¤èœå•ï¼š

- GET /menus/search?name=beef&category=Chinese

```less
// æ–°å¢çš„æŸ¥è¯¢æ–¹æ³•
@Get('search')
search(@Query('name') name: string, @Query('category') category: string) {
  return this.menusService.search({ name, category });
}
```

`@Get('search')` è£…é¥°å™¨å°†ä¼šåŒ¹é…ä»¥ /menus/search å¼€å¤´çš„è·¯ç”±ã€‚

âš ï¸Â æ³¨æ„ï¼šæ”¾åœ¨åŠ¨æ€è·¯ç”±å‰é¢ï¼Œé˜²æ­¢è¢«ä¼˜å…ˆæ•è·ã€‚

å¯¹åº”çš„ menus.service.ts ä¸­çš„ `search` æ–¹æ³•ä¿®æ”¹å¦‚ä¸‹ï¼š

```typescript
@Injectable()
export class MenusService {
  // æ¨¡æ‹Ÿçš„èœå•æ•°æ®
  private menus = [
    {
      id: 1,
      name: "beef",
      category: "Chinese",
    },
    { id: 2, name: "pasta", category: "Italian" },
  ];

  search(filters: { name?: string; category?: string }) {
    return this.menus.filter(
      (menu) =>
        (!filters.name || menu.name.includes(filters.name)) &&
        (!filters.category || menu.category === filters.category)
    );
  }

  // å…¶ä»–æ–¹æ³•...
}
```

è¿™æ ·å°±å¯ä»¥åˆ†åˆ«ä»æŸ¥è¯¢å­—ç¬¦ä¸²ä¸­æ‹¿åˆ° `name` å’Œ `category` çš„å€¼ï¼Œå¹¶åˆ†åˆ«èµ‹å€¼ç»™å¯¹åº”å‚æ•°ï¼Œå†è°ƒç”¨ `MenusService` çš„ `search` æ–¹æ³•ï¼Œæ‰¾åˆ°æŒ‡å®š `name` å’Œ `category` èŒƒå›´ä¸‹çš„æ•°æ®äº†ã€‚

ç°åœ¨ï¼Œå®¢äººå¯ä»¥ç­›é€‰èœå“äº†ï¼š

![searchæ¡ä»¶æŸ¥è¯¢.png](https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7fbff9dffe35448394cb7ae2bf657e51~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I-g6JCd55qE6Jyc:q75.awebp?rk3s=f64ab15b&x-expires=1761552197&x-signature=ZBZPR6TiKfdYr2wQi3T1xN0NmR4%3D)

![searchæ¡ä»¶æŸ¥è¯¢2.png](https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/238f35811fe5426eb5d7bf1cc7ad2c2a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I-g6JCd55qE6Jyc:q75.awebp?rk3s=f64ab15b&x-expires=1761552197&x-signature=Wt2%2F3Jovc2DZQQH6qI1i9HRk4rI%3D)

## 4\. æ€»ç»“

è¿™ç¯‡åšå®¢ä»‹ç»äº†å¦‚ä½•å¿«é€Ÿç”Ÿæˆä¸€ä¸ªèµ„æºï¼Œä»¥åŠæ§åˆ¶å™¨ç›¸å…³çš„å†…å®¹ã€‚ç»“åˆè£…é¥°å™¨ï¼Œæ§åˆ¶å™¨ç±»èƒ½å¤Ÿè´Ÿè´£å¤„ç†ä¸èœå•ç›¸å…³çš„ HTTP è¯·æ±‚ã€‚å®ƒåˆ©ç”¨ NestJS æä¾›çš„è£…é¥°å™¨æ¥æ ‡è¯†æ¯ä¸ªæ–¹æ³•å¤„ç†çš„è¯·æ±‚ç±»å‹ï¼ˆGETã€POSTã€PATCHã€DELETEï¼‰ä»¥åŠè·¯å¾„å‚æ•°ã€‚å…¶ä»–çš„å„ç§è£…é¥°å™¨å°†ä¼šåœ¨ä»¥åç”¨åˆ°æ—¶æ‰ä¼šå‡ºç°ã€‚

ä¸šåŠ¡é€»è¾‘éƒ¨åˆ†é€šè¿‡ä¾èµ–æ³¨å…¥çš„æ–¹å¼å§”æ‰˜ç»™ `MenusService` æœåŠ¡ç±»æ¥å¤„ç†ã€‚è¿™æ ·ä½¿å¾—æ§åˆ¶å™¨æ›´åŠ ç®€æ´ï¼Œä¸“æ³¨äºè·¯ç”±å¤„ç†å’Œè¯·æ±‚è§£æï¼Œè€Œå°†å…·ä½“çš„ä¸šåŠ¡é€»è¾‘äº¤ç”±æœåŠ¡ç±»è´Ÿè´£ã€‚ä¸‹ä¸€ç¯‡å°†è®²è§£æœåŠ¡ç±»çš„ç›¸å…³å†…å®¹ã€‚

---

created: 2025-10-22T19:47:53 (UTC +08:00)
tags: [å‰ç«¯,NestJS,åç«¯ä¸­æ–‡æŠ€æœ¯ç¤¾åŒº,å‰ç«¯å¼€å‘ç¤¾åŒº,å‰ç«¯æŠ€æœ¯äº¤æµ,å‰ç«¯æ¡†æ¶æ•™ç¨‹,JavaScript å­¦ä¹ èµ„æº,CSS æŠ€å·§ä¸æœ€ä½³å®è·µ,HTML5 æœ€æ–°åŠ¨æ€,å‰ç«¯å·¥ç¨‹å¸ˆèŒä¸šå‘å±•,å¼€æºå‰ç«¯é¡¹ç›®,å‰ç«¯æŠ€æœ¯è¶‹åŠ¿]
source: https://juejin.cn/post/7416235834938212403
author: è èçš„èœœ

---

# NestJS ğŸ§‘ğŸ³Â å¨å­å¿…ä¿®è¯¾ï¼ˆå››ï¼‰ï¼šæœåŠ¡ç±»åœ¨ NestJS åº”ç”¨æ¶æ„ä¸­ï¼Œæ§åˆ¶å™¨è´Ÿè´£æ¥æ”¶å’Œå¤„ç† HTTP è¯·æ±‚ï¼Œéš - æ˜é‡‘

> ## Excerpt
>
> åœ¨ NestJS åº”ç”¨æ¶æ„ä¸­ï¼Œæ§åˆ¶å™¨è´Ÿè´£æ¥æ”¶å’Œå¤„ç† HTTP è¯·æ±‚ï¼Œéšåå°†ä¸šåŠ¡é€»è¾‘çš„å¤„ç†å·¥ä½œå§”æ‰˜ç»™æœåŠ¡ç±»ã€‚è¿™äº›æœåŠ¡ç±»é€šè¿‡ä¾èµ–æ³¨å…¥æœºåˆ¶ä¸æ§åˆ¶å™¨ç›¸è¿ï¼Œç¡®ä¿äº†ä»£ç çš„æ¾è€¦åˆå’Œå¯ç»´æŠ¤æ€§ã€‚---

## theme: fancy

1.  å‰è¨€

ä¹‹å‰ä½¿ç”¨æ§åˆ¶å™¨æ¥å®ç° CRUD çš„åŸºæœ¬åŠŸèƒ½ï¼Œæœ¬èŠ‚å°†é‡ç‚¹ä»‹ç» NestJS ä¸­çš„æœåŠ¡ç±»

---

## 1\. å‰è¨€

ä¹‹å‰ä½¿ç”¨æ§åˆ¶å™¨æ¥å®ç° CRUD çš„åŸºæœ¬åŠŸèƒ½ï¼Œæœ¬èŠ‚å°†é‡ç‚¹ä»‹ç» NestJS ä¸­çš„æœåŠ¡ç±»ï¼ˆservice æ–‡ä»¶ï¼‰ï¼Œå®ƒä¸»è¦ç”¨äºå¤„ç†ä¸šåŠ¡é€»è¾‘ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œå®ƒå°†åŒ…å«åº”ç”¨ç¨‹åºçš„æ ¸å¿ƒåŠŸèƒ½ï¼Œå¹¶è´Ÿè´£ä¸æ•°æ®åº“ã€å…¶ä»–æœåŠ¡ã€å¤–éƒ¨ API æˆ–æ˜¯ç¬¬ä¸‰æ–¹åº“äº¤äº’ã€‚

ç›®å‰çš„ä»£ç ç»“æ„å¦‚ä¸‹ï¼š

![ç›®å½•ç»“æ„.png](https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0e4aed3d0daa4b25bcc33e9a7827b4b8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I-g6JCd55qE6Jyc:q75.awebp?rk3s=f64ab15b&x-expires=1761702280&x-signature=sAYLJnlOYMMZKXtMcHuvLFLuNL8%3D)

æ¬¢è¿åŠ å…¥[æŠ€æœ¯äº¤æµç¾¤](https://juejin.cn/user/2154698521972423/pins "https://juejin.cn/user/2154698521972423/pins")ã€‚

![image.png](https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dd5e4b8be907402d9d882517ff6a0e0c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I-g6JCd55qE6Jyc:q75.awebp?rk3s=f64ab15b&x-expires=1761702280&x-signature=m4tWJTMmKBJ4dekUy9C0b%2B3Ew3o%3D)

1.  [NestJS ğŸ§‘ğŸ³Â  å¨å­å¿…ä¿®è¯¾ï¼ˆä¸€ï¼‰ï¼šåç«¯çš„æœ¬è´¨](https://juejin.cn/post/7407260232664186930 "https://juejin.cn/post/7407260232664186930")
2.  [NestJS ğŸ§‘ğŸ³Â å¨å­å¿…ä¿®è¯¾ï¼ˆäºŒï¼‰ï¼šé¡¹ç›®åˆ›å»º](https://juejin.cn/post/7408021285768445961 "https://juejin.cn/post/7408021285768445961")
3.  [NestJS ğŸ§‘ğŸ³Â å¨å­å¿…ä¿®è¯¾ï¼ˆä¸‰ï¼‰ï¼šæ§åˆ¶å™¨](https://juejin.cn/post/7408778862283096102 "https://juejin.cn/post/7408778862283096102")
4.  [NestJS ğŸ§‘ğŸ³Â å¨å­å¿…ä¿®è¯¾ï¼ˆå››ï¼‰ï¼šæœåŠ¡ç±»](https://juejin.cn/post/7416235834938212403 "https://juejin.cn/post/7416235834938212403")
5.  [NestJS ğŸ§‘ğŸ³Â å¨å­å¿…ä¿®è¯¾ï¼ˆäº”ï¼‰ï¼šPrisma é›†æˆï¼ˆä¸Šï¼‰](https://juejin.cn/post/7416908856868110374 "https://juejin.cn/post/7416908856868110374")
6.  [NestJS ğŸ§‘ğŸ³Â å¨å­å¿…ä¿®è¯¾ï¼ˆå…­ï¼‰ï¼šPrisma é›†æˆï¼ˆä¸‹ï¼‰](https://juejin.cn/post/7418460243502792731 "https://juejin.cn/post/7418460243502792731")
7.  [NestJS ğŸ§‘ğŸ³Â å¨å­å¿…ä¿®è¯¾ï¼ˆä¸ƒï¼‰ï¼šç®¡é“](https://juejin.cn/post/7419887372463554601 "https://juejin.cn/post/7419887372463554601")
8.  [NestJS ğŸ§‘ğŸ³Â å¨å­å¿…ä¿®è¯¾ï¼ˆå…«ï¼‰ï¼šå¼‚å¸¸è¿‡æ»¤å™¨](https://juejin.cn/post/7420272008146239514 "https://juejin.cn/post/7420272008146239514")

## 2\. æä¾›å™¨

ä½œä¸ºä¸€ä¸ªæ¾è€¦åˆçš„è®¾è®¡æ¥è¯´ï¼Œå¸¦æœ‰ `@Injectable` è£…é¥°å™¨çš„æœåŠ¡ç±»ä½œä¸ºä¾èµ–é¡¹ï¼ˆæä¾›å™¨ï¼‰è¢«æ³¨å…¥åˆ°æ§åˆ¶å™¨ä¸­ï¼Œä½¿å¾—æ§åˆ¶ç±»æ›´ä¸ºå¼ºå¤§ã€‚

ä¸¾ä¸ªä¾‹å­ï¼Œåœ¨è¿™å±‚å…³ç³»ä¸­ï¼ŒæœåŠ¡ç±»å±äºï¼ˆç–«è‹—ï¼‰æä¾›è€…è¿›è¡Œæ³¨å…¥ï¼ˆğŸ’‰ï¼‰ï¼Œä½œä¸ºæ³¨å…¥ç›®æ ‡çš„æ§åˆ¶ç±»ï¼ˆäººç±»ï¼‰åˆ™æ˜¯æ¶ˆè´¹è€…ï¼Œæ¶ˆè´¹è€…åŠŸèƒ½å¢å¼ºäº†ï¼ˆäººç±»å…·å¤‡ç—…æ¯’å…ç–«åŠ›ï¼‰ã€‚

### 2.1 æœåŠ¡ç±»å®šä¹‰

menus.service.ts çš„ä»£ç ä¸»ä½“ç»“æ„å¦‚ä¸‹ï¼š

```perl
import { Injectable } from '@nestjs/common';
// ...

@Injectable()
export class MenusService {
  // ...
}
```

`@Injectable` è£…é¥°å™¨ç”¨äºæ ‡è®° `MenusService` ç±»ä¸ºå¯æ³¨å…¥çš„æä¾›å™¨ï¼Œå®ƒå‘Šè¯‰ NestJS è¿™ä¸ªç±»å¯ä»¥ä½œä¸ºä¸€ä¸ªæä¾›å™¨ä½¿ç”¨ï¼Œå¹¶ä¸”å¯ä»¥è¢«å…¶ä»–ç±»ï¼ˆå¦‚æ§åˆ¶å™¨ã€æœåŠ¡ã€æ¨¡å—ç­‰ï¼‰é€šè¿‡æ„é€ å‡½æ•°æ³¨å…¥ã€‚

### 2.2 æœåŠ¡ç±»æ³¨å…¥

è¿™æ ·ï¼Œå®ƒå°±å¯ä»¥åœ¨ `menu.controller.ts` ä¸­çš„ `MenusController` ç±»ä¸­çš„æ„é€ å‡½æ•°ä¸­æ³¨å…¥ï¼š

```typescript
// ...
import { MenusService } from "./menus.service";

@Controller("menus")
export class MenusController {
  constructor(private readonly menusService: MenusService) {}
  // CRUD ç›¸å…³ä¸šåŠ¡é€»è¾‘ä»£ç 
}
```

äºæ˜¯ï¼Œè®¿é—®å¯¹åº” api æ¥å£å°±èƒ½è°ƒç”¨æœåŠ¡ç±»ä¸­çš„æ–¹æ³•ï¼Œè¿›è€Œè¿”å›æ•°æ®ç»™å‰ç«¯ã€‚

### 2.3 æœåŠ¡æ³¨å†Œ

æ•´ä½“æ¥è¯´ï¼Œå¯¹èœå•çš„ CRUD æ˜¯ä¸€é¡¹æœåŠ¡ï¼Œå®ƒæœ‰æä¾›è€…ã€æ¶ˆè´¹è€…ï¼Œè‡ªç„¶ä¹Ÿéœ€è¦ä¸€ä¸ªä¸­å¿ƒç»„ç»‡æ¥ç®¡ç†å®ƒä»¬ï¼Œè¿™å°±æ˜¯ menus ç›®å½•ä¸‹çš„ module æ–‡ä»¶ â€”â€” menus.module.tsï¼Œåœ¨è¿™é‡Œï¼Œæˆ‘ä»¬æŠŠæ§åˆ¶ç±»å’ŒæœåŠ¡ç±»æ³¨å†Œä¸Šå»ï¼š

```typescript
import { Module } from "@nestjs/common";
import { MenusService } from "./menus.service";
import { MenusController } from "./menus.controller";

@Module({
  controllers: [MenusController], // æ§åˆ¶å™¨
  providers: [MenusService], // æä¾›å™¨ï¼ˆæœåŠ¡ï¼‰
})
export class MenusModule {}
```

`@Module` è£…é¥°å™¨ç”¨äºå®šä¹‰ `MenusModule` ç±»ä¸ºä¸€ä¸ªæ¨¡å—ã€‚æ¨¡å—æ˜¯ NestJS åº”ç”¨ç¨‹åºçš„åŸºæœ¬æ„å»ºå—ï¼Œç”¨äºç»„ç»‡å’Œå°è£…ä¸€ç»„ç›¸å…³çš„ç»„ä»¶ï¼ˆå¦‚æä¾›å™¨ã€æ§åˆ¶å™¨ã€å¯¼å…¥çš„æ¨¡å—ç­‰ï¼‰ã€‚ä¸Šé¢å°±æ˜¯ä¸€ä¸ªæœ‰å…³ menus çš„æ¨¡å—ï¼Œå®ƒå¯ä»¥ä½œä¸ºä¸€ä¸ªå•å…ƒè¢«å¯¼å…¥å¯¼å‡ºã€‚

é™¤äº† `controllers` ç”¨äºæ³¨å†Œæ§åˆ¶å™¨ã€`providers` ç”¨äºæ³¨å†Œæä¾›å™¨ï¼Œ`@Module` ä¸­è¿˜æœ‰ï¼š

- `imports`ï¼šç”¨äºå¯¼å…¥å…¶ä»–æ¨¡å—ã€‚é€šè¿‡å¯¼å…¥æ¨¡å—ï¼Œå¯ä»¥åœ¨å½“å‰æ¨¡å—ä¸­ä½¿ç”¨å…¶ä»–æ¨¡å—æä¾›çš„æœåŠ¡ã€‚
- `exports`ï¼šç”¨äºå¯¼å‡ºæä¾›å™¨æˆ–æ¨¡å—ï¼Œä½¿å®ƒä»¬å¯ä»¥è¢«å…¶ä»–æ¨¡å—ä½¿ç”¨ã€‚

âš ï¸Â æ³¨æ„ï¼šå¦‚æœä¸è¿›è¡Œæ³¨å†Œï¼Œè¿™äº›ä¾èµ–å°±ä¸ä¼šå¾—åˆ°è§£æã€‚

## 3\. ä¸»æ¨¡å—

app.module.ts æ˜¯ä¸»æ¨¡å—æ‰€åœ¨æ–‡ä»¶ï¼Œè¿™æ˜¯æ•´ä¸ªç³»ç»Ÿçš„æ ¸å¿ƒæ‰€åœ¨ï¼Œå¯ä»¥çœ‹ä½œæ˜¯ä¸­å¤®å¤§è„‘ã€‚

![åº”ç”¨ä¾èµ–.png](https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b367a42a027d486099e23906f4f9629a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I-g6JCd55qE6Jyc:q75.awebp?rk3s=f64ab15b&x-expires=1761702280&x-signature=Q940YS0FRR8KsIC3EJ%2F5wWLRou4%3D)

ç®­å¤´è¡¨ç¤ºå¯¼å…¥æ–¹å‘ï¼Œæ¯”å¦‚å…±äº«æ¨¡å—è¢«å¯¼å…¥åˆ°å„ä¸ªæœåŠ¡ç±»ä¸­ï¼Œå„ä¸ªæœåŠ¡ç±»åˆ†åˆ«å¯¼å…¥å¯¹åº”çš„åŠŸèƒ½æ¨¡å—ä¸­ï¼ŒåŠŸèƒ½æ¨¡å—å¯¼å…¥ä¸»æ¨¡å—ã€‚å…±äº«æ¨¡å—å°†åœ¨ä»¥åæåˆ°ã€‚

### 3.1 menus æ¨¡å—å¯¼å…¥åˆ°ä¸»æ¨¡å—

menus æ¨¡å—ä½œä¸ºå­æ¨¡å—éœ€è¦å¯¼å…¥åˆ°ä¸»æ¨¡å— app.module.ts ä¸­ï¼š

```typescript
import { Module } from "@nestjs/common";
import { AppController } from "./app.controller";
import { AppService } from "./app.service";
import { MenusModule } from "./menus/menus.module";

@Module({
  imports: [MenusModule], // å¯¼å…¥ MenusModule æ¨¡å—
  controllers: [AppController],
  providers: [AppService],
})
export class AppModule {}
```

é€šè¿‡ `imports: [MenusModule]` å°† `MenusModule` å¯¼å…¥åˆ°ä¸»æ¨¡å—ï¼Œè¿™æ · `AppModule` å¯ä»¥ä½¿ç”¨ `MenusModule` ä¸­å®šä¹‰çš„æ‰€æœ‰åŠŸèƒ½äº†ã€‚

### 3.2 main.ts å¯åŠ¨åº”ç”¨

main.ts ä¸ºæ•´ä¸ªåº”ç”¨çš„å…¥å£æ–‡ä»¶ï¼š

```javascript
import { NestFactory } from "@nestjs/core";
import { AppModule } from "./app.module";

async function bootstrap() {
  const app = await NestFactory.create(AppModule);
  await app.listen(3000);
}
bootstrap();
```

åœ¨è¿™é‡Œè°ƒç”¨ `bootstrap` æ–¹æ³•ï¼šå°†ä¸»æ¨¡å— `AppModule` ä¼ å…¥ NestJS çš„å·¥å‚å‡½æ•° `NestFactory.create` æ–¹æ³•å°±èƒ½åˆ›å»ºä¸€ä¸ª Nest åº”ç”¨å®ä¾‹ï¼Œæœ€åå°†åœ¨ 3000 ç«¯å£å¯åŠ¨ã€‚

## 4\. æ€»ç»“

åœ¨ NestJS åº”ç”¨æ¶æ„ä¸­ï¼Œæ§åˆ¶å™¨è´Ÿè´£æ¥æ”¶å’Œå¤„ç† HTTP è¯·æ±‚ï¼Œéšåå°†ä¸šåŠ¡é€»è¾‘çš„å¤„ç†å·¥ä½œå§”æ‰˜ç»™æœåŠ¡ç±»ã€‚è¿™äº›æœåŠ¡ç±»é€šè¿‡ä¾èµ–æ³¨å…¥æœºåˆ¶ä¸æ§åˆ¶å™¨ç›¸è¿ï¼Œç¡®ä¿äº†ä»£ç çš„æ¾è€¦åˆå’Œå¯ç»´æŠ¤æ€§ã€‚æœåŠ¡ç±»éšååœ¨å„è‡ªçš„æ¨¡å—ä¸­æ³¨å†Œï¼Œå¹¶é€šè¿‡æ¨¡å—åŒ–ç»“æ„å‘ä¸Šèšåˆï¼Œç›´è‡³è¾¾åˆ°åº”ç”¨çš„æ ¹æ¨¡å—ã€‚è¿™ç§åˆ†å±‚å’Œæ¨¡å—åŒ–çš„ç­–ç•¥æ„å»ºäº†ä¸€ä¸ªæ¸…æ™°ã€é«˜æ•ˆçš„æœåŠ¡æ¶æ„ï¼Œä¸ºåº”ç”¨ç¨‹åºçš„è¿è¡Œæä¾›äº†åšå®çš„åŸºç¡€ã€‚

---

created: 2025-10-22T19:48:00 (UTC +08:00)
tags: [å‰ç«¯,åç«¯,NestJSä¸­æ–‡æŠ€æœ¯ç¤¾åŒº,å‰ç«¯å¼€å‘ç¤¾åŒº,å‰ç«¯æŠ€æœ¯äº¤æµ,å‰ç«¯æ¡†æ¶æ•™ç¨‹,JavaScript å­¦ä¹ èµ„æº,CSS æŠ€å·§ä¸æœ€ä½³å®è·µ,HTML5 æœ€æ–°åŠ¨æ€,å‰ç«¯å·¥ç¨‹å¸ˆèŒä¸šå‘å±•,å¼€æºå‰ç«¯é¡¹ç›®,å‰ç«¯æŠ€æœ¯è¶‹åŠ¿]
source: https://juejin.cn/post/7416908856868110374
author: è èçš„èœœ

---

# NestJS ğŸ§‘ğŸ³Â å¨å­å¿…ä¿®è¯¾ï¼ˆäº”ï¼‰ï¼šPrisma é›†æˆï¼ˆä¸Šï¼‰ä»¥ PostgreSQL ä¸ºä¾‹ï¼Œä»‹ç»å¦‚ä½•åœ¨ Nest - æ˜é‡‘

> ## Excerpt
>
> ä»¥ PostgreSQL ä¸ºä¾‹ï¼Œä»‹ç»å¦‚ä½•åœ¨ NestJS ä¸­é›†æˆ Prisma ORMï¼ŒåŒ…æ‹¬ï¼šåˆå§‹åŒ– Prismaã€é…ç½®æ•°æ®åº“è¿æ¥ä»¥åŠæ•°æ®æ’­ç§ã€‚---

## theme: fancy

1.  å‰è¨€

åœ¨ä¸šåŠ¡é€»è¾‘ä¸­ï¼Œæ•°æ®åº“æ“ä½œæ˜¯éå¸¸å¸¸è§çš„ä¸€éƒ¨åˆ†ã€‚å‰ç«¯åº”ç”¨ä¸­å±•ç¤ºçš„æ•°æ®é€šå¸¸éƒ½æ¥æºäºæ•°æ®åº“ï¼Œé€šè¿‡æ•°æ®åº“çš„è¯»å†™æ“ä½œï¼Œèƒ½å¤Ÿä¸ºç”¨æˆ·

---

## 1\. å‰è¨€

åœ¨ä¸šåŠ¡é€»è¾‘ä¸­ï¼Œæ•°æ®åº“æ“ä½œæ˜¯éå¸¸å¸¸è§çš„ä¸€éƒ¨åˆ†ã€‚å‰ç«¯åº”ç”¨ä¸­å±•ç¤ºçš„æ•°æ®é€šå¸¸éƒ½æ¥æºäºæ•°æ®åº“ï¼Œé€šè¿‡æ•°æ®åº“çš„è¯»å†™æ“ä½œï¼Œèƒ½å¤Ÿä¸ºç”¨æˆ·æä¾›æ‰€éœ€çš„ä¿¡æ¯å’ŒåŠŸèƒ½ã€‚

Prisma æ˜¯ä¸€ä¸ªç°ä»£åŒ–çš„ ORM å·¥å…·ï¼Œç®€åŒ–äº†æ•°æ®åº“æ“ä½œï¼Œå¹¶æä¾›äº†å¼ºç±»å‹æ”¯æŒå’Œè‡ªåŠ¨ç”Ÿæˆçš„æ•°æ®åº“æ¨¡å‹ã€‚ç°åœ¨å°†æ¢è®¨å¦‚ä½•å°† Prisma é›†æˆåˆ°é¡¹ç›®ä¸­ï¼Œå¹¶å¦‚ä½•åˆ©ç”¨å…¶åŠŸèƒ½æ¥é«˜æ•ˆç®¡ç†æ•°æ®åº“ã€‚

Prisma ç›®å‰æ”¯æŒ PostgreSQLã€MySQLã€SQL Serverã€SQLiteã€MongoDB å’Œ CockroachDBã€‚

è¿™é‡Œæˆ‘ä»¬ä»¥ PostgreSQL ä¸ºä¾‹ã€‚

æ¬¢è¿åŠ å…¥[æŠ€æœ¯äº¤æµç¾¤](https://juejin.cn/user/2154698521972423/pins "https://juejin.cn/user/2154698521972423/pins")ã€‚

![image.png](https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dd5e4b8be907402d9d882517ff6a0e0c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I-g6JCd55qE6Jyc:q75.awebp?rk3s=f64ab15b&x-expires=1761693334&x-signature=eRIboaI1Lq8b6DcFbEKul5PDTlI%3D)

1.  [NestJS ğŸ§‘ğŸ³Â  å¨å­å¿…ä¿®è¯¾ï¼ˆä¸€ï¼‰ï¼šåç«¯çš„æœ¬è´¨](https://juejin.cn/post/7407260232664186930 "https://juejin.cn/post/7407260232664186930")
2.  [NestJS ğŸ§‘ğŸ³Â å¨å­å¿…ä¿®è¯¾ï¼ˆäºŒï¼‰ï¼šé¡¹ç›®åˆ›å»º](https://juejin.cn/post/7408021285768445961 "https://juejin.cn/post/7408021285768445961")
3.  [NestJS ğŸ§‘ğŸ³Â å¨å­å¿…ä¿®è¯¾ï¼ˆä¸‰ï¼‰ï¼šæ§åˆ¶å™¨](https://juejin.cn/post/7408778862283096102 "https://juejin.cn/post/7408778862283096102")
4.  [NestJS ğŸ§‘ğŸ³Â å¨å­å¿…ä¿®è¯¾ï¼ˆå››ï¼‰ï¼šæœåŠ¡ç±»](https://juejin.cn/post/7416235834938212403 "https://juejin.cn/post/7416235834938212403")
5.  [NestJS ğŸ§‘ğŸ³Â å¨å­å¿…ä¿®è¯¾ï¼ˆäº”ï¼‰ï¼šPrisma é›†æˆï¼ˆä¸Šï¼‰](https://juejin.cn/post/7416908856868110374 "https://juejin.cn/post/7416908856868110374")
6.  [NestJS ğŸ§‘ğŸ³Â å¨å­å¿…ä¿®è¯¾ï¼ˆå…­ï¼‰ï¼šPrisma é›†æˆï¼ˆä¸‹ï¼‰](https://juejin.cn/post/7418460243502792731 "https://juejin.cn/post/7418460243502792731")
7.  [NestJS ğŸ§‘ğŸ³Â å¨å­å¿…ä¿®è¯¾ï¼ˆä¸ƒï¼‰ï¼šç®¡é“](https://juejin.cn/post/7419887372463554601 "https://juejin.cn/post/7419887372463554601")
8.  [NestJS ğŸ§‘ğŸ³Â å¨å­å¿…ä¿®è¯¾ï¼ˆå…«ï¼‰ï¼šå¼‚å¸¸è¿‡æ»¤å™¨](https://juejin.cn/post/7420272008146239514 "https://juejin.cn/post/7420272008146239514")

## 2\. Prisma åˆå§‹åŒ–

### 2.1 å®‰è£… prisma

```
npm install prisma -D
```

### 2.2 åˆå§‹åŒ– prisma è®¾ç½®

```csharp
npx prisma init
```

è¿è¡Œå®Œæˆåï¼Œå°†ä¼šåœ¨æ ¹ç›®å½•ä¸‹ç”Ÿæˆ prisma ç›®å½•ï¼Œé‡Œé¢æœ‰ä¸€ä¸ª schema.prisma æ–‡ä»¶ç”¨äºé…ç½®æ•°æ®åº“è¿æ¥å’Œæ•°æ®åº“æ¨¡å‹ï¼ŒåŒæ—¶åœ¨æ ¹ç›®å½•è¿˜ç”Ÿæˆäº† .env æ–‡ä»¶ï¼Œç”¨äºç¼–å†™ç¯å¢ƒå˜é‡ã€‚

### 2.3 å®‰è£… prisma å®¢æˆ·ç«¯

ä¸ºäº†èƒ½å¤Ÿåœ¨ Nest åº”ç”¨ä¸­ä¸æ•°æ®åº“è¿›è¡Œäº¤äº’ï¼Œè¿˜è¦ä½¿ç”¨ Prisma Clientï¼Œå› æ­¤ä¹Ÿè¦å®‰è£…ï¼š

```bash
npm install @prisma/client
```

## 3\. é…ç½®æ•°æ®åº“è¿æ¥

åœ¨è¿æ¥ä¹‹å‰éœ€è¦å¯åŠ¨ä¸€ä¸ªæ•°æ®åº“ï¼Œè¿™é‡Œä½¿ç”¨ docker compose æ¥å®ç°ã€‚

### 3.1 å¯åŠ¨æ•°æ®åº“å®ä¾‹

ä½¿ç”¨ docker compose åˆ›å»ºä¸€ä¸ª PostgreSQL çš„æ•°æ®åº“å®ä¾‹ï¼š

```yaml
# docker-compose.yml

version: "3.8"
services:
  cook-api-1-postgres:
    container_name: cook-api-1-postgres
    image: postgres:14-alpine
    restart: always
    environment:
      - POSTGRES_USER=cook
      - POSTGRES_PASSWORD=cookpassword
    volumes:
      - cook-api-1-data:/var/lib/postgresql/data
    ports:
      - "5432:5432"

volumes:
  cook-api-1-data:
```

åœ¨ç»ˆç«¯è¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼š

```
docker compose up -d
```

![docker compose up -d.png](https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bd665bf03d5d48a3a5bb6a9cebf9ab4d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I-g6JCd55qE6Jyc:q75.awebp?rk3s=f64ab15b&x-expires=1761693334&x-signature=euJhtdFRbgceMtchQkDpGhtESe4%3D)

è¾“å…¥ `docker ps` å¯ä»¥çœ‹åˆ° cook-api-1-postgres æ•°æ®åº“å®ä¾‹æ­£åœ¨è¿è¡Œï¼š

![docker ps çš„ç»“æœ.png](https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c255abdbee6c42b79506681d8c1f5185~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I-g6JCd55qE6Jyc:q75.awebp?rk3s=f64ab15b&x-expires=1761693334&x-signature=iceDYHfFKk02LbttwoDSSRYEEnE%3D)

### 3.2 é…ç½®æ•°æ®åº“ç¯å¢ƒå˜é‡

åœ¨ prisma/schema.prisma æ–‡ä»¶ä¸­é…ç½® PostgreSQL æ•°æ®åº“è¿æ¥ã€‚æ‰¾åˆ° datasource éƒ¨åˆ†å¹¶è¿›è¡Œå¦‚ä¸‹é…ç½®ï¼š

```bash
datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}
```

è¿™è¡¨ç¤º prisma çš„æ•°æ®æºæ¥è‡ª postgresqlï¼Œä½ç½®ä» .env æ–‡ä»¶ä¸­çš„ DATABASE_URL å˜é‡ä¸­è¯»å–ã€‚

ç„¶åï¼Œåœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹çš„ .env æ–‡ä»¶ä¸­æ·»åŠ æ•°æ®åº“è¿æ¥ URLï¼š

```ini
DATABASE_URL="postgresql://cook:cookpassword@localhost:5432/dev-db"
```

æ„æ€æ˜¯è¿æ¥åˆ° localhost:5432 çš„ `dev-db` æ•°æ®åº“ï¼Œç”¨æˆ·åä¸º `cook`ã€å¯†ç ä¸º `cookpassword`ï¼Œè¿™å’Œ docker-compose.yml ä¸­çš„å˜é‡æ˜¯ä¸€è‡´çš„ï¼Œå¦åˆ™ç™»å½•ä¸è¿›å»ã€‚

### 3.3 ç”Ÿæˆæ¨¡å‹ä¸è¿ç§»

å‡è®¾ä½ŸæŒæŸœè®©ç§€æ‰è®°å½•çš„ç”¨æˆ·ä¿¡æ¯å¦‚ä¸‹ï¼š

![User è¡¨ Excel æ¨¡æ‹Ÿ.png](https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/44af855c09a140cc91ca940919ee6fa3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I-g6JCd55qE6Jyc:q75.awebp?rk3s=f64ab15b&x-expires=1761693334&x-signature=%2BuAKpElxmEigcBsXwDfCaX%2BDq4Y%3D)

User è¡¨ Excel æ¨¡æ‹Ÿ

è¿™äº›å†…å®¹åœ¨æ•°æ®åº“ä¸­æ˜¯ä¸€å¼  User è¡¨ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ schema.prisma æ–‡ä»¶ä¸­å®šä¹‰è¿™æ ·çš„æ¨¡å‹ï¼š

```kotlin
model User {
  id        Int      @id @default(autoincrement())
  email     String   @unique
  name      String?
  createdAt DateTime @default(now())
}
```

- `model User`ï¼šæ¨¡å‹çš„åç§°ä¸º Userã€‚
- `id`ï¼šè¿™æ˜¯ä¸€ä¸ªæ•´å‹ï¼ˆ`Int`ï¼‰å­—æ®µï¼Œç”¨æ¥å”¯ä¸€æ ‡è¯†æ¯ä¸ªç”¨æˆ·ã€‚å®ƒè¢«æ ‡è®°ä¸º`@id`ï¼Œè¿™æ„å‘³ç€å®ƒæ˜¯è¿™ä¸ªæ¨¡å‹çš„ä¸»é”®ã€‚`@default(autoincrement())`è¡¨ç¤ºæ¯å½“åˆ›å»ºä¸€ä¸ªæ–°è®°å½•æ—¶ï¼Œè¿™ä¸ªå­—æ®µçš„å€¼ä¼šè‡ªåŠ¨é€’å¢ã€‚
- `email`ï¼šè¿™æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ç±»å‹ï¼ˆ`String`ï¼‰çš„å­—æ®µï¼Œç”¨æ¥å­˜å‚¨ç”¨æˆ·çš„ç”µå­é‚®ä»¶åœ°å€ã€‚`@unique`ä¿®é¥°ç¬¦ç¡®ä¿äº†æ¯ä¸ªç”¨æˆ·çš„ç”µå­é‚®ä»¶åœ°å€æ˜¯å”¯ä¸€çš„ï¼Œå³ä¸å…è®¸æœ‰é‡å¤çš„ç”µå­é‚®ä»¶åœ°å€ã€‚
- `name`ï¼šè¿™æ˜¯ä¸€ä¸ªå¯é€‰çš„å­—ç¬¦ä¸²å­—æ®µï¼Œç”¨æ¥å­˜å‚¨ç”¨æˆ·çš„åå­—ã€‚é—®å·(`?`)è¡¨ç¤ºè¿™ä¸ªå­—æ®µ**å¯ä»¥ä¸ºç©º**ã€‚
- `createdAt`ï¼šè¿™æ˜¯ä¸€ä¸ªæ—¥æœŸæ—¶é—´ç±»å‹çš„å­—æ®µï¼Œç”¨æ¥è®°å½•ç”¨æˆ·åˆ›å»ºçš„æ—¶é—´ã€‚`@default(now())`è¡¨ç¤ºæ¯å½“åˆ›å»ºä¸€ä¸ªæ–°ç”¨æˆ·æ—¶ï¼Œè¿™ä¸ªå­—æ®µä¼šè‡ªåŠ¨è®¾ç½®ä¸ºå½“å‰çš„æ—¥æœŸå’Œæ—¶é—´ã€‚

âš ï¸Â æ³¨æ„ï¼šä»¥ä¸Šå±äº Prisma çš„æ¨¡å‹å®šä¹‰æ–¹å¼ï¼Œå…·ä½“å¯å‚é˜… Prisma å®˜ç½‘ã€‚

å®šä¹‰å¥½çš„æ¨¡å‹å’Œæ•°æ®åº“è¿˜æ²¡æœ‰å…³è”ï¼Œå› æ­¤éœ€è¦è¿ç§»æ•°æ®åº“ï¼Œè¿™æ ·æ•°æ®åº“é‡Œæ‰æœ‰ User è¡¨ã€‚

è¿ç§»æ•°æ®åº“ï¼š

```csharp
npx prisma migrate dev --name init
```

- `migrate`: è¿™æ˜¯ Prisma CLI çš„ä¸€ä¸ªå­å‘½ä»¤ï¼Œç”¨äºç®¡ç†æ•°æ®åº“è¿ç§»ã€‚æ•°æ®åº“è¿ç§»æ˜¯æ•°æ®åº“æ¶æ„å˜æ›´çš„è¿‡ç¨‹ï¼Œå®ƒå…è®¸ä½ å°†æ•°æ®åº“æ¨¡å‹çš„æ›´æ”¹åº”ç”¨åˆ°å®é™…çš„æ•°æ®åº“ä¸­ã€‚
- `dev`: è¿™æ˜¯è¿ç§»å‘½ä»¤çš„ä¸€ä¸ªé€‰é¡¹ï¼Œå®ƒå‘Šè¯‰ Prisma åˆ›å»ºä¸€ä¸ªå¼€å‘è¿ç§»ã€‚å¼€å‘è¿ç§»é€šå¸¸ç”¨äºæœ¬åœ°å¼€å‘ç¯å¢ƒï¼Œå®ƒä»¬ä¸ä¼šåº”ç”¨åˆ°ç”Ÿäº§æ•°æ®åº“ä¸Šï¼Œè€Œæ˜¯ç”¨äºæµ‹è¯•å’Œå¼€å‘ç›®çš„ã€‚
- `--name init`: è¿™æ˜¯å‘½ä»¤çš„ä¸€ä¸ªå‚æ•°ï¼Œç”¨äºç»™è¿ç§»å‘½åã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œè¿ç§»è¢«å‘½åä¸º`init`ï¼Œè¿™é€šå¸¸è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªåˆå§‹åŒ–è¿ç§»ï¼Œå¯èƒ½æ˜¯ä¸ºäº†è®¾ç½®æ•°æ®åº“çš„åˆå§‹çŠ¶æ€ã€‚

![è¿ç§»æ•°æ®åº“.png](https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/be4ca88f72794e03b34ecb5d94a3a0dd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I-g6JCd55qE6Jyc:q75.awebp?rk3s=f64ab15b&x-expires=1761693334&x-signature=SP3Cx5Ovxl0YZp6tTz%2FRRK7GIRc%3D)

è¿™ä¸ªå‘½ä»¤ä¼šæ ¹æ®å½“å‰æ¨¡å‹ç”Ÿæˆ SQL è¿ç§»æ–‡ä»¶ï¼Œå¹¶è‡ªåŠ¨åº”ç”¨åˆ°æ•°æ®åº“ä¸­ã€‚ç°åœ¨æ•°æ®åº“å°±å’Œæˆ‘ä»¬çš„ schema æ–‡ä»¶åŒæ­¥å®Œæˆäº†ï¼Œè¿˜è‡ªåŠ¨ç”Ÿæˆäº† Prisma Clientã€‚

âš ï¸Â æ³¨æ„ï¼šæˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨ `npx prisma generate` æ¥æ‰‹åŠ¨ç”Ÿæˆ Prisma Clientã€‚

é€šè¿‡ VSC æ’ä»¶ SQLTools è¿æ¥æ•°æ®åº“å¯ä»¥çœ‹åˆ° User è¡¨å·²ç»æˆåŠŸåˆ›å»ºäº†ï¼š

![SQLTools æ’ä»¶ä¸­æŸ¥çœ‹æ•°æ®åº“.png](https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/70c2bdb1735d4c37a090561df79c214c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I-g6JCd55qE6Jyc:q75.awebp?rk3s=f64ab15b&x-expires=1761693334&x-signature=6Lp94mxP1RZk4UNk8EZ5NogLGTE%3D)

## 4\. æ•°æ®æ’­ç§

ä¸ºäº†éªŒè¯ Nest åº”ç”¨èƒ½å¦æˆåŠŸé›†æˆäº† Prismaï¼Œæˆ‘ä»¬å°†é€šè¿‡ Prisma Client è¿›è¡Œæ•°æ®æ’­ç§ï¼Œçœ‹èƒ½å¦ä¸æ•°æ®åº“äº¤äº’ã€‚

### 4.1 å¯è§†åŒ–æ•°æ®åº“

ç°åœ¨è¿è¡Œä¸€ä¸‹å‘½ä»¤å¯ä»¥åœ¨ 5555 ç«¯å£çœ‹åˆ°æ•°æ®åº“çš„å†…å®¹ï¼š

```
npx prisma studio
```

æ‰“å¼€åï¼ŒUser è¡¨çš„è®°å½•æ•°é‡ä¸º 0ã€‚

### 4.2 åˆ›å»º seed æ–‡ä»¶

é¦–å…ˆåœ¨ prisma ç›®å½•ä¸‹æ–°å»º seed.tsï¼š

```php
import { PrismaClient } from '@prisma/client';

const prisma = new PrismaClient();

async function main() {
  // åˆ é™¤ç°æœ‰çš„æ‰€æœ‰æ•°æ® (å¯é€‰)
  await prisma.user.deleteMany();

  // åˆ›å»ºç§å­æ•°æ®
  const users = await prisma.user.createMany({
    data: [
      {
        email: 'alice@example.com',
        name: 'Alice',
      },
      {
        email: 'bob@example.com',
        name: 'Bob',
      },
      {
        email: 'charlie@example.com',
        name: 'Charlie',
      },
    ],
  });

  console.log(`Seeded ${users.count} users`);
}

main()
  .then(async () => {
    await prisma.$disconnect();
  })
  .catch(async (e) => {
    console.error(e);
    await prisma.$disconnect();
    process.exit(1);
  });
```

è°ƒç”¨ prisma å®¢æˆ·ç«¯å®ä¾‹ï¼ˆ`prisma`ï¼‰æ‰¹é‡åˆ›å»º user ç”¨æˆ·ï¼Œè¿™äº›æ•°æ®å°†ä¼šçœŸå®åœ°è®°å½•åˆ°æ•°æ®åº“ä¸­ï¼Œåˆ›å»ºå®Œæˆåæ–­å¼€æ•°æ®åº“è¿æ¥ã€‚

### 4.3 è¿è¡Œ seed è„šæœ¬

åœ¨ package.json ä¸­åŠ å…¥è„šæœ¬ï¼š

```bash
{
  "scripts": {
+   "seed": "ts-node prisma/seed.ts",
+   "studio": "prisma studio"
  }
}
```

ç„¶åè¿è¡Œï¼š

```
npm run seed
```

![æ‰§è¡Œæ•°æ®æ’­ç§.png](https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/63eb2e2db97a4a06954896669522a58c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I-g6JCd55qE6Jyc:q75.awebp?rk3s=f64ab15b&x-expires=1761693334&x-signature=V3wLOAdiLwLAdsK0J3VVJexDPI0%3D)

æ¥ç€è¿è¡Œï¼š

```
npm run studio
```

![è®¿é—® prisma studio.png](https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/eb7171e6ddb048c28c9fc257a90b33ce~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I-g6JCd55qE6Jyc:q75.awebp?rk3s=f64ab15b&x-expires=1761693334&x-signature=VaNIMzo%2B9sxdOeeiWO3tgaZkjaY%3D)

å¯ä»¥çœ‹åˆ° User è¡¨ä¸­å·²ç»æœ‰å†…å®¹äº†ã€‚ï¼ˆ`id` ä» 4 å¼€å§‹æ˜¯å› ä¸ºç¬”è€…ä¹‹å‰æ‰§è¡Œè¿‡ä¸€æ¬¡äº†ï¼‰

## 5\. æ€»ç»“

é€šè¿‡æœ¬ç¯‡å†…å®¹ï¼Œå¤§å®¶å·²ç»å­¦ä¼šäº†å¦‚ä½•åˆå§‹åŒ– Prismaã€é…ç½®æ•°æ®åº“è¿æ¥ä»¥åŠæ•°æ®æ’­ç§ï¼Œæ­¤æ—¶ NestJS å·²ç»å¯ä»¥å’Œæ•°æ®åº“äº¤äº’äº†ï¼Œåœ¨ä¸‹ç¯‡ä¸­å°†ä¼šè¿›ä¸€æ­¥ä»‹ç»å¦‚ä½•åœ¨ä¸šåŠ¡é€»è¾‘å¤„ç†ä¸­ä½¿ç”¨ Prisma æ¥è§£å†³å®é™…é—®é¢˜ã€‚

---

created: 2025-10-22T19:48:07 (UTC +08:00)
tags: [å‰ç«¯,åç«¯,NestJSä¸­æ–‡æŠ€æœ¯ç¤¾åŒº,å‰ç«¯å¼€å‘ç¤¾åŒº,å‰ç«¯æŠ€æœ¯äº¤æµ,å‰ç«¯æ¡†æ¶æ•™ç¨‹,JavaScript å­¦ä¹ èµ„æº,CSS æŠ€å·§ä¸æœ€ä½³å®è·µ,HTML5 æœ€æ–°åŠ¨æ€,å‰ç«¯å·¥ç¨‹å¸ˆèŒä¸šå‘å±•,å¼€æºå‰ç«¯é¡¹ç›®,å‰ç«¯æŠ€æœ¯è¶‹åŠ¿]
source: https://juejin.cn/post/7418460243502792731
author: è èçš„èœœ

---

# NestJS ğŸ§‘ğŸ³Â å¨å­å¿…ä¿®è¯¾ï¼ˆå…­ï¼‰ï¼šPrisma é›†æˆï¼ˆä¸‹ï¼‰é€šè¿‡ Prisma é›†æˆç›¸å…³å†…å®¹ï¼Œå…¨é¢æŒæ¡å¦‚ä½•åœ¨ N - æ˜é‡‘

> ## Excerpt
>
> é€šè¿‡ Prisma é›†æˆç›¸å…³å†…å®¹ï¼Œå…¨é¢æŒæ¡å¦‚ä½•åœ¨ NestJS ä¸­ä½¿ç”¨ Prisma è¿›è¡Œå®é™…çš„æ•°æ®åº“é›†æˆã€‚---

## theme: fancy

1.  å‰è¨€

ä¸Šç¯‡è®²äº†å¦‚ä½•é›†æˆ Prismaï¼Œé‚£ä¹ˆå¦‚ä½•åœ¨ NestJS ä¸­æŠŠ Prisma çœŸæ­£ç”¨èµ·æ¥å‘¢ï¼Ÿè¿™ç¯‡å‘Šè¯‰ä½ ç­”æ¡ˆã€‚

æ¬¢è¿åŠ å…¥æŠ€æœ¯äº¤æµç¾¤https://jue

---

## 1\. å‰è¨€

ä¸Šç¯‡è®²äº†å¦‚ä½•é›†æˆ Prismaï¼Œé‚£ä¹ˆå¦‚ä½•åœ¨ NestJS ä¸­æŠŠ Prisma çœŸæ­£ç”¨èµ·æ¥å‘¢ï¼Ÿè¿™ç¯‡å‘Šè¯‰ä½ ç­”æ¡ˆã€‚

æ¬¢è¿åŠ å…¥[æŠ€æœ¯äº¤æµç¾¤](https://juejin.cn/user/2154698521972423/pins "https://juejin.cn/user/2154698521972423/pins")ã€‚

![image.png](https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dd5e4b8be907402d9d882517ff6a0e0c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I-g6JCd55qE6Jyc:q75.awebp?rk3s=f64ab15b&x-expires=1761687106&x-signature=L26X0bzb3O1JxkXQmNsOfaUgq68%3D)

1.  [NestJS ğŸ§‘ğŸ³Â  å¨å­å¿…ä¿®è¯¾ï¼ˆä¸€ï¼‰ï¼šåç«¯çš„æœ¬è´¨](https://juejin.cn/post/7407260232664186930 "https://juejin.cn/post/7407260232664186930")
2.  [NestJS ğŸ§‘ğŸ³Â å¨å­å¿…ä¿®è¯¾ï¼ˆäºŒï¼‰ï¼šé¡¹ç›®åˆ›å»º](https://juejin.cn/post/7408021285768445961 "https://juejin.cn/post/7408021285768445961")
3.  [NestJS ğŸ§‘ğŸ³Â å¨å­å¿…ä¿®è¯¾ï¼ˆä¸‰ï¼‰ï¼šæ§åˆ¶å™¨](https://juejin.cn/post/7408778862283096102 "https://juejin.cn/post/7408778862283096102")
4.  [NestJS ğŸ§‘ğŸ³Â å¨å­å¿…ä¿®è¯¾ï¼ˆå››ï¼‰ï¼šæœåŠ¡ç±»](https://juejin.cn/post/7416235834938212403 "https://juejin.cn/post/7416235834938212403")
5.  [NestJS ğŸ§‘ğŸ³Â å¨å­å¿…ä¿®è¯¾ï¼ˆäº”ï¼‰ï¼šPrisma é›†æˆï¼ˆä¸Šï¼‰](https://juejin.cn/post/7416908856868110374 "https://juejin.cn/post/7416908856868110374")
6.  [NestJS ğŸ§‘ğŸ³Â å¨å­å¿…ä¿®è¯¾ï¼ˆå…­ï¼‰ï¼šPrisma é›†æˆï¼ˆä¸‹ï¼‰](https://juejin.cn/post/7418460243502792731 "https://juejin.cn/post/7418460243502792731")
7.  [NestJS ğŸ§‘ğŸ³Â å¨å­å¿…ä¿®è¯¾ï¼ˆä¸ƒï¼‰ï¼šç®¡é“](https://juejin.cn/post/7419887372463554601 "https://juejin.cn/post/7419887372463554601")
8.  [NestJS ğŸ§‘ğŸ³Â å¨å­å¿…ä¿®è¯¾ï¼ˆå…«ï¼‰ï¼šå¼‚å¸¸è¿‡æ»¤å™¨](https://juejin.cn/post/7420272008146239514 "https://juejin.cn/post/7420272008146239514")

## 2\. å…±äº« Prisma æœåŠ¡

Prisma Client åœ¨ä¸åŒæ¥å£éƒ½ä¼šä½¿ç”¨åˆ°ï¼Œå€ŸåŠ© NestJS çš„ä¾èµ–æ³¨å…¥å¯ä»¥å°†å…¶æŠ½è±¡ä¸ºä¸€ä¸ªæœåŠ¡ä»¥å…±äº«ç»™å…¶ä»–çš„æ¨¡å—æˆ–æœåŠ¡ã€‚

```
nest generate service prisma
```

![ç”Ÿæˆ prisma æœåŠ¡ç±».png](https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/760651634f3c4e03a3507447beea74b1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I-g6JCd55qE6Jyc:q75.awebp?rk3s=f64ab15b&x-expires=1761687106&x-signature=9ppI3FFzS1bZtIWp%2FE674ck8nQo%3D)

### 2.1 å®šä¹‰ Prisma æœåŠ¡ç±»

ä¿®æ”¹ prisma.service.ts å¦‚ä¸‹ï¼š

```typescript
import { Injectable, OnModuleInit, OnModuleDestroy } from "@nestjs/common";
import { PrismaClient } from "@prisma/client";

@Injectable()
export class PrismaService
  extends PrismaClient
  implements OnModuleInit, OnModuleDestroy
{
  async onModuleInit() {
    await this.$connect();
  }

  async onModuleDestroy() {
    await this.$disconnect();
  }
}
```

- `extends PrismaClient`ï¼šå®šä¹‰äº†ä¸€ä¸ªåä¸º `PrismaService` çš„ç±»ï¼Œå®ƒç»§æ‰¿è‡ª `PrismaClient`ã€‚è¿™æ„å‘³ç€ `PrismaService` å°†æ‹¥æœ‰ Prisma Client çš„æ‰€æœ‰æ–¹æ³•å’Œå±æ€§ã€‚
- `implements OnModuleInit, OnModuleDestroy`ï¼š è¿™ä¸€è¡ŒæŒ‡å®š `PrismaService` ç±»å®ç°äº† `OnModuleInit` å’Œ `OnModuleDestroy` æ¥å£ã€‚è¿™æ„å‘³ç€è¿™ä¸ªç±»å°†æä¾›è¿™ä¸¤ä¸ªæ¥å£å®šä¹‰çš„æ–¹æ³•ï¼Œè¿™äº›æ–¹æ³•å°†åœ¨æ¨¡å—çš„ç”Ÿå‘½å‘¨æœŸçš„ç‰¹å®šæ—¶åˆ»è¢«è°ƒç”¨ã€‚
  - `onModuleInit` æ–¹æ³•å°†åœ¨æ¨¡å—åˆå§‹åŒ–æ—¶è¢«è°ƒç”¨ï¼Œæ‰§è¡Œ Prisma Client çš„ `$connect` æ–¹æ³•æ¥å»ºç«‹æ•°æ®åº“è¿æ¥
  - `onModuleDestroy` æ–¹æ³•å°†åœ¨æ¨¡å—é”€æ¯æ—¶è¢«è°ƒç”¨ï¼Œæ‰§è¡Œ Prisma Client çš„`$disconnect`æ–¹æ³•æ¥å…³é—­æ•°æ®åº“è¿æ¥ã€‚

å¦å¤–ï¼Œåœ¨ app.module.ts çš„ `providers` æ•°ç»„ä¸­è‡ªåŠ¨æ³¨å†Œäº†è¿™ä¸ªæœåŠ¡ç±»ï¼ŒæŠŠè¿™é‡Œçš„ `PrismaService` ç§»é™¤ã€‚

### 2.2 æ³¨å…¥ä¸æ³¨å†Œ Prisma æœåŠ¡ç±»

è¿è¡Œä»¥ä¸‹å‘½ä»¤åˆ›å»º users èµ„æºï¼š

```bash
nest g resource users
```

![ç”Ÿæˆ users èµ„æº.png](https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/36eb7e82dc43451b986c5161415942e8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I-g6JCd55qE6Jyc:q75.awebp?rk3s=f64ab15b&x-expires=1761687106&x-signature=RLtj7xdHjAZZso%2FW6wMLJO2KfLY%3D)

ç›´æ¥æ ¸å¿ƒæ¥åˆ° users.service.ts ä¸­æ³¨å…¥ Prisma æœåŠ¡ç±»ï¼Œä½¿ä¹‹å¯ä»¥çœŸå®åœ°ä¸æ•°æ®åº“äº¤äº’ã€‚

```typescript
+ import { PrismaService } from '../prisma/prisma.service';

@Injectable()
export class UsersService {
+  constructor(private readonly prisma: PrismaService) {}
}
```

ä½†æ˜¯ï¼æ³¨æ„åœ¨NestJSä¸­ï¼Œæ¨¡å—çš„ä½œç”¨åŸŸå†³å®šäº†æœåŠ¡ã€æ§åˆ¶å™¨ã€å®ˆå«ã€æ‹¦æˆªå™¨ç­‰ç»„ä»¶çš„å¯è§æ€§å’Œå¯æ³¨å…¥æ€§ã€‚å› æ­¤éœ€è¦å°† `PrismaService` ç±»æ³¨å†Œè¿› user.module.ts çš„ `providers` ä¸­ï¼š

```perl
// ...
import { PrismaService } from 'src/prisma/prisma.service';

@Module({
  // ...
  providers: [UsersService, PrismaService],
})
export class UsersModule {}
```

è¿™æ ·ï¼Œusers æ¨¡å—è¿™ä¸ªä½œç”¨åŸŸä¸‹çš„æœåŠ¡å°±èƒ½ä½¿ç”¨ `PrismaService` ç±»äº†ã€‚

### 2.3 è°ƒç”¨ Prisma Client å®ä¾‹å®Œæˆ CRUD

é»˜è®¤ç¤ºä¾‹ä¸­è¿”å›äº†å­—ç¬¦ä¸²ï¼Œç°åœ¨ä¿®æ”¹å¦‚ä¸‹ï¼š

```kotlin
// ...

@Injectable()
export class UsersService {
  constructor(private readonly prisma: PrismaService) {}

  create(createUserDto: CreateUserDto) {
-   return 'This action adds a new user';
+   return this.prisma.user.create({
+      data: createUserDto,
+    });
  }

  findAll() {
-    return `This action returns all users`;
+    return this.prisma.user.findMany();
  }

  findOne(id: number) {
-    return `This action returns a #${id} user`;
+    return this.prisma.user.findUnique({
+      where: { id },
+    });
  }

  update(id: number, updateUserDto: UpdateUserDto) {
-    return `This action updates a #${id} user`;
+return this.prisma.user.update({
+      where: { id },
+      data: updateUserDto,
+    });
  }

  remove(id: number) {
-    return `This action removes a #${id} user`;
+return this.prisma.user.delete({
+      where: { id },
+    });
  }
}
```

`UsersService` ç±»ä¸­çš„ `create`ã€`findAll`ã€`findOne`ã€`update`ã€`remove` åˆ†åˆ«å®ç°äº†åˆ›å»ºè®°å½•ã€è¯»å–è®°å½•ã€è¯»å–å•ä¸ªè®°å½•ã€æ›´æ–°è®°å½•ã€åˆ é™¤è®°å½•ã€‚

`this.prisma` å°±æ˜¯ Prisma Client å®ä¾‹çš„å¼•ç”¨ï¼ŒPrisma Client æ˜¯Prisma ORMçš„å®¢æˆ·ç«¯åº“ï¼Œå®ƒæä¾›äº†ä¸æ•°æ®åº“äº¤äº’çš„æ–¹æ³•ã€‚

é€šè¿‡ `.user` å°±èƒ½å”¤èµ· Prisma Client ä¸­å®šä¹‰çš„æ¨¡å‹å¼•ç”¨ï¼Œuser æ˜¯æ¨¡å‹çš„åç§°ï¼Œå®ƒå¯¹åº”äºæ•°æ®åº“ä¸­çš„ä¸€ä¸ªè¡¨ã€‚

- `this.prisma.user.create`Â æ˜¯ Prisma Client æä¾›çš„æ–¹æ³•ï¼Œç”¨äºåœ¨æ•°æ®åº“ä¸­åˆ›å»ºæ–°çš„è®°å½•ã€‚`{ data: createUserDto }`Â æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼ŒæŒ‡å®šäº†è¦åˆ›å»ºçš„æ•°æ®ã€‚è¿™é‡Œçš„Â `data`Â å±æ€§åŒ…å«äº†ç”¨æˆ·çš„æ‰€æœ‰ä¿¡æ¯ï¼Œè¿™äº›ä¿¡æ¯å°†è¢«æ’å…¥åˆ°æ•°æ®åº“ä¸­ã€‚
- `this.prisma.user.findMany`Â ç”¨äºæŸ¥è¯¢æ•°æ®åº“ä¸­çš„å¤šæ¡è®°å½•ï¼Œè¿”å›ä¸€ä¸ªåŒ…å«æ‰€æœ‰ç”¨æˆ·è®°å½•çš„æ•°ç»„ã€‚
- `this.prisma.user.findUnique`Â ç”¨äºæŸ¥æ‰¾æ•°æ®åº“ä¸­çš„ä¸€æ¡ç‰¹å®šè®°å½•ã€‚`{ where: { id } }`Â æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼ŒæŒ‡å®šäº†æŸ¥æ‰¾æ¡ä»¶ã€‚è¿™é‡Œçš„Â `where`Â å±æ€§å®šä¹‰äº†æŸ¥æ‰¾è®°å½•çš„æ¡ä»¶ï¼Œå³ ID å¿…é¡»ä¸æä¾›çš„Â `id`Â å‚æ•°åŒ¹é…ã€‚
- `this.prisma.user.update`Â ç”¨äºæ›´æ–°æ•°æ®åº“ä¸­çš„è®°å½•ã€‚`{ where: { id }, data: updateUserDto }`Â æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼ŒæŒ‡å®šäº†æ›´æ–°çš„æ¡ä»¶å’Œæ•°æ®ã€‚`where`Â å±æ€§å®šä¹‰äº†è¦æ›´æ–°çš„è®°å½•çš„æ¡ä»¶ï¼Œè€ŒÂ `data`Â å±æ€§åŒ…å«äº†è¦æ›´æ–°çš„æ•°æ®ã€‚
- `this.prisma.user.delete`Â ç”¨äºä»æ•°æ®åº“ä¸­åˆ é™¤ä¸€æ¡è®°å½•ã€‚`{ where: { id } }`Â æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼ŒæŒ‡å®šäº†è¦åˆ é™¤çš„è®°å½•çš„æ¡ä»¶ã€‚è¿™é‡Œçš„Â `where`Â å±æ€§å®šä¹‰äº†è¦åˆ é™¤çš„è®°å½•çš„ IDã€‚

å€¼å¾—æ³¨æ„çš„æ˜¯ createUserDto çš„ç±»å‹ CreateUserDto ä»¥åŠ updateUserDto çš„ç±»å‹ UpdateUserDtoï¼Œè¿™ç±» dto æ–‡ä»¶ç”¨äº**å®šä¹‰è¯·æ±‚å‚æ•°çš„ç±»å‹**ï¼Œä¾‹å¦‚åˆ›å»ºå’Œæ›´æ–° user æ—¶ï¼Œéœ€è¦æ¥æ”¶çš„æ•°æ®ç±»å‹æ˜¯å·²ç»å†³å®šçš„ï¼š

```typescript
// src/users/dto/create-user.dto.ts
export class CreateUserDto {
  name?: string;
  email: string;
  password: string;
}

// src/users/dto/update-user.dto.ts
import { PartialType } from "@nestjs/mapped-types";
import { CreateUserDto } from "./create-user.dto";

export class UpdateUserDto extends PartialType(CreateUserDto) {}
```

- `PartialType(CreateUserDto)` æ˜¯ä¸€ä¸ªæ³›å‹è°ƒç”¨ï¼Œå®ƒå°† `CreateUserDto` ä¸­çš„æ‰€æœ‰å­—æ®µè½¬æ¢ä¸ºå¯é€‰å­—æ®µã€‚è¿™æ„å‘³ç€åœ¨æ›´æ–°ç”¨æˆ·ä¿¡æ¯æ—¶ï¼Œç”¨æˆ·å¯ä»¥ä¼ é€’ä»»ä½•å­—æ®µï¼Œä¹Ÿå¯ä»¥ä¸ä¼ é€’ä»»ä½•å­—æ®µï¼Œæ›´åŠ çµæ´»ã€‚
- `extends PartialType(CreateUserDto)` åˆ™è¡¨ç¤º `UpdateUserDto` ç»§æ‰¿è‡ª `PartialType(CreateUserDto)`ã€‚

è®¿é—® [http://localhost:3000/users](https://link.juejin.cn/?target=http%3A%2F%2Flocalhost%3A3000%2Fusers "http://localhost:3000/users") å¯ä»¥çœ‹åˆ°ç»“æœï¼š

![è·å–æ‰€æœ‰ç”¨æˆ·.png](https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7573599a6c634c888df63cda34ea6226~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I-g6JCd55qE6Jyc:q75.awebp?rk3s=f64ab15b&x-expires=1761687106&x-signature=cOjUAcYiKw0jozCBCO7yvfdstpY%3D)

## 3\. é«˜çº§æŸ¥è¯¢

Prisma è¿˜æ”¯æŒå¤æ‚çš„æŸ¥è¯¢æ“ä½œï¼Œå¦‚å…³è”æŸ¥è¯¢ã€åˆ†é¡µã€è¿‡æ»¤ç­‰ã€‚

### 3.1 å…³è”æŸ¥è¯¢ï¼ˆ**Relational Queriesï¼‰**

æ¯ä¸€ä¸ªç”¨æˆ·éƒ½æœ‰è‡ªå·±çš„è®¢å•è®°å½•ï¼Œè¿™æ˜¯å…¸å‹çš„ **one-to-many** å…³è”ï¼ˆä¸€å¯¹å¤šï¼‰å…³ç³»ï¼š

![ä¸€å¯¹å¤šå…³è”å…³ç³».png](https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/da09fe3524fe4b3b9ffce0d953382565~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I-g6JCd55qE6Jyc:q75.awebp?rk3s=f64ab15b&x-expires=1761687106&x-signature=wKUTBDXUxt%2FPLS7hasDB%2BkqjlqU%3D)

ä¸Šå›¾ä¸­å¯ä»¥çœ‹å‡º User è¡¨ä¸­çš„è·¯äººç”²ï¼ˆ`id` ä¸º 1ï¼‰æ‹¥æœ‰ä¸‰ç¬”è®¢å•ï¼Œåˆ†åˆ«å¯¹åº” Order è¡¨ä¸­ `id` ä¸º 1ã€2ã€4 çš„è®°å½•ã€‚

æ¨¡å‹å®šä¹‰å¦‚ä¸‹ï¼š

```kotlin
model User {
  id        Int      @id @default(autoincrement())
  email     String   @unique
  name      String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  orders    Order[]
}

model Order {
  id        Int      @id @default(autoincrement())
  userId    Int
  user      User     @relation(fields: [userId], references: [id])
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
```

åœ¨ User æ¨¡å‹å®šä¹‰ä¸­æ–°å¢äº†ä¸¤ä¸ªå­—æ®µï¼š

- `updatedAt`ï¼šæ—¥æœŸæ—¶é—´å­—æ®µï¼Œè®°å½•ç”¨æˆ·è®°å½•æœ€åä¸€æ¬¡æ›´æ–°çš„æ—¶é—´ã€‚å®ƒè¢«æ ‡è®°ä¸º `@updatedAt`ï¼ŒPrisma ä¼šè‡ªåŠ¨åœ¨æ¯æ¬¡æ›´æ–°ç”¨æˆ·è®°å½•æ—¶è®¾ç½®è¿™ä¸ªå­—æ®µã€‚
- `orders`ï¼šå…³ç³»å­—æ®µï¼Œè¡¨ç¤ºç”¨æˆ·å’Œè®¢å•ä¹‹é—´çš„å…³ç³»ã€‚å®ƒæ˜¯ä¸€ä¸ª `Order` æ•°ç»„ï¼Œæ„å‘³ç€ä¸€ä¸ªç”¨æˆ·å¯ä»¥æœ‰å¤šä¸ªè®¢å•ã€‚

æ–°å»ºçš„ Order æ¨¡å‹çš„ `userId` å’Œ `user` éœ€è¦è¯´æ˜ï¼š

- `userId`ï¼šæ•´å‹å­—æ®µï¼Œç”¨ä½œå¤–é”®ï¼Œå¼•ç”¨ User æ¨¡å‹çš„ `id` å­—æ®µã€‚å®ƒç”¨äºå»ºç«‹ User å’Œ Order ä¹‹é—´çš„å…³ç³»ã€‚
- `user`ï¼šå…³ç³»å­—æ®µï¼Œè¡¨ç¤ºè®¢å•å’Œç”¨æˆ·ä¹‹é—´çš„å…³ç³»ã€‚å®ƒè¢«æ ‡è®°ä¸º `@relation`ï¼ŒæŒ‡å®šäº†å…³ç³»çš„ç»†èŠ‚ï¼ŒåŒ…æ‹¬ä½¿ç”¨çš„å­—æ®µï¼ˆ`fields: [userId]`ï¼‰å’Œå¼•ç”¨çš„å­—æ®µï¼ˆ`references: [id]`ï¼‰ã€‚è¿™æ„å‘³ç€æ¯ä¸ªè®¢å•éƒ½å…³è”åˆ°ä¸€ä¸ªç”¨æˆ·ï¼Œå¯ä»¥é€šè¿‡ `userId` å­—æ®µæ¥è®¿é—®ã€‚

âš ï¸Â æ³¨æ„ï¼šåœ¨ Prisma ä¸­ï¼Œå…³ç³»å­—æ®µç”¨äºå®šä¹‰æ¨¡å‹é—´çš„é€»è¾‘å…³ç³»ï¼Œè€Œä¸æ˜¯å­˜å‚¨å®é™…çš„æ•°æ®ï¼Œå› æ­¤å¹¶ä¸ä¼šçœŸå®å‡ºç°åœ¨æ•°æ®è¡¨ä¸­ã€‚å®é™…çš„å…³ç³»æ˜¯é€šè¿‡åœ¨ç›¸å…³æ¨¡å‹çš„è¡¨ä¸­ä½¿ç”¨å¤–é”®æ¥å®ç°çš„ï¼Œæ¯”å¦‚ä¸Šé¢çš„ `userId` å°±æ˜¯ä¸€ä¸ªå¤–é”®ï¼Œå®ƒå¼•ç”¨ User æ¨¡å‹çš„ `id` å­—æ®µã€‚

æ¯æ¬¡ä¿®æ”¹å¥½æ¨¡å‹å®šä¹‰åï¼Œéœ€è¦è¿ç§»æ•°æ®åº“ï¼š

```csharp
npx prisma migrate dev --name add-orders
```

åœ¨æ‰§è¡Œåä¼šæœ‰æŠ¥é”™ï¼š

> Step 0 Added the required column `updatedAt` to the `User` table without a default value. There are 3 rows in this table, it is not possible to execute this step.
>
> You can use prisma migrate dev --create-only to create the migration file, and manually modify it to address the underlying issue(s). Then run prisma migrate dev to apply it and verify it works.

æ˜¯è¯´ User è¡¨é‡Œæœ¬æ¥æ²¡æœ‰ `updatedAt` å­—æ®µï¼Œéœ€è¦ä¸€ä¸ªé»˜è®¤å€¼ã€‚åŒæ—¶å®ƒç»™å‡ºäº†è§£å†³åŠæ³•ï¼Œè®©æˆ‘ä»¬ä½¿ç”¨ `prisma migrate dev --create-only` æ¥åˆ›å»ºä¸€ä¸ªè¿ç§»æ–‡ä»¶ï¼Œç„¶åæ‰‹åŠ¨ä¿®æ”¹ç»™ `updatedAt` ä¸€ä¸ªé»˜è®¤å€¼ï¼Œç„¶åå†è¿è¡Œ `prisma migrate dev` æ‰è¡Œã€‚

åœ¨è¿è¡Œ `prisma migrate dev --name add-orders --create-only` åç”Ÿæˆäº†ä¸€ä¸ªè¿ç§»æ–‡ä»¶ï¼š

![è¿ç§»æ–‡ä»¶.png](https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a028eb2ebd44426ba9d7ee5ec6f5865f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I-g6JCd55qE6Jyc:q75.awebp?rk3s=f64ab15b&x-expires=1761687106&x-signature=2SPHQLT26BR%2Fo8TX8qM5XcLNWQU%3D)

è¿›å…¥ migration.sqlï¼š

```sql
/*
  Warnings:

  - Added the required column `updatedAt` to the `User` table without a default value. This is not possible if the table is not empty.

*/
-- AlterTable
ALTER TABLE "User" ADD COLUMN     "updatedAt" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP;
```

åœ¨ Warings éƒ¨åˆ†æç¤ºè¦åŠ ä¸Šé»˜è®¤å€¼ï¼šåœ¨ `ALTER TABLE` æ‰€åœ¨è¡Œçš„æœ€åè¿½åŠ  `DEFAULT CURRENT_TIMESTAMP`ã€‚è¡¨ç¤º `updatedAt` çš„é»˜è®¤å€¼ä¸ºå½“å‰æ—¶é—´æˆ³ã€‚

ä¿®æ”¹å®Œ sql æ–‡ä»¶åè¿è¡Œï¼š

```csharp
npx prisma migrate dev --name add-orders
```

è¿™æ ·å°±å®Œæˆè¿ç§»äº†ã€‚

æ¯æ¬¡å®Œæˆæ•°æ®åº“è¿ç§»åï¼Œæœ€å¥½éƒ½æ‰§è¡Œä¸€æ¬¡ `npx prisma generate` æ¥æ›´æ–° Prisma å®¢æˆ·ç«¯ã€‚

âš ï¸Â æ³¨æ„ï¼šåœ¨ç”Ÿäº§ç¯å¢ƒä¸­è¿›è¡Œè¿™ç§æ›´æ”¹æ—¶è¦æ ¼å¤–å°å¿ƒï¼Œå¹¶ç¡®ä¿åœ¨åº”ç”¨æ›´æ”¹ä¹‹å‰å¤‡ä»½æ•°æ®ã€‚

å…³è”æŸ¥è¯¢çš„ç›®çš„æ˜¯ï¼šè·å–ç”¨æˆ·ä¿¡æ¯çš„åŒæ—¶å¾—åˆ°ä»–çš„è®¢å•ã€‚

```typescript
// users.service.ts
import { PrismaService } from '../prisma/prisma.service';

@Injectable()
export class UsersService {
  constructor(private readonly prisma: PrismaService) {}

  findOne(id: number) {
    return this.prisma.user.findUnique({
      where: { id },
+      include: {
+        orders: true,
+      },
    });
  }
}
```

`include`ï¼šè¿™æ˜¯ä¸€ä¸ªåŒ…å«é€‰é¡¹å¯¹è±¡ï¼Œç”¨äºæŒ‡å®šåœ¨æŸ¥è¯¢æ—¶åº”è¯¥åŠ è½½å“ªäº›å…³è”æ•°æ®ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ`orders: true`Â è¡¨ç¤ºåº”è¯¥åŠ è½½ä¸æ‰¾åˆ°çš„ç”¨æˆ·å…³è”çš„æ‰€æœ‰è®¢å•ã€‚

è®¿é—® [http://localhost:3000/users/4](https://link.juejin.cn/?target=http%3A%2F%2Flocalhost%3A3000%2Fusers%2F4 "http://localhost:3000/users/4") çš„ç»“æœï¼š

![è·å– id ä¸º 4 çš„ç”¨æˆ·ä¿¡æ¯.png](https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b7beb7aa9cdc42fbbc7071b1bd38969e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I-g6JCd55qE6Jyc:q75.awebp?rk3s=f64ab15b&x-expires=1761687106&x-signature=t%2BDQfFeLniyeuKngsbr%2FSqU9yQE%3D)

### 3.2 åˆ†é¡µï¼ˆ**Paginationï¼‰**

Prisma æä¾›äº† `skip` å’Œ `take` å‚æ•°ï¼Œç”¨äºå®ç°åˆ†é¡µåŠŸèƒ½ã€‚

å‰ç«¯éœ€è¦ä¼ é€’é¡µç  `pageNum` å’Œé¡µé¢æ•°æ®æ‰¿è½½æ•°é‡ `pageSize`ï¼š

```less
// users.controller.ts
@Controller('users')
export class UsersController {
  constructor(private readonly usersService: UsersService) {}

  @Get()
  findAll(
    @Query('pageNum') pageNum?: number,
    @Query('pageSize') pageSize?: number,
  ) {
    return this.usersService.findAll(pageNum, pageSize);
  }
}
```

```typescript
// users.service.ts
@Injectable()
export class UsersService {
  constructor(private readonly prisma: PrismaService) {}

  async findAll(pageNum: number = 1, pageSize: number = 10) {
    pageNum = Math.max(1, pageNum);
    pageSize = Math.max(1, pageSize);

    const skip = (pageNum - 1) * pageSize;

    const [total, users] = await Promise.all([
      this.prisma.user.count(),
      this.prisma.user.findMany({
        skip,
        take: pageSize,
        orderBy: {
          id: "asc",
        },
      }),
    ]);

    return {
      users,
      meta: {
        total,
        pageNum,
        pageSize,
        totalPages: Math.ceil(total / pageSize),
      },
    };
  }
}
```

- `pageNum`Â å’ŒÂ `pageSize`Â æ˜¯æ–¹æ³•çš„å‚æ•°ï¼Œåˆ†åˆ«è¡¨ç¤ºè¯·æ±‚çš„é¡µç å’Œæ¯é¡µçš„è®°å½•æ•°ã€‚å®ƒä»¬éƒ½æœ‰é»˜è®¤å€¼ï¼Œ`pageNum`Â é»˜è®¤ä¸º 1ï¼Œ`pageSize`Â é»˜è®¤ä¸º 10ã€‚
- `pageNum = Math.max(1, pageNum);` å’Œ `pageSize = Math.max(1, pageSize);`ï¼šè¿™ä¸¤è¡Œä»£ç ç¡®ä¿Â `pageNum`Â å’ŒÂ `pageSize`Â çš„å€¼è‡³å°‘ä¸º 1ï¼Œé˜²æ­¢å‡ºç°è´Ÿæ•°æˆ–é›¶çš„æƒ…å†µã€‚
- `skip`ï¼šè®¡ç®—åœ¨åˆ†é¡µæŸ¥è¯¢ä¸­éœ€è¦è·³è¿‡çš„è®°å½•æ•°ã€‚
- `const [total, users] = await Promise.all([ ... ]);`ï¼šä½¿ç”¨Â `Promise.all`Â åŒæ—¶æ‰§è¡Œä¸¤ä¸ªå¼‚æ­¥æ“ä½œï¼šè®¡ç®—æ€»è®°å½•æ•°å’Œè·å–å½“å‰é¡µçš„ç”¨æˆ·æ•°æ®ã€‚
  - `total`Â æ˜¯æ•°æ®åº“ä¸­ç”¨æˆ·è®°å½•çš„æ€»æ•°ã€‚
  - `users`Â æ˜¯å½“å‰é¡µçš„ç”¨æˆ·æ•°æ®ã€‚
- `this.prisma.user.count()`ï¼šè°ƒç”¨Â `PrismaService`Â çš„Â `count`Â æ–¹æ³•æ¥è·å–ç”¨æˆ·è¡¨ä¸­çš„æ€»è®°å½•æ•°ã€‚
- `orderBy: { id: 'asc' }`Â ç”¨äºæŒ‡å®šè¿”å›è®°å½•çš„æ’åºæ–¹å¼ï¼Œè¿™é‡ŒæŒ‰ç…§Â `id`Â å­—æ®µå‡åºæ’åºã€‚

[http://localhost:3000/users](https://link.juejin.cn/?target=http%3A%2F%2Flocalhost%3A3000%2Fusers "http://localhost:3000/users") å¦‚å›¾ï¼š

![åˆ†é¡µæŸ¥è¯¢æ‰€æœ‰ç”¨æˆ·.png](https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f374a0368e774e0c868998877252d0ed~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I-g6JCd55qE6Jyc:q75.awebp?rk3s=f64ab15b&x-expires=1761687106&x-signature=dph%2BAc%2FszrA1ToaodbdnH4v5ICA%3D)

[http://localhost:3000/users?pageNum=1&pageSize=2](https://link.juejin.cn/?target=http%3A%2F%2Flocalhost%3A3000%2Fusers%3FpageNum%3D1%26pageSize%3D2 "http://localhost:3000/users?pageNum=1&pageSize=2") å¦‚å›¾ï¼š

![åˆ†é¡µæŸ¥è¯¢.png](https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9d2874382189412caf415d799a7dc2a3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I-g6JCd55qE6Jyc:q75.awebp?rk3s=f64ab15b&x-expires=1761687106&x-signature=bZPMV0CkBR8a48kkp69fYKW7TAA%3D)

### 3.3 è¿‡æ»¤ï¼ˆ**Filteringï¼‰**

åœ¨ä¹‹å‰é€šè¿‡ id èƒ½å¤Ÿè¿‡æ»¤å‡ºæ»¡è¶³è¦æ±‚çš„ç”¨æˆ·ï¼Œç°åœ¨çœ‹çœ‹æ›´ä¸ºé«˜çº§çš„è¿‡æ»¤æ–¹æ³•ã€‚ä½¿ç”¨ where å®ç°æ¨¡ç³ŠæŸ¥è¯¢ã€‚

æ·»åŠ  /users/search æ¥å£ï¼Œå‰ç«¯éœ€è¦ä¼  `query` è¿‡æ¥ï¼š

```less
// users.controller.ts
@Controller('users')
export class UsersController {
  constructor(private readonly usersService: UsersService) {}

  @Get('search')
  search(@Query('query') query: string) {
    return this.usersService.searchUsers(query);
  }
}
```

æ·»åŠ æ¨¡ç³ŠæŸ¥è¯¢ä¸šåŠ¡é€»è¾‘ï¼š

```php
// users.service.ts
@Injectable()
export class UsersService {
  constructor(private readonly prisma: PrismaService) {}

  async searchUsers(query: string) {
    return this.prisma.user.findMany({
      where: {
        OR: [{ name: { contains: query } }, { email: { contains: query } }],
      },
    });
  }
}
```

- `query`Â å‚æ•°æ˜¯ç”¨æˆ·è¾“å…¥çš„æœç´¢å­—ç¬¦ä¸²
- `where: { OR: [{ name: { contains: query } }, { email: { contains: query } }] }`ï¼š
  - `where`Â å±æ€§å®šä¹‰äº†æŸ¥è¯¢çš„è¿‡æ»¤æ¡ä»¶ã€‚
  - `OR`Â æ˜¯ä¸€ä¸ªé€»è¾‘æ“ä½œç¬¦ï¼Œè¡¨ç¤ºæ»¡è¶³æ•°ç»„ä¸­ä»»æ„ä¸€ä¸ªæ¡ä»¶çš„è®°å½•éƒ½åº”è¯¥è¢«æ£€ç´¢å‡ºæ¥ã€‚
  - ç¬¬ä¸€ä¸ªæ¡ä»¶æ˜¯Â `name`Â å­—æ®µåŒ…å«Â `query`Â å­—ç¬¦ä¸²ï¼Œä½¿ç”¨äº†Â `contains`Â è¿‡æ»¤å™¨ï¼Œè¡¨ç¤ºæœç´¢Â `name`Â å­—æ®µä¸­åŒ…å«ç»™å®šÂ `query`Â å­—ç¬¦ä¸²çš„ç”¨æˆ·ã€‚
  - ç¬¬äºŒä¸ªæ¡ä»¶æ˜¯Â `email`Â å­—æ®µåŒ…å«Â `query`Â å­—ç¬¦ä¸²ï¼ŒåŒæ ·ä½¿ç”¨äº†Â `contains`Â è¿‡æ»¤å™¨ï¼Œè¡¨ç¤ºæœç´¢Â `email`Â å­—æ®µä¸­åŒ…å«ç»™å®šÂ `query`Â å­—ç¬¦ä¸²çš„ç”¨æˆ·ã€‚

[http://localhost:3000/users/search?query=bo](https://link.juejin.cn/?target=http%3A%2F%2Flocalhost%3A3000%2Fusers%2Fsearch%3Fquery%3Dbo "http://localhost:3000/users/search?query=bo") å¦‚å›¾ï¼š

![æ¨¡ç³Šæœç´¢.png](https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8c2a02f1043b4628a35cc27b538c7984~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I-g6JCd55qE6Jyc:q75.awebp?rk3s=f64ab15b&x-expires=1761687106&x-signature=Bc%2BaJ2ZmhS3qZ8asWcqe3Alvk5Y%3D)

## 4\. æ€»ç»“

é€šè¿‡ Prisma é›†æˆç›¸å…³å†…å®¹ï¼Œå¤§å®¶å·²ç»çŸ¥é“å¦‚ä½•åœ¨ NestJS ä¸­ä½¿ç”¨ Prisma è¿›è¡Œå®é™…çš„æ•°æ®åº“é›†æˆã€‚æŒæ¡è¿™äº›æŠ€èƒ½åï¼Œèƒ½å¤Ÿæ›´é«˜æ•ˆåœ°å¼€å‘ä¸æ•°æ®åº“äº¤äº’çš„åŠŸèƒ½æ¨¡å—ï¼ŒåŒæ—¶ä¹Ÿæå‡äº†ä»£ç çš„å¯ç»´æŠ¤æ€§å’Œç¨³å®šæ€§ã€‚

---

created: 2025-10-22T19:48:14 (UTC +08:00)
tags: [å‰ç«¯,åç«¯,NestJSä¸­æ–‡æŠ€æœ¯ç¤¾åŒº,å‰ç«¯å¼€å‘ç¤¾åŒº,å‰ç«¯æŠ€æœ¯äº¤æµ,å‰ç«¯æ¡†æ¶æ•™ç¨‹,JavaScript å­¦ä¹ èµ„æº,CSS æŠ€å·§ä¸æœ€ä½³å®è·µ,HTML5 æœ€æ–°åŠ¨æ€,å‰ç«¯å·¥ç¨‹å¸ˆèŒä¸šå‘å±•,å¼€æºå‰ç«¯é¡¹ç›®,å‰ç«¯æŠ€æœ¯è¶‹åŠ¿]
source: https://juejin.cn/post/7419887372463554601
author: è èçš„èœœ

---

# NestJS ğŸ§‘ğŸ³Â å¨å­å¿…ä¿®è¯¾ï¼ˆä¸ƒï¼‰ï¼šç®¡é“åœ¨ NestJS æ¡†æ¶ä¸­åˆ©ç”¨ç®¡é“ï¼ˆPipesï¼‰å¯¹ä¼ å…¥çš„è¯·æ±‚å‚æ•°æ‰§è¡ŒéªŒè¯å’Œ - æ˜é‡‘

> ## Excerpt
>
> åœ¨ NestJS æ¡†æ¶ä¸­åˆ©ç”¨ç®¡é“ï¼ˆPipesï¼‰å¯¹ä¼ å…¥çš„è¯·æ±‚å‚æ•°æ‰§è¡ŒéªŒè¯å’Œè½¬æ¢ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œç®¡é“å¢å¼ºäº†æ•°æ®çš„å®‰å…¨æ€§ï¼Œé€šè¿‡è‡ªå®šä¹‰ç®¡é“æä¾›äº†é«˜åº¦çš„çµæ´»æ€§ã€‚

---

## 1\. å‰è¨€

åœ¨ä¸Šä¸€èŠ‚ä¸­æåˆ°äº† dto æ–‡ä»¶ï¼Œå®ƒç”¨äºå®šä¹‰è¯·æ±‚å‚æ•°çš„ç±»å‹ï¼Œè¿™æ˜¯å¯¹æ•°æ®è¾“å…¥çš„ä¸€ç§éªŒè¯ä¿æŠ¤ï¼Œä½¿å…¶ç¬¦åˆ API è§„èŒƒã€‚åœ¨ NestJS ä¸­æä¾›äº†ç®¡é“çš„ç‰¹æ€§ï¼Œå…è®¸è·¯ç”±å¤„ç†å™¨é€šè¿‡ç®¡é“å¯¹**è¾“å…¥å‚æ•°**è¿›è¡ŒéªŒè¯æˆ–æ˜¯è½¬æ¢ï¼š

- éªŒè¯ï¼šè¯„ä¼°è¾“å…¥æ•°æ®ï¼Œå¦‚æœæœ‰æ•ˆï¼Œåªéœ€å°†å…¶åŸæ ·ä¼ é€’ï¼›å¦åˆ™æŠ›å‡ºå¼‚å¸¸
- è½¬æ¢ï¼šå°†è¾“å…¥æ•°æ®è½¬æ¢ä¸ºæ‰€éœ€çš„å½¢å¼ï¼ˆä¾‹å¦‚ï¼šä»å­—ç¬¦ä¸²åˆ°æ•´æ•°ï¼‰

å…·ä½“æ¥è¯´ï¼Œç®¡é“å°†ä¼šåœ¨è·¯ç”±å¤„ç†å™¨çš„ `arguments` ä¸Šè¿è¡Œï¼ŒNest åœ¨è°ƒç”¨æ–¹æ³•ä¹‹å‰æ’å…¥ä¸€ä¸ªç®¡é“ï¼Œç®¡é“æ¥æ”¶æŒ‡å®šç»™è¯¥æ–¹æ³•çš„å‚æ•°å¹¶å¯¹å®ƒä»¬è¿›è¡Œæ“ä½œï¼Œç„¶åä½¿ç”¨éªŒè¯æˆ–è½¬æ¢è¿‡çš„å‚æ•°å»è°ƒç”¨è·¯ç”±å¤„ç†ç¨‹åºã€‚

âš ï¸Â æ³¨æ„ï¼šç®¡é“è™½ç„¶ç±»ä¼¼äºä¸­é—´ä»¶ï¼Œä½†æ˜¯åªè´Ÿè´£å¤„ç†è¾“å…¥å‚æ•°ï¼å› æ­¤ï¼Œæåˆ°ç®¡é“çš„åœ°æ–¹å°±è¦ç†è§£æ˜¯è¦å¤„ç†è¾“å…¥å‚æ•°äº†ã€‚

å‡è®¾æœ‰è·¯ç”± /exampleï¼Œä¸‹é¢æ˜¯éªŒè¯ç®¡é“çš„å·¥ä½œåŸç†ï¼š

![éªŒè¯ç®¡é“å·¥ä½œåŸç†.png](https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/02e6edde0e0a46ff9db50f497d11cf69~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I-g6JCd55qE6Jyc:q75.awebp?rk3s=f64ab15b&x-expires=1761399139&x-signature=EuJvJMCZLt4pLNKpjd5a3qri%2BXo%3D)

æ¬¢è¿åŠ å…¥[æŠ€æœ¯äº¤æµç¾¤](https://juejin.cn/user/2154698521972423/pins "https://juejin.cn/user/2154698521972423/pins")ã€‚

![image.png](https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dd5e4b8be907402d9d882517ff6a0e0c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I-g6JCd55qE6Jyc:q75.awebp?rk3s=f64ab15b&x-expires=1761399139&x-signature=4Y2%2BOaV49LjeammJUwTraFtGFZM%3D)

1.  [NestJS ğŸ§‘ğŸ³Â  å¨å­å¿…ä¿®è¯¾ï¼ˆä¸€ï¼‰ï¼šåç«¯çš„æœ¬è´¨](https://juejin.cn/post/7407260232664186930 "https://juejin.cn/post/7407260232664186930")
2.  [NestJS ğŸ§‘ğŸ³Â å¨å­å¿…ä¿®è¯¾ï¼ˆäºŒï¼‰ï¼šé¡¹ç›®åˆ›å»º](https://juejin.cn/post/7408021285768445961 "https://juejin.cn/post/7408021285768445961")
3.  [NestJS ğŸ§‘ğŸ³Â å¨å­å¿…ä¿®è¯¾ï¼ˆä¸‰ï¼‰ï¼šæ§åˆ¶å™¨](https://juejin.cn/post/7408778862283096102 "https://juejin.cn/post/7408778862283096102")
4.  [NestJS ğŸ§‘ğŸ³Â å¨å­å¿…ä¿®è¯¾ï¼ˆå››ï¼‰ï¼šæœåŠ¡ç±»](https://juejin.cn/post/7416235834938212403 "https://juejin.cn/post/7416235834938212403")
5.  [NestJS ğŸ§‘ğŸ³Â å¨å­å¿…ä¿®è¯¾ï¼ˆäº”ï¼‰ï¼šPrisma é›†æˆï¼ˆä¸Šï¼‰](https://juejin.cn/post/7416908856868110374 "https://juejin.cn/post/7416908856868110374")
6.  [NestJS ğŸ§‘ğŸ³Â å¨å­å¿…ä¿®è¯¾ï¼ˆå…­ï¼‰ï¼šPrisma é›†æˆï¼ˆä¸‹ï¼‰](https://juejin.cn/post/7418460243502792731 "https://juejin.cn/post/7418460243502792731")
7.  [NestJS ğŸ§‘ğŸ³Â å¨å­å¿…ä¿®è¯¾ï¼ˆä¸ƒï¼‰ï¼šç®¡é“](https://juejin.cn/post/7419887372463554601 "https://juejin.cn/post/7419887372463554601")
8.  [NestJS ğŸ§‘ğŸ³Â å¨å­å¿…ä¿®è¯¾ï¼ˆå…«ï¼‰ï¼šå¼‚å¸¸è¿‡æ»¤å™¨](https://juejin.cn/post/7420272008146239514 "https://juejin.cn/post/7420272008146239514")

## 2\. å†…ç½®ç®¡é“

NestJS å†…ç½®äº†ä¸€äº›å¸¸è§çš„ç®¡é“ã€‚

### 2.1 `ValidationPipe`

`ValidationPipe`ï¼šè¿™æ˜¯ä¸€ä¸ªé€šç”¨çš„ç®¡é“ï¼Œç”¨äºéªŒè¯ä¼ å…¥çš„æ•°æ®ã€‚å®ƒå¯ä»¥ä¸Â `class-validator`Â åŒ…ä¸€èµ·ä½¿ç”¨ï¼Œè‡ªåŠ¨éªŒè¯ DTO å¯¹è±¡çš„å±æ€§ï¼Œç¡®ä¿å®ƒä»¬ç¬¦åˆå®šä¹‰çš„éªŒè¯è§„åˆ™ã€‚

```typescript
import { Body, Controller, Post, UsePipes } from "@nestjs/common";
import { CreateUserDto } from "./dto/create-user.dto";
import { ValidationPipe } from "@nestjs/common";

@Controller("users")
export class UsersController {
  @Post()
  @UsePipes(new ValidationPipe({ whitelist: true, forbidNonWhitelisted: true }))
  createUser(@Body() createUserDto: CreateUserDto) {
    // ä¸šåŠ¡é€»è¾‘
  }
}
```

- `whitelist`ï¼šå¿½ç•¥ DTO ä¸­æœªå®šä¹‰çš„å±æ€§ã€‚
- `forbidNonWhitelisted`ï¼šå¦‚æœè¯·æ±‚ä½“ä¸­åŒ…å«æœªå®šä¹‰çš„å±æ€§ï¼ŒæŠ›å‡ºå¼‚å¸¸ã€‚

curl è¯·æ±‚ç¤ºä¾‹ï¼š

```swift
curl -X POST http://localhost:3000/users \
-H "Content-Type: application/json" \
-d '{"name": "John Doe", "email": "john.doe@example.com", "password": "securepassword123"}'
```

### 2.2 `ParseIntPipe`

`ParseIntPipe`ï¼šå°†ä¼ å…¥çš„å­—ç¬¦ä¸²è½¬æ¢ä¸ºæ•´æ•°ï¼Œå¦‚æœè½¬æ¢å¤±è´¥ï¼Œå®ƒå°†è¿”å›ä¸€ä¸ªé”™è¯¯ã€‚

```typescript
import { Controller, Get, Query, UsePipes } from "@nestjs/common";
import { ParseIntPipe } from "@nestjs/common";

@Controller("items")
export class ItemsController {
  @Get()
  getItems(@Query("page", ParseIntPipe) page: number) {
    // ä¸šåŠ¡é€»è¾‘ï¼Œä½¿ç”¨ page
  }
}
```

curl è¯·æ±‚ç¤ºä¾‹ï¼š

```bash
curl -G http://localhost:3000/items?page=2
```

### 2.3 `ParseFloatPipe`

`ParseFloatPipe`ï¼šç±»ä¼¼äºÂ `ParseIntPipe`ï¼Œä½†ç”¨äºå°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºæµ®ç‚¹æ•°ã€‚

```typescript
import { Controller, Get, Query, UsePipes } from "@nestjs/common";
import { ParseFloatPipe } from "@nestjs/common";

@Controller("orders")
export class OrdersController {
  @Get()
  getOrders(@Query("price", ParseFloatPipe) price: number) {
    // ä¸šåŠ¡é€»è¾‘ï¼Œä½¿ç”¨ price
  }
}
```

curl è¯·æ±‚ç¤ºä¾‹ï¼š

```bash
curl -G http://localhost:3000/orders?price=19.99
```

### 2.4 `ParseBoolPipe`

`ParseBoolPipe`ï¼šå°†ä¼ å…¥çš„å€¼è½¬æ¢ä¸ºå¸ƒå°”å€¼ï¼Œå¯ä»¥å¤„ç†å­—ç¬¦ä¸²ï¼ˆå¦‚ "true", "false", "1", "0"ï¼‰å’Œå…¶ä»–è¡¨ç¤ºçœŸå€¼æˆ–å‡å€¼çš„è¾“å…¥ã€‚

```typescript
import { Controller, Get, Query, UsePipes } from "@nestjs/common";
import { ParseBoolPipe } from "@nestjs/common";

@Controller("users")
export class UsersController {
  @Get()
  getUsers(@Query("isActive", ParseBoolPipe) isActive: boolean) {
    // ä¸šåŠ¡é€»è¾‘ï¼Œä½¿ç”¨ isActive
  }
}
```

curl è¯·æ±‚ç¤ºä¾‹ï¼š

```bash
curl -G http://localhost:3000/users?isActive=true
```

### 2.5 `ParseArrayPipe`

`ParseArrayPipe`ï¼šå°†ä¼ å…¥çš„å­—ç¬¦ä¸²è½¬æ¢ä¸ºæ•°ç»„ã€‚

```typescript
import { Controller, Get, Query, UsePipes } from "@nestjs/common";
import { ParseArrayPipe } from "@nestjs/common";

@Controller("products")
export class ProductsController {
  @Get()
  getProducts(
    @Query("categories", ParseArrayPipe({ items: ParseIntPipe }))
    categories: number[]
  ) {
    // ä¸šåŠ¡é€»è¾‘ï¼Œä½¿ç”¨ categories æ•°ç»„
  }
}
```

curl è¯·æ±‚ç¤ºä¾‹ï¼š

```bash
curl -G http://localhost:3000/products?categories=1,2,3
```

### 2.6 `ParseUUIDPipe`

`ParseUUIDPipe`ï¼šå°†ä¼ å…¥çš„å­—ç¬¦ä¸²è½¬æ¢ä¸º UUID å¯¹è±¡ï¼Œå¦‚æœå­—ç¬¦ä¸²ä¸æ˜¯æœ‰æ•ˆçš„ UUIDï¼Œå®ƒå°†è¿”å›ä¸€ä¸ªé”™è¯¯ã€‚

```typescript
import { Controller, Get, Param, UsePipes } from "@nestjs/common";
import { ParseUUIDPipe } from "@nestjs/common";

@Controller("products")
export class ProductsController {
  @Get(":id")
  getProduct(@Param("id", ParseUUIDPipe) id: string) {
    // ä¸šåŠ¡é€»è¾‘ï¼Œä½¿ç”¨ id
  }
}
```

curl è¯·æ±‚ç¤ºä¾‹ï¼š

```bash
curl -G http://localhost:3000/products/123e4567-e89b-12d3-a456-426614174000
```

### 2.7 `ParseEnumPipe`

`ParseEnumPipe`ï¼šå°†ä¼ å…¥çš„å­—ç¬¦ä¸²è½¬æ¢ä¸ºæšä¸¾å€¼ã€‚å®ƒéœ€è¦ä¸€ä¸ªæšä¸¾ç±»ä½œä¸ºå‚æ•°ï¼Œå¦‚æœä¼ å…¥çš„å€¼ä¸æ˜¯æšä¸¾ä¸­çš„æœ‰æ•ˆæˆå‘˜ï¼Œå®ƒå°†è¿”å›ä¸€ä¸ªé”™è¯¯ã€‚

```typescript
import { Controller, Get, Query, UsePipes } from "@nestjs/common";
import { ParseEnumPipe } from "@nestjs/common";

enum Status {
  ACTIVE = "active",
  INACTIVE = "inactive",
  PENDING = "pending",
}

@Controller("statuses")
export class StatusesController {
  @Get()
  getStatuses(
    @Query("status", new ParseEnumPipe({ enum: Status })) status: Status
  ) {
    // ä¸šåŠ¡é€»è¾‘ï¼Œä½¿ç”¨ status
  }
}
```

curl è¯·æ±‚ç¤ºä¾‹ï¼š

```bash
curl -G http://localhost:3000/statuses?status=active
```

### 2.8 `DefaultValuePipe`

`DefaultValuePipe`ï¼šç”¨äºä¸ºæ²¡æœ‰æä¾›çš„æ•°æ®è®¾ç½®é»˜è®¤å€¼ã€‚å®ƒå¯ä»¥æ¥å—ä¸€ä¸ªå¯¹è±¡ï¼Œå…¶ä¸­å®šä¹‰äº†å‚æ•°åå’Œç›¸åº”çš„é»˜è®¤å€¼ã€‚

```typescript
import { Controller, Get, Query, UsePipes } from "@nestjs/common";
import { DefaultValuePipe } from "@nestjs/common";

@Controller("settings")
export class SettingsController {
  @Get()
  getSettings(@Query("limit", new DefaultValuePipe(10)) limit: number) {
    // ä¸šåŠ¡é€»è¾‘ï¼Œä½¿ç”¨ limitï¼Œé»˜è®¤å€¼ä¸º 10
  }
}
```

curl è¯·æ±‚ç¤ºä¾‹ï¼š

```bash
curl -G http://localhost:3000/settings?limit=5
```

### 2.9 `ParseFilePipe`

`ParseFilePipe`ï¼šç”¨äºå¤„ç†ä¸Šä¼ çš„æ–‡ä»¶ã€‚å®ƒé€šå¸¸ç”¨äºå¤„ç†Â `multipart/form-data`Â è¯·æ±‚ä¸­çš„æ–‡ä»¶ä¸Šä¼ ã€‚

```kotlin
import { Controller, Post, UseInterceptors } from '@nestjs/common';
import { FileInterceptor } from '@nestjs/platform-express';

@Controller('uploads')
export class UploadsController {
  @Post('profile')
  @UseInterceptors(FileInterceptor('file'))
  uploadProfile(@UploadedFile() file) {
    // ä¸šåŠ¡é€»è¾‘ï¼Œå¤„ç†ä¸Šä¼ çš„æ–‡ä»¶
  }
}
```

âš ï¸Â æ³¨æ„ï¼š`ParseFilePipe` å®é™…ä¸Šæ˜¯ä¸€ä¸ªç¤ºä¾‹åç§°ï¼ŒNestJS ä¸­ç”¨äºå¤„ç†æ–‡ä»¶ä¸Šä¼ çš„ç®¡é“æ˜¯ `FileInterceptor`ã€‚

curl è¯·æ±‚ç¤ºä¾‹ï¼š

```bash
curl -X POST -F "file=@/path/to/profile/image.jpg" http://localhost:3000/uploads/profile
```

ä¸Šé¢çš„å†…ç½®ç®¡é“éƒ½ä½¿ç”¨äº**å‚æ•°çº§åˆ«**ï¼Œå½“ç„¶è¿˜å¯ä»¥ç”¨äºä»¥ä¸‹çº§åˆ«ï¼š

- **å…¨å±€åº”ç”¨**ï¼šæ‰€æœ‰ä¼ å…¥è¯·æ±‚éƒ½ä¼šç»è¿‡æŒ‡å®šçš„ç®¡é“ã€‚
- **æ§åˆ¶å™¨çº§åˆ«**ï¼šç‰¹å®šæ§åˆ¶å™¨ä¸­çš„æ‰€æœ‰è¯·æ±‚ä¼šåº”ç”¨åˆ°æŒ‡å®šçš„ç®¡é“ã€‚
- **è·¯ç”±å¤„ç†ç¨‹åºçº§åˆ«**ï¼šä»…åº”ç”¨äºæŸä¸ªå…·ä½“çš„è·¯ç”±å¤„ç†å‡½æ•°ã€‚

å¯ä»¥çœ‹åˆ°æ˜¯éå¸¸çµæ´»çš„ï¼Œä½†æ˜¯ä¸€ä¸ªæˆç†Ÿçš„é¡¹ç›®æ¨èä¸Šå…¨å±€åº”ç”¨ï¼Œæ‰€æœ‰çš„è¯·æ±‚éƒ½åº”è¯¥æ¥å—ç®¡é“éªŒè¯ã€‚å¦å¤–ï¼Œç®¡é“çš„æ‰§è¡Œé¡ºåºæ˜¯åœ¨**è·¯ç”±å¤„ç†ç¨‹åº**æ‰§è¡Œä¹‹å‰ï¼Œå› æ­¤å¯ä»¥ç¡®ä¿ä¼ å…¥çš„è¯·æ±‚æ•°æ®åœ¨è¿›å…¥ä¸šåŠ¡é€»è¾‘ä¹‹å‰å·²ç»è¿‡äº†éªŒè¯å’Œè½¬æ¢ã€‚

## 3\. `ValidationPipe`

`ValidationPipe` éªŒè¯ç®¡é“æä¾›äº†å¾ˆå¤šå¼€ç®±å³ç”¨çš„é€‰é¡¹ï¼Œä¸ç”¨æˆ‘ä»¬è‡ªå·±æ‰‹åŠ¨å»æ„å»ºéªŒè¯é€»è¾‘ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬åœ¨å…¨å±€åº”ç”¨éªŒè¯ç®¡é“ã€‚

`ValidationPipe` éœ€è¦æ­é… `class-validator` åŒ…ä¸­çš„è£…é¥°å™¨æ¥å£°æ˜éªŒè¯è§„åˆ™ï¼š

```cpp
npm install class-validator class-transformer
```

### 3.1 class-validator

`class-validator` ç”¨äºéªŒè¯å¯¹è±¡å±æ€§çš„è£…é¥°å™¨åº“ï¼Œèƒ½é›†æˆåˆ°ä»»ä½•åŸºäºç±»çš„æ¡†æ¶ä¸­ï¼Œå¦‚ NestJSã€‚å¯ä»¥éªŒè¯å¯¹è±¡ã€æ•°ç»„ç”šè‡³åµŒå¥—å¯¹è±¡ï¼›æ”¯æŒå„ç§éªŒè¯è§„åˆ™ï¼ŒåŒ…æ‹¬è‡ªå®šä¹‰è§„åˆ™ï¼›èƒ½å¤Ÿä¸Â `class-transformer`Â é…åˆä½¿ç”¨ï¼Œä»¥è‡ªåŠ¨è½¬æ¢å’ŒéªŒè¯æ•°æ®ã€‚

### 3.2 class-transformer

`class-transformer` æ˜¯ä¸€ä¸ªç”¨äºè½¬æ¢ï¼ˆåºåˆ—åŒ–å’Œååºåˆ—åŒ–ï¼‰å’Œå¤åˆ¶å¯¹è±¡çš„åº“ï¼Œå®ƒå¯ä»¥ä¸ `class-validator` æ— ç¼é›†æˆã€‚å®ƒå…è®¸å°†æ™®é€šçš„ JavaScript å¯¹è±¡è½¬æ¢ä¸ºç±»å®ä¾‹ï¼Œå¹¶åœ¨è½¬æ¢è¿‡ç¨‹ä¸­è¿›è¡ŒéªŒè¯ã€‚æ”¯æŒå¯¹è±¡çš„æ·±åº¦å¤åˆ¶ï¼›å¯ä»¥ä¸Â `class-validator`Â ç»“åˆä½¿ç”¨ï¼Œä»¥åœ¨è½¬æ¢è¿‡ç¨‹ä¸­è¿›è¡ŒéªŒè¯ã€‚

### 3.3 å…¨å±€ä½¿ç”¨éªŒè¯ç®¡é“

ç®€è€Œè¨€ä¹‹ï¼Œ**`class-validator`** ä¸“æ³¨äºæ•°æ®éªŒè¯ï¼Œæä¾›äº†ä¸°å¯Œçš„éªŒè¯è§„åˆ™å’Œè£…é¥°å™¨ï¼›**`class-transformer`** ä¸“æ³¨äºæ•°æ®è½¬æ¢ï¼Œèƒ½å¤Ÿå°†æ™®é€šå¯¹è±¡è½¬æ¢ä¸ºç±»çš„å®ä¾‹ï¼Œå¹¶æ”¯æŒæ·±åº¦å¤åˆ¶ã€‚

åœ¨å…¥å£æ–‡ä»¶ä¸­è®¾ç½®å…¨å±€ç®¡é“ï¼š

```javascript
// main.ts

import { NestFactory } from '@nestjs/core';
import { AppModule } from './app.module';
+ import { ValidationPipe } from '@nestjs/common';

async function bootstrap() {
  const app = await NestFactory.create(AppModule);
+   app.useGlobalPipes(new ValidationPipe());
  await app.listen(3000);
}
bootstrap();
```

### 3.4 æ·»åŠ éªŒè¯è§„åˆ™

ä»¥ users èµ„æºä¸‹çš„ dto æ–‡ä»¶ create-user.dto.ts ä¸ºä¾‹ï¼Œæ·»åŠ éªŒè¯è§„åˆ™ï¼š

```kotlin
import { IsNotEmpty, MinLength, IsEmail, IsString } from 'class-validator';

export class CreateUserDto {
  @IsString()
  @IsNotEmpty()
  @MinLength(3)
  name: string;

  @IsEmail()
  @IsNotEmpty()
  email: string;

  @IsString()
  @IsNotEmpty()
  @MinLength(8)
  password: string;
}
```

`class-validator` æä¾›çš„è£…é¥°å™¨å¾ˆå¥½ç†è§£ï¼š

- `@IsString()`ï¼šéªŒè¯è¾“å…¥å­—æ®µæ˜¯å¦ä¸ºå­—ç¬¦ä¸²ç±»å‹ï¼Œå¦‚æœä¸æ˜¯ï¼Œåˆ™éªŒè¯å¤±è´¥ã€‚
- `@IsNotEmpty()`ï¼šéªŒè¯å­—æ®µæ˜¯å¦å·²å®šä¹‰ä¸”ä¸æ˜¯ç©ºå­—ç¬¦ä¸²ã€‚
- `@MinLength(3)`ï¼šç¡®ä¿å­—æ®µé•¿åº¦è‡³å°‘ä¸º 3 ä¸ªå­—ç¬¦ï¼Œå¦åˆ™éªŒè¯å¤±è´¥ã€‚
- `@IsEmail()`ï¼šéªŒè¯å­—æ®µä¸ºä¸€ä¸ªæœ‰æ•ˆçš„ç”µå­é‚®ç®±åœ°å€ï¼Œå®ƒä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æ¥éªŒè¯æ ¼å¼ã€‚

users.controller.ts å¦‚ä¸‹ï¼š

```less
@Controller('users')
export class UsersController {
  constructor(private readonly usersService: UsersService) {}

  @Post()
  create(@Body() createUserDto: CreateUserDto) {
    return this.usersService.create(createUserDto);
  }
}
```

åœ¨è°ƒç”¨ this.usersService.create(createUserDto) æ–¹æ³•ä¹‹å‰ï¼Œç”±äºå…¨å±€ä½¿ç”¨äº†éªŒè¯ç®¡é“ï¼Œå› æ­¤ä¼šå…ˆå¯¹è¾“å…¥å‚æ•°è¿›è¡ŒéªŒè¯ã€‚

ç°åœ¨æ”¹å†™ users.service.ts ä¸­åˆ›å»ºç”¨æˆ·çš„ `create` æ–¹æ³•å¦‚ä¸‹ï¼š

```typescript
@Injectable()
export class UsersService {
  constructor(private readonly prisma: PrismaService) {}

  async create(createUserDto: CreateUserDto) {
    const existingUser = await this.prisma.user.findUnique({
      where: { email: createUserDto.email },
    });
    if (existingUser) {
      throw new ConflictException('é‚®ç®±å·²è¢«æ³¨å†Œ');
    }
    const hashedPassword = await bcrypt.hash(createUserDto.password, 10);
    return this.prisma.user.create({
      data: {
        ...createUserDto,
        password: hashedPassword,
        role: UserRole.USER,
      },
    });
  }
```

ç®€å•æ¥è¯´ï¼Œä¼šå…ˆå»æ£€æŸ¥æ˜¯å¦å­˜åœ¨æŒ‡å®šç”µå­é‚®ä»¶åœ°å€çš„ç”¨æˆ·ï¼Œå¦‚æœå­˜åœ¨å°±è¿”å›â€œé‚®ç®±å·²è¢«æ³¨å†Œâ€çš„å¼‚å¸¸æç¤ºï¼›å¦åˆ™ï¼Œä½¿ç”¨ `bcrypt.hash` æ–¹æ³•æ¥åˆ›å»ºå…³äº `createUserDto.password` çš„åŠ å¯†å¯†ç ï¼Œæœ€åè¿”å›åˆ›å»ºå®Œæˆçš„ `user` å®ä½“æ•°æ®ã€‚ï¼ˆåˆ›å»ºçš„ç”¨æˆ· `role` ä¸º `UserRole.USER`ï¼‰

å½“å‰çš„ Prisma æ¨¡å‹æ–‡ä»¶å·²ç»å‘å˜åŒ–ï¼š

```kotlin
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        Int      @id @default(autoincrement())
  email     String   @unique
  name      String
+   password  String
+   role      UserRole @default(USER)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  orders    Order[]
}

model Order {
  id        Int      @id @default(autoincrement())
  userId    Int
  user      User     @relation(fields: [userId], references: [id])
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

+ enum UserRole {
+   USER
+   ADMIN
+ }
```

User æ¨¡å‹å¤šäº† `password` ç”¨äºè®°å½•ç”¨æˆ·å¯†ç ï¼Œ`role` ç”¨äºè®°å½•ç”¨æˆ·è§’è‰²ã€‚

### 3.5 æµ‹è¯•ä¸€ä¸‹éªŒè¯ç®¡é“æ˜¯å¦æœ‰æ•ˆ

example1ï¼šé¦–å…ˆè¾“å…¥ä¸€ä¸ªæ­£ç¡®çš„æ•°æ®æ ¼å¼ã€‚

```swift
curl -X POST http://localhost:3000/users \
-H "Content-Type: application/json" \
-d '{"name": "John Doe", "email": "john.doe@example.com", "password": "securepassword123"}'
```

![example1 ç»“æœ.png](https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/33b7ed4779a443118182199e85dca22a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I-g6JCd55qE6Jyc:q75.awebp?rk3s=f64ab15b&x-expires=1761399139&x-signature=qOQx1UZFocJXa8%2B0%2FjMr6pk56yA%3D)

âœ…Â æˆåŠŸäº†ã€‚

example2ï¼šå†è¾“å…¥ä¸€ä¸ªé”™è¯¯çš„æ ¼å¼ï¼ˆemail æ ¼å¼æ˜¯é”™è¯¯çš„ï¼Œå¯†ç ä¸ºç©ºï¼‰ã€‚

```swift
curl -X POST http://localhost:3000/users \
-H "Content-Type: application/json" \
-d '{"name": "David King", "email": "john.doe", "password": ""}'
```

![example2 ç»“æœ.png](https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a071ab53365442cf93be69fac9f663f1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I-g6JCd55qE6Jyc:q75.awebp?rk3s=f64ab15b&x-expires=1761399139&x-signature=HbiF6cgBcMmfwdCylX9%2BbTZrdbI%3D)

âœ…Â è¿™æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é¢„æœŸã€‚

example3ï¼šå†ä½¿ç”¨ç¬¬ä¸€ä¸ªæˆåŠŸåˆ›å»ºçš„ç”¨æˆ·çš„é‚®ç®±å†æ¬¡åˆ›å»ºï¼Œçœ‹çœ‹æ˜¯å¦ä¼šå‘Šè¯‰æˆ‘ä»¬æœ‰é‡å¤çš„ã€‚

```swift
curl -X POST http://localhost:3000/users \
-H "Content-Type: application/json" \
-d '{"name": "John Doe", "email": "john.doe@example.com", "password": "securepassword123"}'
```

![example3 ç»“æœ.png](https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2b34d45de17e43cca6564171c8206e7e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I-g6JCd55qE6Jyc:q75.awebp?rk3s=f64ab15b&x-expires=1761399139&x-signature=2VL4Qx7HeFD37j8eEvrzeEHEGdI%3D)

âœ…Â ç¬¦åˆé¢„æœŸï¼Œå‘Šè¯‰æˆ‘ä»¬é‚®ç®±å·²è¢«æ³¨å†Œã€‚

example4ï¼šä¼ é€’ä¸å¿…è¦çš„å±æ€§ç»™è·¯ç”±å¤„ç†å™¨ï¼ˆåœ¨ä¿è¯å‚æ•°æœ‰æ•ˆçš„å‰æä¸‹ï¼Œè¯•ç€å¤šä¼ é€’ä¸€ä¸ª `title` å±æ€§ï¼‰ã€‚

```swift
curl -X POST http://localhost:3000/users \
-H "Content-Type: application/json" \
-d '{"name": "Mike Poter", "email": "mike.poter@example.com", "password": "securepassword123","title":"å¤šä½™çš„å±æ€§"}'
```

![example4 ç»“æœ.png](https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/96073ca086e7415f8656c158e80235ed~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I-g6JCd55qE6Jyc:q75.awebp?rk3s=f64ab15b&x-expires=1761399139&x-signature=HXZ0geEeS4qJRPAGPyKYQGsM9yg%3D)

è¿™å°±ç›´æ¥æŠ¥å‡º 500 çš„æœåŠ¡å™¨é”™è¯¯äº†ï¼Œè™½ç„¶ä½†æ˜¯â€”â€”ä¸æ˜¯å¾ˆä¼˜é›…ã€‚

### 3.6 åˆ é™¤ä¸å¿…è¦çš„å±æ€§

`ValidationPipe` æä¾›äº†é€‰é¡¹ `whitelist: true` æ¥åˆ é™¤ DTO ä¸­æœªå®šä¹‰çš„å±æ€§ã€‚

ä¿®æ”¹ main.tsï¼š

```javascript
import { NestFactory } from "@nestjs/core";
import { AppModule } from "./app.module";
import { ValidationPipe } from "@nestjs/common";

async function bootstrap() {
  const app = await NestFactory.create(AppModule);
  +app.useGlobalPipes(new ValidationPipe({ whitelist: true }));
  await app.listen(3000);
}
bootstrap();
```

ç°åœ¨å†å°è¯• example5ï¼Œç»“æœå¦‚ä¸‹ï¼š

![example5 ç»“æœ.png](https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5a902f45f1e646e78ea064d041f0e3b0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I-g6JCd55qE6Jyc:q75.awebp?rk3s=f64ab15b&x-expires=1761399139&x-signature=NHfL8L78cBGrckC9%2BmKBF%2FX%2B6nw%3D)

âœ…Â æ­£ç¡®ã€‚

å¦‚æœæƒ³è¦æ›´åŠ ä¸¥æ ¼åœ°æ§åˆ¶è¾“å…¥å‚æ•°ï¼Œæ¯”å¦‚ title åœ¨ dto æ–‡ä»¶ä¸­å¹¶æœªå®šä¹‰ï¼Œåº”è¯¥æŠ¥é”™ã€‚é€šè¿‡æ·»åŠ  `forbidNonWhitelisted: true` é€‰é¡¹æ¥å®ç°è¿™ç§æ•ˆæœï¼š

```javascript
import { NestFactory } from "@nestjs/core";
import { AppModule } from "./app.module";
import { ValidationPipe } from "@nestjs/common";

async function bootstrap() {
  const app = await NestFactory.create(AppModule);
  app.useGlobalPipes(
    +new ValidationPipe({ whitelist: true, forbidNonWhitelisted: true })
  );
  await app.listen(3000);
}
bootstrap();
```

![æ‹¦æˆªå¤šä½™å±æ€§ç„¶åæŠ¥é”™.png](https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bb4be516701841d1a83689b4c248efae~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I-g6JCd55qE6Jyc:q75.awebp?rk3s=f64ab15b&x-expires=1761399139&x-signature=PuvezCJiqFuQgSfefuhZP63Xkpo%3D)

âœ…Â ä»ç»“æœçœ‹ï¼Œå¤šä½™çš„ `title` ç¡®å®è¢«æ£€æŸ¥å‡ºæ¥äº†ï¼Œæ–°çš„ `user` ä¹Ÿä¸ä¼šè¢«åˆ›å»ºå‡ºæ¥ã€‚

## 4\. è½¬æ¢è¾“å…¥å‚æ•°çš„æ•°æ®ç±»å‹

åœ¨å†…ç½®ç®¡é“ç« èŠ‚å·²ç»åˆ—ä¸¾äº†å¾ˆå¤šæœ‰å…³è¾“å…¥å‚æ•°ç±»å‹è½¬æ¢çš„ç¤ºä¾‹ï¼Œå›åˆ°é¡¹ç›®ä»£ç  users.controller.ts ä¸­ï¼š

```less
@Get(':id')
findOne(@Param('id') id: string) {
  return this.usersService.findOne(+id);
}

@Patch(':id')
update(@Param('id') id: string, @Body() updateUserDto: UpdateUserDto) {
  return this.usersService.update(+id, updateUserDto);
}

@Delete(':id')
remove(@Param('id') id: string) {
  return this.usersService.remove(+id);
}
```

éœ€è¦ä¼ é€’ `id` çš„è·¯ç”±å¤„ç†ç¨‹åºåœ¨è°ƒç”¨æœåŠ¡ç±»æ–¹æ³•æ—¶éƒ½ä¼ é€’äº† `+id` ä»¥ä½¿ `id` è½¬æ¢ä¸ºæ•°å­—ç±»å‹ï¼Œè¿™æ˜¯ JS æä¾›çš„è‡ªåŠ¨è½¬æ¢ç‰¹æ€§ï¼Œç°åœ¨å¯ä»¥ä½¿ç”¨ç®¡é“ï¼ˆ`ParseIntPipe`ï¼‰æ¥å®ç°è‡ªåŠ¨è½¬æ¢ï¼š

```typescript
import {
  Controller,
  Get,
  Post,
  Body,
  Patch,
  Param,
  Delete,
  Query,
+ ParseIntPipe,
} from '@nestjs/common';

// å…¶ä»–å¼•å…¥...

@Controller('users')
export class UsersController {
  constructor(private readonly usersService: UsersService) {}

  // å…¶ä»–è·¯ç”±å¤„ç†å™¨...

  @Get(':id')
+ findOne(@Param('id', ParseIntPipe) id: number) {
+   return this.usersService.findOne(id);
  }

  @Patch(':id')
+ update(
+   @Param('id', ParseIntPipe) id: number,
    @Body() updateUserDto: UpdateUserDto,
  ) {
+    return this.usersService.update(id, updateUserDto);
  }

  @Delete(':id')
+ remove(@Param('id', ParseIntPipe) id: number) {
+   return this.usersService.remove(id);
  }
}
```

## 5\. è‡ªå®šä¹‰ç®¡é“

å…ˆå‰åœ¨ç”¨æˆ·æ³¨å†Œæ—¶ï¼Œæˆ‘ä»¬åªå¯¹ email åšäº†æ£€æŸ¥ï¼Œå…¶å®è¿˜è¦æ£€æŸ¥ç”¨æˆ·åæ˜¯å¦å”¯ä¸€ï¼Œæˆ‘ä»¬ç”¨**è‡ªå®šä¹‰ç®¡é“**æ¥å®ç°è¿™ä¸ªéœ€æ±‚ã€‚

### 5.1 å®šä¹‰ç®¡é“

åœ¨ users ç›®å½•ä¸‹åˆ›å»º pipes ç›®å½•ï¼Œå…¶ä¸‹æ–°å»ºç®¡é“æ–‡ä»¶ unique-username.pipe.tsï¼š

```typescript
import { Injectable, PipeTransform, BadRequestException } from "@nestjs/common";
import { PrismaService } from "../../prisma/prisma.service";

@Injectable()
export class UniqueUsernamePipe implements PipeTransform {
  constructor(private prisma: PrismaService) {}

  async transform(value: string) {
    const user = await this.prisma.user.findFirst({
      where: { name: value },
    });

    if (user) {
      throw new BadRequestException("ç”¨æˆ·åå·²å­˜åœ¨");
    }

    return value;
  }
}
```

è‡ªå®šä¹‰çš„ `UniqueUsernamePipe` ç±»å®ç°äº† `PipeTransform` çš„æ¥å£ï¼Œå¿…é¡»å®ç° `transform` æ–¹æ³•æ¥å±¥è¡Œ `PipeTransform` çš„æ¥å£å¥‘çº¦ã€‚`transform` æ–¹æ³•çš„å‚æ•° `value` è¡¨ç¤ºå½“å‰è·¯ç”±å¤„ç†å™¨æ¥æ”¶çš„è¾“å…¥å‚æ•°ã€‚

å› æ­¤ï¼Œä¸Šè¿°ä»£ç é¦–å…ˆä½¿ç”¨ prisma å®¢æˆ·ç«¯å®ä¾‹å»æŸ¥æ‰¾å¯¹åº”åç§°çš„ç”¨æˆ·ï¼Œå¦‚æœå­˜åœ¨åˆ™æŠ›å‡ºé”™è¯¯ï¼šâ€œç”¨æˆ·åå·²å­˜åœ¨â€ï¼Œå¦åˆ™å°†è¾“å…¥å‚æ•°è¿”å›å‡ºå»ã€‚

### 5.2 ä½¿ç”¨ç®¡é“

åœ¨ users.controller.ts ä¸­ä½¿ç”¨å®šä¹‰å¥½çš„è‡ªå®šä¹‰ç®¡é“ï¼š

```typescript
+ import { UniqueUsernamePipe } from './pipes/unique-username.pipe';

@Controller('users')
export class UsersController {
  constructor(private readonly usersService: UsersService) {}

  @Post()
  create(
+    @Body('name', UniqueUsernamePipe) name: string,
    @Body() createUserDto: CreateUserDto,
  ) {
    return this.usersService.create(createUserDto);
  }
}
```

curl è¯·æ±‚ç¤ºä¾‹ï¼ˆ`John Doe` æ˜¯ User è¡¨ä¸­å·²ç»å­˜åœ¨çš„å¯¹è±¡ï¼‰ï¼š

```swift
curl -X POST http://localhost:3000/users \
-H "Content-Type: application/json" \
-d '{"name": "John Doe", "email": "john.doe@example.com", "password": "securepassword123"}'
```

![è‡ªå®šä¹‰ç®¡é“ UniqueUsernamePipe ä½¿ç”¨ç»“æœ.png](https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/adf65f5d81a041a9b875bee548b40d8f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I-g6JCd55qE6Jyc:q75.awebp?rk3s=f64ab15b&x-expires=1761399139&x-signature=%2BFndZgpfrcYMtQd2qf5oVNjEQRc%3D)

âœ…Â ç®¡é“èµ·ä½œç”¨äº†ï¼

## 6\. æ€»ç»“

åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬æ¢è®¨äº†å¦‚ä½•åœ¨ NestJS æ¡†æ¶ä¸­åˆ©ç”¨ç®¡é“ï¼ˆPipesï¼‰å¯¹ä¼ å…¥çš„è¯·æ±‚å‚æ•°æ‰§è¡ŒéªŒè¯å’Œè½¬æ¢ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œç®¡é“ä¸ä»…å¢å¼ºäº†æ•°æ®çš„å®‰å…¨æ€§ï¼Œç¡®ä¿äº†æ¥æ”¶åˆ°çš„æ•°æ®ç¬¦åˆé¢„æœŸæ ¼å¼å’Œæ ‡å‡†ï¼Œè€Œä¸”è¿˜é€šè¿‡è‡ªå®šä¹‰ç®¡é“æä¾›äº†é«˜åº¦çš„çµæ´»æ€§ï¼Œä½¿å¾—å¯¹å‚æ•°çš„æ ¡éªŒå¯ä»¥æ ¹æ®å…·ä½“ä¸šåŠ¡éœ€æ±‚è¿›è¡Œå®šåˆ¶ã€‚

---

created: 2025-10-22T19:48:21 (UTC +08:00)
tags: [å‰ç«¯,åç«¯,NestJSä¸­æ–‡æŠ€æœ¯ç¤¾åŒº,å‰ç«¯å¼€å‘ç¤¾åŒº,å‰ç«¯æŠ€æœ¯äº¤æµ,å‰ç«¯æ¡†æ¶æ•™ç¨‹,JavaScript å­¦ä¹ èµ„æº,CSS æŠ€å·§ä¸æœ€ä½³å®è·µ,HTML5 æœ€æ–°åŠ¨æ€,å‰ç«¯å·¥ç¨‹å¸ˆèŒä¸šå‘å±•,å¼€æºå‰ç«¯é¡¹ç›®,å‰ç«¯æŠ€æœ¯è¶‹åŠ¿]
source: https://juejin.cn/post/7420272008146239514
author: è èçš„èœœ

---

# NestJS ğŸ§‘ğŸ³Â å¨å­å¿…ä¿®è¯¾ï¼ˆå…«ï¼‰ï¼šå¼‚å¸¸è¿‡æ»¤å™¨å¼‚å¸¸è¿‡æ»¤å™¨æ˜¯ NestJS æä¾›çš„å¼ºå¤§å·¥å…·ï¼Œç”¨äºæ•è·å’Œå¤„ç†åº”ç”¨ä¸­çš„ - æ˜é‡‘

> ## Excerpt
>
> å¼‚å¸¸è¿‡æ»¤å™¨æ˜¯ NestJS æä¾›çš„å¼ºå¤§å·¥å…·ï¼Œç”¨äºæ•è·å’Œå¤„ç†åº”ç”¨ä¸­çš„å¼‚å¸¸ã€‚é€šè¿‡è‡ªå®šä¹‰å’Œå…¨å±€åº”ç”¨è¿‡æ»¤å™¨ï¼Œå¼€å‘è€…å¯ä»¥ç¡®ä¿å¼‚å¸¸å¤„ç†çš„ä¸€è‡´æ€§ï¼Œå¹¶æå‡åº”ç”¨çš„å¥å£®æ€§å’Œç”¨æˆ·ä½“éªŒã€‚

---

## 1\. å‰è¨€

é€šè¿‡æ¥å£ GET /users/4 å¯ä»¥æŸ¥è¯¢åˆ° id ä¸º 4 çš„ç”¨æˆ·ä¿¡æ¯ï¼Œé€šè¿‡ GET /users/123 å¯ä»¥æŸ¥è¯¢åˆ° id ä¸º 123 çš„ç”¨æˆ·ä¿¡æ¯ï¼Œé—®é¢˜æ˜¯æ•°æ®åº“ä¸­å¹¶æ²¡æœ‰åè€…çš„æ•°æ®ï¼Œæ­¤æ—¶åº”è¯¥å‘Šè¯‰å‰ç«¯æ²¡æœ‰è¿™é¡¹æ•°æ®ã€‚æœ¬ç¯‡å°†ä¼šè®²è§£é”™è¯¯å¤„ç†ç›¸å…³çš„å†…å®¹ï¼Œè¿™å°†æ¶‰åŠåˆ° NestJS ä¸­çš„å¼‚å¸¸è¿‡æ»¤å™¨éƒ¨åˆ†ã€‚

æ¬¢è¿åŠ å…¥[æŠ€æœ¯äº¤æµç¾¤](https://juejin.cn/user/2154698521972423/pins "https://juejin.cn/user/2154698521972423/pins")ã€‚

![image.png](https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dd5e4b8be907402d9d882517ff6a0e0c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I-g6JCd55qE6Jyc:q75.awebp?rk3s=f64ab15b&x-expires=1761404663&x-signature=hG8NFDpaFxZwz7g46L82cW2a%2F4M%3D)

1.  [NestJS ğŸ§‘ğŸ³Â  å¨å­å¿…ä¿®è¯¾ï¼ˆä¸€ï¼‰ï¼šåç«¯çš„æœ¬è´¨](https://juejin.cn/post/7407260232664186930 "https://juejin.cn/post/7407260232664186930")
2.  [NestJS ğŸ§‘ğŸ³Â å¨å­å¿…ä¿®è¯¾ï¼ˆäºŒï¼‰ï¼šé¡¹ç›®åˆ›å»º](https://juejin.cn/post/7408021285768445961 "https://juejin.cn/post/7408021285768445961")
3.  [NestJS ğŸ§‘ğŸ³Â å¨å­å¿…ä¿®è¯¾ï¼ˆä¸‰ï¼‰ï¼šæ§åˆ¶å™¨](https://juejin.cn/post/7408778862283096102 "https://juejin.cn/post/7408778862283096102")
4.  [NestJS ğŸ§‘ğŸ³Â å¨å­å¿…ä¿®è¯¾ï¼ˆå››ï¼‰ï¼šæœåŠ¡ç±»](https://juejin.cn/post/7416235834938212403 "https://juejin.cn/post/7416235834938212403")
5.  [NestJS ğŸ§‘ğŸ³Â å¨å­å¿…ä¿®è¯¾ï¼ˆäº”ï¼‰ï¼šPrisma é›†æˆï¼ˆä¸Šï¼‰](https://juejin.cn/post/7416908856868110374 "https://juejin.cn/post/7416908856868110374")
6.  [NestJS ğŸ§‘ğŸ³Â å¨å­å¿…ä¿®è¯¾ï¼ˆå…­ï¼‰ï¼šPrisma é›†æˆï¼ˆä¸‹ï¼‰](https://juejin.cn/post/7418460243502792731 "https://juejin.cn/post/7418460243502792731")
7.  [NestJS ğŸ§‘ğŸ³Â å¨å­å¿…ä¿®è¯¾ï¼ˆä¸ƒï¼‰ï¼šç®¡é“](https://juejin.cn/post/7419887372463554601 "https://juejin.cn/post/7419887372463554601")
8.  [NestJS ğŸ§‘ğŸ³Â å¨å­å¿…ä¿®è¯¾ï¼ˆå…«ï¼‰ï¼šå¼‚å¸¸è¿‡æ»¤å™¨](https://juejin.cn/post/7420272008146239514 "https://juejin.cn/post/7420272008146239514")

## 2\. **`NotFoundException`**

é€šè¿‡ `NotFoundException` å®ä¾‹ç›´æ¥æŠ›å‡ºé”™è¯¯ï¼š

```typescript
import { Injectable, NotFoundException } from "@nestjs/common";

@Injectable()
export class UsersService {
  constructor(private readonly prisma: PrismaService) {}

  async findOne(id: number) {
    const user = await this.prisma.user.findUnique({
      where: { id },
      // å…³è”
      include: {
        orders: true,
      },
    });
    if (!user) {
      throw new NotFoundException("ç”¨æˆ·ä¸å­˜åœ¨");
    }
    return user;
  }
}
```

è¿™é‡Œåšäº†é˜²å¾¡æ€§ç¼–ç¨‹ï¼Œå¦‚æœæ²¡æœ‰æŸ¥è¯¢åˆ°ç”¨æˆ·ï¼Œä½¿ç”¨ `throw new NotFoundException('ç”¨æˆ·ä¸å­˜åœ¨');` æŠ›å‡ºé”™è¯¯ã€‚

è®¿é—® [http://localhost:3000/users/123](https://link.juejin.cn/?target=http%3A%2F%2Flocalhost%3A3000%2Fusers%2F123 "http://localhost:3000/users/123") åï¼š

![image.png](https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/95555e32ab2b447f9cba9497a536ef70~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I-g6JCd55qE6Jyc:q75.awebp?rk3s=f64ab15b&x-expires=1761404663&x-signature=Tb9uddZPz27yvvpe8RL5z7uebyM%3D)

è¿”å›çš„ JSON å¯¹è±¡ç”±ä»¥ä¸‹å­—æ®µç»„æˆï¼š

- `message`ï¼šæè¿°å…·ä½“é”™è¯¯ä¿¡æ¯ï¼Œé€šå¸¸æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè§£é‡Šé”™è¯¯çš„åŸå› æˆ–èƒŒæ™¯ã€‚
- `error`ï¼šæ ‡è¯†å‘ç”Ÿé”™è¯¯çš„ç±»å‹æˆ–ç±»åˆ«ã€‚é€šå¸¸ä¸ºé”™è¯¯çš„åç§°æˆ–ç±»åˆ«ï¼ˆå¦‚ â€œBad Requestâ€ æˆ– â€œUnauthorizedâ€ï¼‰ã€‚
- `statusCode`ï¼šHTTP çŠ¶æ€ç ï¼Œä»¥æ•°å­—å½¢å¼è¡¨ç¤ºè¯·æ±‚å¤±è´¥çš„ç±»å‹ã€‚å¸¸è§çš„çŠ¶æ€ç åŒ…æ‹¬ 400ï¼ˆBad Requestï¼‰ã€401ï¼ˆUnauthorizedï¼‰ã€404ï¼ˆNot Foundï¼‰ç­‰ï¼Œç”¨äºåæ˜ è¯·æ±‚çš„ç»“æœçŠ¶æ€ã€‚

é™¤äº† `NotFoundException`ï¼ŒNestJS ä¸­è¿˜æä¾›äº†ä»¥ä¸‹å†…ç½®çš„ HTTP å¼‚å¸¸ï¼š

1.  **BadRequestException (400 Bad Request)**

è¡¨ç¤ºå®¢æˆ·ç«¯å‘é€çš„**è¯·æ±‚æœ‰é”™è¯¯**ï¼ŒæœåŠ¡å™¨æ— æ³•å¤„ç†ã€‚ä¾‹å¦‚ï¼Œå‚æ•°ç¼ºå¤±ã€æ— æ•ˆè¾“å…¥ç­‰æƒ…å†µã€‚

1.  **UnauthorizedException (401 Unauthorized)**

è¡¨ç¤ºè¯·æ±‚æ²¡æœ‰ç»è¿‡**èº«ä»½éªŒè¯æˆ–è®¤è¯å¤±è´¥**ã€‚é€šå¸¸å‡ºç°åœ¨è®¿é—®éœ€è¦èº«ä»½éªŒè¯çš„èµ„æºæ—¶ï¼Œå®¢æˆ·ç«¯æ²¡æœ‰æä¾›æœ‰æ•ˆçš„è®¤è¯ä¿¡æ¯ã€‚

1.  **ForbiddenException (403 Forbidden)**

è¡¨ç¤ºå®¢æˆ·ç«¯çš„èº«ä»½è®¤è¯æˆåŠŸï¼Œä½†**æ²¡æœ‰æƒé™è®¿é—®**è¯·æ±‚çš„èµ„æºã€‚é€šå¸¸å‘ç”Ÿåœ¨æƒé™ä¸è¶³æ—¶ã€‚

1.  **NotAcceptableException (406 Not Acceptable)**

è¡¨ç¤ºæœåŠ¡å™¨æ— æ³•ç”Ÿæˆå®¢æˆ·ç«¯å¯ä»¥æ¥å—çš„å“åº”æ ¼å¼ã€‚é€šå¸¸å‡ºç°åœ¨å®¢æˆ·ç«¯çš„ Accept å¤´ä¸æœåŠ¡å™¨æ”¯æŒçš„å“åº”æ ¼å¼ä¸åŒ¹é…æ—¶ã€‚

1.  **RequestTimeoutException (408 Request Timeout)**

è¡¨ç¤ºå®¢æˆ·ç«¯**è¯·æ±‚è¶…æ—¶**ã€‚æœåŠ¡å™¨åœ¨ç­‰å¾…è¯·æ±‚æ—¶è¶…è¿‡äº†è®¾å®šçš„æ—¶é—´é™åˆ¶ã€‚

1.  **ConflictException (409 Conflict)**

è¡¨ç¤ºè¯·æ±‚ä¸æœåŠ¡å™¨çš„å½“å‰çŠ¶æ€å­˜åœ¨å†²çªã€‚ä¾‹å¦‚ï¼Œåˆ›å»ºèµ„æºæ—¶ï¼Œèµ„æºå·²ç»å­˜åœ¨ã€‚

1.  **GoneException (410 Gone)**

è¡¨ç¤ºè¯·æ±‚çš„èµ„æºå·²ç»æ°¸ä¹…ä¸å¯ç”¨ï¼Œå¹¶ä¸”ä¸ä¼šå†æ¢å¤ã€‚å¸¸ç”¨äºåˆ é™¤çš„èµ„æºã€‚

1.  **HttpVersionNotSupportedException (505 HTTP Version Not Supported)**

è¡¨ç¤ºæœåŠ¡å™¨ä¸æ”¯æŒå®¢æˆ·ç«¯è¯·æ±‚çš„ HTTP åè®®ç‰ˆæœ¬ã€‚

1.  **PayloadTooLargeException (413 Payload Too Large)**

è¡¨ç¤ºå®¢æˆ·ç«¯å‘é€çš„æ•°æ®ä½“ï¼ˆå¦‚ä¸Šä¼ æ–‡ä»¶ï¼‰è¶…è¿‡äº†æœåŠ¡å™¨å…è®¸çš„å¤§å°é™åˆ¶ã€‚

1.  **UnsupportedMediaTypeException (415 Unsupported Media Type)**

è¡¨ç¤ºå®¢æˆ·ç«¯è¯·æ±‚çš„åª’ä½“ç±»å‹ä¸è¢«æœåŠ¡å™¨æ”¯æŒã€‚ä¾‹å¦‚ï¼Œä¸Šä¼ æ–‡ä»¶çš„æ ¼å¼ä¸è¢«æ¥å—ã€‚

1.  **UnprocessableEntityException (422 Unprocessable Entity)**

è¡¨ç¤ºæœåŠ¡å™¨ç†è§£å®¢æˆ·ç«¯çš„è¯·æ±‚å†…å®¹ï¼Œä½†ç”±äºè¯­ä¹‰é”™è¯¯è€Œæ— æ³•å¤„ç†ã€‚ä¾‹å¦‚ï¼Œè¾“å…¥æ•°æ®çš„æ ¼å¼æ­£ç¡®ä½†å†…å®¹æ— æ•ˆã€‚

1.  **InternalServerErrorException (500 Internal Server Error)**

è¡¨ç¤º**æœåŠ¡å™¨**åœ¨å¤„ç†è¯·æ±‚æ—¶é‡åˆ°äº†**å†…éƒ¨é”™è¯¯**ã€‚æ˜¯ä¸€ä¸ªé€šç”¨çš„é”™è¯¯çŠ¶æ€ç ï¼Œè¡¨ç¤ºæœåŠ¡å™¨æ— æ³•å¤„ç†è¯·æ±‚ã€‚

1.  **NotImplementedException (501 Not Implemented)**

è¡¨ç¤ºæœåŠ¡å™¨ä¸æ”¯æŒè¯·æ±‚çš„æ–¹æ³•ã€‚é€šå¸¸ç”¨äºæœåŠ¡å™¨ä¸æ”¯æŒå®¢æˆ·ç«¯è¯·æ±‚çš„åŠŸèƒ½æ—¶ã€‚

1.  **ImATeapotException (418 Iâ€™m a teapot)**

è¿™æ˜¯ä¸€ä¸ªæ„šäººèŠ‚ç©ç¬‘æ€§è´¨çš„ HTTP çŠ¶æ€ç ï¼Œè¡¨ç¤ºæœåŠ¡å™¨æ‹’ç»é…¿èŒ¶çš„è¯·æ±‚ï¼ˆå‚è§ IETF RFC 2324ï¼‰ã€‚å¸¸ç”¨äºæµ‹è¯•æˆ–å¹½é»˜åœºæ™¯ã€‚

1.  **MethodNotAllowedException (405 Method Not Allowed)**

è¡¨ç¤º**è¯·æ±‚çš„æ–¹æ³•ï¼ˆå¦‚ GETã€POSTï¼‰åœ¨ç›®æ ‡èµ„æºä¸­ä¸å¯ç”¨**ã€‚ä¾‹å¦‚ï¼Œèµ„æºåªæ”¯æŒ GET è¯·æ±‚ï¼Œè€Œå®¢æˆ·ç«¯ä½¿ç”¨äº† POSTã€‚

1.  **BadGatewayException (502 Bad Gateway)**

è¡¨ç¤ºæœåŠ¡å™¨ä½œä¸ºç½‘å…³æˆ–ä»£ç†æ—¶ï¼Œä»ä¸Šæ¸¸æœåŠ¡å™¨æ¥æ”¶åˆ°æ— æ•ˆå“åº”ã€‚

1.  **ServiceUnavailableException (503 Service Unavailable)**

è¡¨ç¤ºæœåŠ¡å™¨æš‚æ—¶æ— æ³•å¤„ç†è¯·æ±‚ï¼Œé€šå¸¸æ˜¯å› ä¸ºè¿‡è½½æˆ–ç»´æŠ¤ã€‚

1.  **GatewayTimeoutException (504 Gateway Timeout)**

è¡¨ç¤ºæœåŠ¡å™¨ä½œä¸ºç½‘å…³æˆ–ä»£ç†æ—¶ï¼Œä»ä¸Šæ¸¸æœåŠ¡å™¨æ¥æ”¶å“åº”è¶…æ—¶ã€‚

1.  **PreconditionFailedException (412 Precondition Failed)**

è¡¨ç¤ºå®¢æˆ·ç«¯å‘é€çš„è¯·æ±‚æ²¡æœ‰æ»¡è¶³æœåŠ¡å™¨çš„æŸäº›å‰ç½®æ¡ä»¶ã€‚ä¾‹å¦‚ï¼ŒIf-Match å¤´å­—æ®µçš„æ¡ä»¶ä¸æ»¡è¶³ã€‚

ä»¥ä¸Šå„ç§ç±»å‹éƒ½å¯ä»¥ä» `@nestjs/common` åŒ…ä¸­å¯¼å‡ºä½¿ç”¨ï¼Œä¾‹å¦‚ `BadRequestException`ï¼š

```typescript
// app.controller.ts
import { BadRequestException } from "@nestjs/common";

@Controller()
export class UsersController {
  @Get("test-error")
  testError() {
    throw new BadRequestException("æµ‹è¯•é”™è¯¯");
  }
}
```

![image 1.png](https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/85bef1e602014f30b0e723a4e61b27b5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I-g6JCd55qE6Jyc:q75.awebp?rk3s=f64ab15b&x-expires=1761404663&x-signature=o4ztHkZLvV57TlPj%2FNa3xIYFXwg%3D)

## 3\. è‡ªå®šä¹‰ HTTP å¼‚å¸¸è¿‡æ»¤å™¨

### 3.1 æ–¹æ³•1ï¼šå®ç° **`ExceptionFilter` æ¥å£**

è‡ªå®šä¹‰çš„å¼‚å¸¸è¿‡æ»¤å™¨éœ€è¦å®ç° `ExceptionFilter` æ¥å£çš„ `catch` æ–¹æ³•ï¼š

```typescript
// src/http-exception.filter.ts
import {
  ExceptionFilter,
  Catch,
  ArgumentsHost,
  HttpException,
} from "@nestjs/common";
import { Request, Response } from "express";

@Catch(HttpException)
export class HttpExceptionFilter implements ExceptionFilter {
  catch(exception: HttpException, host: ArgumentsHost) {
    const ctx = host.switchToHttp();
    const response = ctx.getResponse<Response>();
    const request = ctx.getRequest<Request>();
    const status = exception.getStatus();

    response.status(status).json({
      statusCode: status,
      timestamp: new Date().toISOString(),
      path: request.url,
    });
  }
}
```

åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­é€šè¿‡ `@Catch()` è£…é¥°å™¨\*\*æŒ‡å®šè¦æ•è·çš„å¼‚å¸¸ç±»å‹ï¼ˆ\*\*åªæ•è· `HttpException`ï¼‰ã€‚

`@Catch()` è£…é¥°å™¨ä¹Ÿæ”¯æŒå¯ä»¥é‡‡ç”¨å•ä¸ªå‚æ•°æˆ–é€—å·åˆ†éš”çš„åˆ—è¡¨ï¼Œè¿™å¯ä»¥åŒæ—¶**ä¸ºå¤šç§ç±»å‹çš„å¼‚å¸¸è®¾ç½®è¿‡æ»¤å™¨**ã€‚

å¦‚æœæ²¡æœ‰åœ¨ `@Catch()` ä¸­æŒ‡å®šå¼‚å¸¸ç±»å‹ï¼Œè¿‡æ»¤å™¨**å°†æ•è·æ‰€æœ‰å¼‚å¸¸ç±»å‹**ã€‚è¿™å¯¹äºå…¨å±€å¼‚å¸¸å¤„ç†éå¸¸æœ‰ç”¨ã€‚

### 3.2 æ–¹æ³•2ï¼šç»§æ‰¿ `HttpException` ç±»

è‡ªå®šä¹‰çš„ `CustomHttpException` ç±»ç»§æ‰¿ `HttpException` ç±»ï¼š

```typescript
// src/custom-http-exception.filter.ts
import { HttpException } from "@nestjs/common";

export class CustomHttpException extends HttpException {
  constructor(message: string, statusCode: number) {
    super(message, statusCode);
  }
}
```

ä½¿ç”¨ `CustomHttpException` ç±»å®ä¾‹æŠ›å‡ºå¼‚å¸¸ï¼š

```typescript
// app.controller.ts

@Get('custom')
getCustom(){
  throw new CustomHttpException('åå±±ä¹ƒç¦åœ°ï¼', HttpStatus.FORBIDDEN)
}
```

![image 2.png](https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a9aa60c39eee4ec1b7664ff33be2300e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I-g6JCd55qE6Jyc:q75.awebp?rk3s=f64ab15b&x-expires=1761404663&x-signature=GR6kM2jfqdOrssI3wSIpmoUfVyk%3D)

## 4\. ç»‘å®šèŒƒå›´

è¿‡æ»¤å™¨å¯ä»¥ç»‘å®šçš„èŒƒå›´æœ‰ï¼š

- HTTP æ–¹æ³•
- æ§åˆ¶å™¨
- å…¨å±€èŒƒå›´

### 4.1 HTTP æ–¹æ³•

ä½¿ç”¨ `@UseFilters()` è£…é¥°å™¨å¯ä»¥ä½¿å¾—è¿‡æ»¤å™¨åªåœ¨æŒ‡å®š HTTP æ–¹æ³•ä¸‹èµ·ä½œç”¨ï¼š

```less
// users.controller.ts
@Controller('users')
export class UsersController {
  constructor(private readonly usersService: UsersService) {}

  @Get('custom')
  @UseFilters(new HttpExceptionFilter())
  // @UseFilters(HttpExceptionFilter)
  getCustom() {
    throw new HttpException(
      {
        status: HttpStatus.FORBIDDEN,
        message: 'åå±±ä¹ƒç¦åœ°ï¼è¯·é€Ÿé€Ÿç¦»å»ï¼',
        error: 'Forbidden',
      },
      403,
    );
  }
}
```

è£…é¥°å™¨ä¸­çš„å‚æ•°æ—¢å¯ä»¥ä¼ é€’ä¸€ä¸ªè¿‡æ»¤å™¨çš„å®ä¾‹ï¼ˆ`new HttpExceptionFilter()`ï¼‰ï¼Œä¹Ÿå¯ä»¥ä¼ é€’ä¸€ä¸ªç±»ï¼ˆ`HttpExceptionFilter`ï¼‰ã€‚

![image 3.png](https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9d1dcb10d43e4a4bb590578f6447df9e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I-g6JCd55qE6Jyc:q75.awebp?rk3s=f64ab15b&x-expires=1761404663&x-signature=UnyRGsDx2dL2PJqX8j6ERxCLRog%3D)

### 4.2 æ§åˆ¶å™¨

ä¹Ÿå¯ä»¥åœ¨æŒ‡å®šçš„æ§åˆ¶å™¨ä¸‹ä½¿ç”¨ `@UseFilters()` è£…é¥°å™¨ï¼š

```less
@controller ('users')
@UseFilters(HttpExceptionFilter)
export class UsersController {
  // ...
}
```

è¿™æ ·å°±ä¸ç”¨ç»™è¯¥æ§åˆ¶å™¨ä¸‹çš„æ‰€æœ‰ HTTP æ–¹æ³•éƒ½æ·»åŠ è£…é¥°å™¨äº†ã€‚

### 4.3 å…¨å±€åº”ç”¨

ä½¿ç”¨ `app.useGlobalFilters()` æ–¹æ³•æ¥æ³¨å†Œå…¨å±€å¼‚å¸¸è¿‡æ»¤å™¨ï¼š

```csharp
// main.ts
async function bootstrap() {
  const app = await NestFactory.create(FuelStationModule);
  app.useGlobalFilters(new HttpExceptionFilter());
  await app.listen(3000);
}

bootstrap();
```

è®¾ç½®å®Œæˆåï¼Œåº”ç”¨çš„æ‰€æœ‰æ§åˆ¶å™¨å’Œæ–¹æ³•éƒ½åŠ ä¸Šäº†è¿‡æ»¤å™¨ï¼Œè¿™æ ·åº”ç”¨çš„ä»»ä½•åœ°æ–¹æŠ›å‡ºçš„å¼‚å¸¸éƒ½ä¼šè¢«å…¨å±€æ•è·ï¼Œå¯ä»¥ç¡®ä¿ä¸€è‡´æ€§å’Œå¯æ§çš„é”™è¯¯å“åº”æ ¼å¼ã€‚

ä½†æ˜¯è¿™ç§æ–¹å¼å¹¶ä¸èƒ½çµæ´»åœ°ä¸ä¾èµ–æ³¨å…¥çš„ç‰¹æ€§ç›¸ç»“åˆï¼ŒNestJS æä¾›äº†å¦ä¸€ç§å…¨å±€ç»‘å®šè¿‡æ»¤å™¨çš„æ–¹å¼ï¼š

```perl
// app.module.ts

@Module({
  providers: [
    {
      provide: APP_FILTER,
      useClass: HttpExceptionFilter,
    },
  ],
})
export class AppModule {}
```

## **5\. æ—¥å¿—è®°å½•ä¸å¼‚å¸¸è¿‡æ»¤å™¨**

### 5.1 **è®°å½•å¼‚å¸¸æ—¥å¿—ï¼ˆ**`Logger`**ï¼‰**

é€šè¿‡ NestJS çš„ `Logger` æœåŠ¡è®°å½•å¼‚å¸¸è¯¦ç»†ä¿¡æ¯ï¼Œä»¥ä¾¿åœ¨åº”ç”¨å´©æºƒæ—¶è¿½è¸ªé—®é¢˜ã€‚

```typescript
// http-exception.filter.ts
import {
  ExceptionFilter,
  Catch,
  ArgumentsHost,
  HttpException,
  Logger,
} from "@nestjs/common";
import { Request, Response } from "express";

@Catch(HttpException)
export class HttpExceptionFilter implements ExceptionFilter {
  constructor(private readonly logger: Logger) {}

  catch(exception: HttpException, host: ArgumentsHost) {
    const ctx = host.switchToHttp(); // è·å–è¯·æ±‚ä¸Šä¸‹æ–‡
    const response = ctx.getResponse<Response>(); // è·å–å“åº”å¯¹è±¡
    const request = ctx.getRequest<Request>(); // è·å–è¯·æ±‚å¯¹è±¡
    const status = exception.getStatus(); // è·å–å¼‚å¸¸çŠ¶æ€ç 

    const message = exception.message
      ? exception.message
      : `${status >= 500 ? "æœåŠ¡å™¨é”™è¯¯ï¼ˆService Errorï¼‰" : "å®¢æˆ·ç«¯é”™è¯¯ï¼ˆClient Errorï¼‰"}`;

    const nowTime = new Date().getTime();

    const errorResponse = {
      data: {},
      message,
      code: -1,
      date: nowTime,
      path: request.url,
    };

    // è®°å½•æ—¥å¿—åˆ°æ§åˆ¶å°
    this.logger.error(
      `ã€${nowTime}ã€‘${status} ${request.method} ${request.url} query:${JSON.stringify(request.query)} params:${JSON.stringify(
        request.params
      )} body:${JSON.stringify(request.body)}`,
      JSON.stringify(errorResponse),
      HttpExceptionFilter.name
    );

    response.status(status).json(errorResponse);
  }
}
```

```less
// users.controller.ts
@Get('custom')
@UseFilters(new HttpExceptionFilter(new Logger('UsersController')))
getCustom() {
  throw new HttpException(
    {
      status: HttpStatus.FORBIDDEN,
      message: 'åå±±ä¹ƒç¦åœ°ï¼è¯·é€Ÿé€Ÿç¦»å»ï¼',
      error: 'Forbidden',
    },
    403,
  );
}
```

![image 4.png](https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cb6e1175c3ed4eb39b18fce49b469e44~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I-g6JCd55qE6Jyc:q75.awebp?rk3s=f64ab15b&x-expires=1761404663&x-signature=yaczYyj6zXK9sVsa9LxCYcLQgEQ%3D)

æˆ–æ˜¯ä¾èµ–æ³¨å…¥ç°æœ‰æ—¥å¿—æœåŠ¡ï¼ˆ[nestjs-pino](https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fiamolegga%2Fnestjs-pino "https://github.com/iamolegga/nestjs-pino")ï¼‰ï¼š

```typescript
@Catch(HttpException)
export class HttpExceptionFilter implements ExceptionFilter {
  constructor(private readonly logService: LogService) {}

  catch(exception: HttpException, host: ArgumentsHost) {
    this.logService.logError(exception);
    // å¤„ç†å¼‚å¸¸
  }
}
```

### 5.2Â **å°†é”™è¯¯ä¿¡æ¯å‘é€åˆ°å¤–éƒ¨ç›‘æ§æœåŠ¡ï¼ˆå¦‚ Sentryï¼‰**

é›†æˆå¤–éƒ¨ç›‘æ§æœåŠ¡ï¼Œå¦‚ Sentryï¼Œæ¥æ•è·å’Œåˆ†æé”™è¯¯æ—¥å¿—ï¼š

```typescript
import * as Sentry from "@sentry/node";

@Catch(HttpException)
export class HttpExceptionFilter implements ExceptionFilter {
  catch(exception: HttpException, host: ArgumentsHost) {
    Sentry.captureException(exception);
    // å¤„ç†å¼‚å¸¸
  }
}
```

## 6\. æ€»ç»“

å¼‚å¸¸è¿‡æ»¤å™¨æ˜¯ NestJS æä¾›çš„å¼ºå¤§å·¥å…·ï¼Œç”¨äºæ•è·å’Œå¤„ç†åº”ç”¨ä¸­çš„å¼‚å¸¸ã€‚é€šè¿‡è‡ªå®šä¹‰å’Œå…¨å±€åº”ç”¨è¿‡æ»¤å™¨ï¼Œå¼€å‘è€…å¯ä»¥ç¡®ä¿å¼‚å¸¸å¤„ç†çš„ä¸€è‡´æ€§ï¼Œå¹¶æå‡åº”ç”¨çš„å¥å£®æ€§å’Œç”¨æˆ·ä½“éªŒã€‚åœ¨å¤æ‚é¡¹ç›®ä¸­ï¼Œä¸åŒæ¨¡å—å’ŒæœåŠ¡å¯ä»¥ä½¿ç”¨ä¸åŒçš„è¿‡æ»¤å™¨æ¥å¤„ç†ç‰¹å®šåœºæ™¯ä¸‹çš„å¼‚å¸¸ã€‚

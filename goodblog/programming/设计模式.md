---
title: æ·±å…¥ç†è§£è®¾è®¡æ¨¡å¼ï¼šTypeScriptå®ç°ç»å…¸è®¾è®¡æ¨¡å¼çš„å®Œæ•´æŒ‡å—
slug: design-patterns-typescript-guide
published: true
featured: true
category: å‰ç«¯
publishedAt: 2025-06-15T00:00:00.000Z
readingTime: 11
---

## 1. èƒŒæ™¯ä¸å¼•è¨€

è®¾è®¡æ¨¡å¼æ˜¯è½¯ä»¶å·¥ç¨‹ä¸­è§£å†³å¸¸è§è®¾è®¡é—®é¢˜çš„å¯å¤ç”¨æ–¹æ¡ˆï¼Œå®ƒä»¬ä»£è¡¨äº†æœ€ä½³å®è·µï¼Œæ˜¯ç»è¿‡æ—¶é—´éªŒè¯çš„è§£å†³ç‰¹å®šé—®é¢˜çš„æ–¹æ³•ã€‚åœ¨ç°ä»£Webå¼€å‘ä¸­ï¼Œåˆç†è¿ç”¨è®¾è®¡æ¨¡å¼èƒ½å¤Ÿè®©ä»£ç æ›´åŠ æ¨¡å—åŒ–ã€å¯ç»´æŠ¤å’Œå¯æ‰©å±•ã€‚

### 1.1.1. ä¸ºä»€ä¹ˆè®¾è®¡æ¨¡å¼å¾ˆé‡è¦ï¼Ÿ

åœ¨å¤æ‚çš„å‰ç«¯åº”ç”¨å¼€å‘ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸é¢ä¸´ä»¥ä¸‹æŒ‘æˆ˜ï¼š

- **ä»£ç è€¦åˆåº¦é«˜**ï¼šç»„ä»¶é—´ç›¸äº’ä¾èµ–ï¼Œéš¾ä»¥ç‹¬ç«‹æµ‹è¯•å’Œä¿®æ”¹
- **åŠŸèƒ½æ‰©å±•å›°éš¾**ï¼šæ–°éœ€æ±‚å¯¼è‡´å¤§é‡ä»£ç ä¿®æ”¹
- **ä»£ç é‡å¤**ï¼šç›¸ä¼¼åŠŸèƒ½åœ¨ä¸åŒåœ°æ–¹é‡å¤å®ç°
- **ç»´æŠ¤æˆæœ¬é«˜**ï¼šä»£ç ç»“æ„æ··ä¹±ï¼Œbugä¿®å¤å›°éš¾

è®¾è®¡æ¨¡å¼æä¾›äº†åº”å¯¹è¿™äº›æŒ‘æˆ˜çš„æ ‡å‡†åŒ–è§£å†³æ–¹æ¡ˆï¼Œå¸®åŠ©å¼€å‘è€…å†™å‡ºæ›´ä¼˜é›…ã€æ›´æ˜“ç»´æŠ¤çš„ä»£ç ã€‚

## 2. æ ¸å¿ƒæ¦‚å¿µä¸åˆ†ç±»

### 1.2.1. è®¾è®¡æ¨¡å¼çš„ä¸‰å¤§ç±»å‹

è®¾è®¡æ¨¡å¼é€šå¸¸åˆ†ä¸ºä¸‰å¤§ç±»ï¼š

1. **åˆ›å»ºå‹æ¨¡å¼**ï¼šå…³æ³¨å¯¹è±¡çš„åˆ›å»ºè¿‡ç¨‹
   - å•ä¾‹æ¨¡å¼ã€å·¥å‚æ¨¡å¼ã€å»ºé€ è€…æ¨¡å¼ç­‰

2. **ç»“æ„å‹æ¨¡å¼**ï¼šå…³æ³¨å¯¹è±¡é—´çš„ç»„åˆå…³ç³»
   - è£…é¥°å™¨æ¨¡å¼ã€é€‚é…å™¨æ¨¡å¼ã€ä»£ç†æ¨¡å¼ç­‰

3. **è¡Œä¸ºå‹æ¨¡å¼**ï¼šå…³æ³¨å¯¹è±¡é—´çš„é€šä¿¡å’ŒèŒè´£åˆ†é…
   - è§‚å¯Ÿè€…æ¨¡å¼ã€ç­–ç•¥æ¨¡å¼ã€å‘½ä»¤æ¨¡å¼ç­‰

### 1.2.2. SOLIDåŸåˆ™åŸºç¡€

åœ¨å­¦ä¹ è®¾è®¡æ¨¡å¼å‰ï¼Œäº†è§£SOLIDåŸåˆ™å¾ˆé‡è¦ï¼š

- **S** - å•ä¸€èŒè´£åŸåˆ™
- **O** - å¼€é—­åŸåˆ™
- **L** - é‡Œæ°æ›¿æ¢åŸåˆ™
- **I** - æ¥å£éš”ç¦»åŸåˆ™
- **D** - ä¾èµ–å€’ç½®åŸåˆ™

## 3. ç»å…¸è®¾è®¡æ¨¡å¼çš„TypeScriptå®ç°

### 1.3.1. å‘å¸ƒè®¢é˜…æ¨¡å¼ï¼ˆPublisher-Subscriber Patternï¼‰

å‘å¸ƒè®¢é˜…æ¨¡å¼æ˜¯å‰ç«¯å¼€å‘ä¸­æœ€å¸¸ç”¨çš„æ¨¡å¼ä¹‹ä¸€ï¼Œå®ƒå®ç°äº†å¯¹è±¡é—´çš„æ¾è€¦åˆé€šä¿¡ã€‚

#### 1.3.1.1. åŸºç¡€å®ç°

```typescript
type EventHandler = (...args: any[]) => void;

interface IEventEmitter {
  on(eventName: string, handler: EventHandler): void;
  off(eventName: string, handler: EventHandler): void;
  emit(eventName: string, ...args: any[]): void;
  once(eventName: string, handler: EventHandler): void;
}

class EventEmitter implements IEventEmitter {
  private events: Record<string, EventHandler[]> = {};

  /**
   * è®¢é˜…äº‹ä»¶
   * @param eventName äº‹ä»¶åç§°
   * @param handler äº‹ä»¶å¤„ç†å‡½æ•°
   */
  on(eventName: string, handler: EventHandler): void {
    if (!this.events[eventName]) {
      this.events[eventName] = [];
    }
    this.events[eventName].push(handler);
  }

  /**
   * å–æ¶ˆè®¢é˜…
   * @param eventName äº‹ä»¶åç§°
   * @param handler è¦ç§»é™¤çš„å¤„ç†å‡½æ•°
   */
  off(eventName: string, handler: EventHandler): void {
    const handlers = this.events[eventName];
    if (handlers) {
      this.events[eventName] = handlers.filter((h) => h !== handler);
      // å¦‚æœæ²¡æœ‰å¤„ç†å‡½æ•°äº†ï¼Œåˆ é™¤è¯¥äº‹ä»¶
      if (this.events[eventName].length === 0) {
        delete this.events[eventName];
      }
    }
  }

  /**
   * å‘å¸ƒäº‹ä»¶
   * @param eventName äº‹ä»¶åç§°
   * @param args ä¼ é€’ç»™å¤„ç†å‡½æ•°çš„å‚æ•°
   */
  emit(eventName: string, ...args: any[]): void {
    const handlers = this.events[eventName];
    if (handlers) {
      // åˆ›å»ºå‰¯æœ¬é˜²æ­¢åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­handlersè¢«ä¿®æ”¹
      [...handlers].forEach((handler) => {
        try {
          handler(...args);
        } catch (error) {
          console.error(`Event handler error for ${eventName}:`, error);
        }
      });
    }
  }

  /**
   * ä¸€æ¬¡æ€§è®¢é˜…
   * @param eventName äº‹ä»¶åç§°
   * @param handler äº‹ä»¶å¤„ç†å‡½æ•°
   */
  once(eventName: string, handler: EventHandler): void {
    const onceHandler = (...args: any[]) => {
      handler(...args);
      this.off(eventName, onceHandler);
    };
    this.on(eventName, onceHandler);
  }

  /**
   * è·å–æ‰€æœ‰äº‹ä»¶åç§°
   */
  getEventNames(): string[] {
    return Object.keys(this.events);
  }

  /**
   * æ¸…é™¤æ‰€æœ‰äº‹ä»¶ç›‘å¬å™¨
   */
  clear(): void {
    this.events = {};
  }
}
```

#### 1.3.1.2. å®é™…åº”ç”¨åœºæ™¯

```typescript
// ç”¨æˆ·çŠ¶æ€ç®¡ç†ç¤ºä¾‹
interface User {
  id: string;
  name: string;
  avatar?: string;
}

class UserService extends EventEmitter {
  private currentUser: User | null = null;

  async login(credentials: {
    username: string;
    password: string;
  }): Promise<User> {
    try {
      // æ¨¡æ‹Ÿç™»å½•APIè°ƒç”¨
      const user = await this.authenticateUser(credentials);
      this.currentUser = user;

      // å‘å¸ƒç™»å½•æˆåŠŸäº‹ä»¶
      this.emit("user:login", user);
      this.emit("user:change", user);

      return user;
    } catch (error) {
      this.emit("user:loginError", error);
      throw error;
    }
  }

  logout(): void {
    const user = this.currentUser;
    this.currentUser = null;
    this.emit("user:logout", user);
    this.emit("user:change", null);
  }

  private async authenticateUser(credentials: any): Promise<User> {
    // æ¨¡æ‹ŸAPIè°ƒç”¨
    return new Promise((resolve) => {
      setTimeout(() => {
        resolve({
          id: "1",
          name: credentials.username,
          avatar: "https://example.com/avatar.jpg",
        });
      }, 1000);
    });
  }
}

// ä½¿ç”¨ç¤ºä¾‹
const userService = new UserService();

// è®¢é˜…ç”¨æˆ·çŠ¶æ€å˜åŒ–
userService.on("user:login", (user: User) => {
  console.log(`æ¬¢è¿ ${user.name}ï¼`);
  // æ›´æ–°UIçŠ¶æ€
});

userService.on("user:logout", () => {
  console.log("ç”¨æˆ·å·²é€€å‡º");
  // æ¸…ç†ç”¨æˆ·æ•°æ®
});

userService.on("user:change", (user: User | null) => {
  // é€šçŸ¥æ‰€æœ‰ç»„ä»¶æ›´æ–°ç”¨æˆ·çŠ¶æ€
  updateGlobalUserState(user);
});

function updateGlobalUserState(user: User | null) {
  // å®é™…çš„çŠ¶æ€æ›´æ–°é€»è¾‘
  console.log("Global user state updated:", user);
}
```

### 1.3.2. å•ä¾‹æ¨¡å¼ï¼ˆSingleton Patternï¼‰

å•ä¾‹æ¨¡å¼ç¡®ä¿ä¸€ä¸ªç±»åªæœ‰ä¸€ä¸ªå®ä¾‹ï¼Œå¸¸ç”¨äºå…¨å±€çŠ¶æ€ç®¡ç†ã€é…ç½®ç®¡ç†ç­‰åœºæ™¯ã€‚

#### 1.3.2.1. çº¿ç¨‹å®‰å…¨çš„å•ä¾‹å®ç°

```typescript
class ConfigManager {
  private static instance: ConfigManager;
  private config: Record<string, any> = {};
  private isInitialized = false;

  private constructor() {
    // ç§æœ‰æ„é€ å‡½æ•°é˜²æ­¢å¤–éƒ¨å®ä¾‹åŒ–
  }

  static getInstance(): ConfigManager {
    if (!ConfigManager.instance) {
      ConfigManager.instance = new ConfigManager();
    }
    return ConfigManager.instance;
  }

  async initialize(): Promise<void> {
    if (this.isInitialized) return;

    try {
      // æ¨¡æ‹Ÿä»æœåŠ¡å™¨åŠ è½½é…ç½®
      this.config = await this.loadConfigFromServer();
      this.isInitialized = true;
      console.log("Configuration loaded successfully");
    } catch (error) {
      console.error("Failed to load configuration:", error);
      throw error;
    }
  }

  get<T>(key: string, defaultValue?: T): T {
    if (!this.isInitialized) {
      throw new Error(
        "ConfigManager not initialized. Call initialize() first."
      );
    }
    return this.config[key] ?? defaultValue;
  }

  set(key: string, value: any): void {
    this.config[key] = value;
  }

  getAll(): Record<string, any> {
    return { ...this.config };
  }

  private async loadConfigFromServer(): Promise<Record<string, any>> {
    // æ¨¡æ‹ŸAPIè°ƒç”¨
    return new Promise((resolve) => {
      setTimeout(() => {
        resolve({
          apiBaseUrl: "https://api.example.com",
          timeout: 5000,
          retryAttempts: 3,
          enableAnalytics: true,
        });
      }, 500);
    });
  }
}

// ä½¿ç”¨ç¤ºä¾‹
async function initializeApp() {
  const config = ConfigManager.getInstance();
  await config.initialize();

  const apiUrl = config.get<string>("apiBaseUrl");
  const timeout = config.get<number>("timeout", 3000);

  console.log(`API URL: ${apiUrl}, Timeout: ${timeout}ms`);
}
```

### 1.3.3. å·¥å‚æ¨¡å¼ï¼ˆFactory Patternï¼‰

å·¥å‚æ¨¡å¼å°†å¯¹è±¡åˆ›å»ºé€»è¾‘å°è£…èµ·æ¥ï¼Œå®¢æˆ·ç«¯æ— éœ€çŸ¥é“å…·ä½“çš„åˆ›å»ºç»†èŠ‚ã€‚

#### 1.3.3.1. æŠ½è±¡å·¥å‚æ¨¡å¼å®ç°

```typescript
// äº§å“æ¥å£
interface Button {
  render(): string;
  onClick(): void;
}

interface Dialog {
  render(): string;
  show(): void;
}

// å…·ä½“äº§å“å®ç°
class WindowsButton implements Button {
  render(): string {
    return '<button class="windows-btn">Windows Button</button>';
  }

  onClick(): void {
    console.log("Windows button clicked");
  }
}

class MacButton implements Button {
  render(): string {
    return '<button class="mac-btn">Mac Button</button>';
  }

  onClick(): void {
    console.log("Mac button clicked");
  }
}

class WindowsDialog implements Dialog {
  render(): string {
    return '<div class="windows-dialog">Windows Dialog</div>';
  }

  show(): void {
    console.log("Showing Windows dialog");
  }
}

class MacDialog implements Dialog {
  render(): string {
    return '<div class="mac-dialog">Mac Dialog</div>';
  }

  show(): void {
    console.log("Showing Mac dialog");
  }
}

// æŠ½è±¡å·¥å‚
abstract class UIFactory {
  abstract createButton(): Button;
  abstract createDialog(): Dialog;
}

// å…·ä½“å·¥å‚
class WindowsUIFactory extends UIFactory {
  createButton(): Button {
    return new WindowsButton();
  }

  createDialog(): Dialog {
    return new WindowsDialog();
  }
}

class MacUIFactory extends UIFactory {
  createButton(): Button {
    return new MacButton();
  }

  createDialog(): Dialog {
    return new MacDialog();
  }
}

// å·¥å‚é€‰æ‹©å™¨
class UIFactorySelector {
  static createFactory(platform: "windows" | "mac"): UIFactory {
    switch (platform) {
      case "windows":
        return new WindowsUIFactory();
      case "mac":
        return new MacUIFactory();
      default:
        throw new Error(`Unsupported platform: ${platform}`);
    }
  }
}

// ä½¿ç”¨ç¤ºä¾‹

function createUI(platform: "windows" | "mac") {
  const factory = UIFactorySelector.createFactory(platform);
  const button = factory.createButton();
  const dialog = factory.createDialog();

  console.log(button.render());
  console.log(dialog.render());

  button.onClick();
  dialog.show();
}

// æ ¹æ®ç”¨æˆ·ç³»ç»Ÿè‡ªåŠ¨é€‰æ‹©
const userPlatform = navigator.platform.toLowerCase().includes("mac")
  ? "mac"
  : "windows";
createUI(userPlatform);
```

### 1.3.4. ç­–ç•¥æ¨¡å¼ï¼ˆStrategy Patternï¼‰

ç­–ç•¥æ¨¡å¼å®šä¹‰äº†ä¸€ç³»åˆ—ç®—æ³•ï¼Œä½¿å®ƒä»¬å¯ä»¥ç›¸äº’æ›¿æ¢ï¼Œè®©ç®—æ³•çš„å˜åŒ–ç‹¬ç«‹äºä½¿ç”¨ç®—æ³•çš„å®¢æˆ·ç«¯ã€‚

#### 1.3.4.1. æ”¯ä»˜ç­–ç•¥å®ç°

```typescript
// ç­–ç•¥æ¥å£
interface PaymentStrategy {
  processPayment(amount: number, currency: string): Promise<PaymentResult>;
  validatePayment(amount: number): boolean;
}

// æ”¯ä»˜ç»“æœæ¥å£
interface PaymentResult {
  success: boolean;
  transactionId?: string;
  message: string;
}

// å…·ä½“ç­–ç•¥å®ç°
class CreditCardStrategy implements PaymentStrategy {
  constructor(
    private cardNumber: string,
    private cvv: string,
    private expiryDate: string
  ) {}

  validatePayment(amount: number): boolean {
    return amount > 0 && amount <= 10000 && this.isValidCard();
  }

  async processPayment(
    amount: number,
    currency: string
  ): Promise<PaymentResult> {
    if (!this.validatePayment(amount)) {
      return {
        success: false,
        message: "Invalid payment amount or card details",
      };
    }

    // æ¨¡æ‹Ÿä¿¡ç”¨å¡æ”¯ä»˜å¤„ç†
    return new Promise((resolve) => {
      setTimeout(() => {
        resolve({
          success: true,
          transactionId: `CC_${Date.now()}`,
          message: `Successfully charged ${amount} ${currency} to credit card ending in ${this.cardNumber.slice(-4)}`,
        });
      }, 1500);
    });
  }

  private isValidCard(): boolean {
    // ç®€å•çš„å¡å·éªŒè¯ï¼ˆå®é™…åº”ç”¨ä¸­éœ€è¦æ›´å¤æ‚çš„éªŒè¯ï¼‰
    return this.cardNumber.length >= 16 && this.cvv.length >= 3;
  }
}

class PayPalStrategy implements PaymentStrategy {
  constructor(
    private email: string,
    private password: string
  ) {}

  validatePayment(amount: number): boolean {
    return amount > 0 && this.isValidCredentials();
  }

  async processPayment(
    amount: number,
    currency: string
  ): Promise<PaymentResult> {
    if (!this.validatePayment(amount)) {
      return {
        success: false,
        message: "Invalid payment amount or PayPal credentials",
      };
    }

    // æ¨¡æ‹ŸPayPalæ”¯ä»˜å¤„ç†
    return new Promise((resolve) => {
      setTimeout(() => {
        resolve({
          success: true,
          transactionId: `PP_${Date.now()}`,
          message: `Successfully processed ${amount} ${currency} via PayPal (${this.email})`,
        });
      }, 1000);
    });
  }

  private isValidCredentials(): boolean {
    return this.email.includes("@") && this.password.length >= 6;
  }
}

class CryptoStrategy implements PaymentStrategy {
  constructor(
    private walletAddress: string,

    private cryptoType: "BTC" | "ETH"
  ) {}

  validatePayment(amount: number): boolean {
    return amount > 0 && this.isValidWallet();
  }

  async processPayment(
    amount: number,
    currency: string
  ): Promise<PaymentResult> {
    if (!this.validatePayment(amount)) {
      return {
        success: false,
        message: "Invalid payment amount or wallet address",
      };
    }

    // æ¨¡æ‹ŸåŠ å¯†è´§å¸æ”¯ä»˜å¤„ç†
    return new Promise((resolve) => {
      setTimeout(() => {
        resolve({
          success: true,
          transactionId: `${this.cryptoType}_${Date.now()}`,
          message: `Successfully processed ${amount} ${currency} via ${this.cryptoType} wallet ${this.walletAddress.slice(0, 8)}...`,
        });
      }, 2000);
    });
  }

  private isValidWallet(): boolean {
    return this.walletAddress.length >= 26;
  }
}

// æ”¯ä»˜ä¸Šä¸‹æ–‡
class PaymentProcessor {
  private strategy: PaymentStrategy;

  constructor(strategy: PaymentStrategy) {
    this.strategy = strategy;
  }

  setStrategy(strategy: PaymentStrategy): void {
    this.strategy = strategy;
  }

  async executePayment(
    amount: number,
    currency: string = "USD"
  ): Promise<PaymentResult> {
    console.log(`Processing payment of ${amount} ${currency}...`);

    try {
      const result = await this.strategy.processPayment(amount, currency);
      console.log(result.message);
      return result;
    } catch (error) {
      console.error("Payment processing failed:", error);
      return {
        success: false,
        message: "Payment processing failed due to system error",
      };
    }
  }
}

// ä½¿ç”¨ç¤ºä¾‹
async function demonstratePaymentStrategies() {
  const processor = new PaymentProcessor(
    new CreditCardStrategy("1234567812345678", "123", "12/25")
  );

  // ä¿¡ç”¨å¡æ”¯ä»˜
  let result = await processor.executePayment(100);
  console.log("Credit Card Result:", result);

  // åˆ‡æ¢åˆ°PayPalæ”¯ä»˜
  processor.setStrategy(new PayPalStrategy("user@example.com", "password123"));
  result = await processor.executePayment(50);
  console.log("PayPal Result:", result);

  // åˆ‡æ¢åˆ°åŠ å¯†è´§å¸æ”¯ä»˜
  processor.setStrategy(
    new CryptoStrategy("1A1zP1eP5QGefi2DMPTfTL5SLmv7DivfNa", "BTC")
  );
  result = await processor.executePayment(0.001);
  console.log("Crypto Result:", result);
}
```

### 1.3.5. è£…é¥°å™¨æ¨¡å¼ï¼ˆDecorator Patternï¼‰

è£…é¥°å™¨æ¨¡å¼å…è®¸åœ¨ä¸ä¿®æ”¹åŸå¯¹è±¡çš„æƒ…å†µä¸‹ï¼ŒåŠ¨æ€åœ°æ·»åŠ æ–°åŠŸèƒ½ã€‚

#### 1.3.5.1. TypeScriptè£…é¥°å™¨å®ç°

```typescript
// æ–¹æ³•è£…é¥°å™¨ï¼šæ€§èƒ½ç›‘æ§
function performanceMonitor(
  target: any,
  propertyKey: string,
  descriptor: PropertyDescriptor
) {
  const originalMethod = descriptor.value;

  descriptor.value = function (...args: any[]) {
    const startTime = performance.now();
    console.log(`ğŸš€ å¼€å§‹æ‰§è¡Œ ${propertyKey} æ–¹æ³•`);

    const result = originalMethod.apply(this, args);

    // å¤„ç†å¼‚æ­¥æ–¹æ³•
    if (result instanceof Promise) {
      return result
        .then((data) => {
          const endTime = performance.now();
          console.log(
            `âœ… ${propertyKey} æ–¹æ³•æ‰§è¡Œå®Œæˆï¼Œè€—æ—¶: ${(endTime - startTime).toFixed(2)}ms`
          );
          return data;
        })
        .catch((error) => {
          const endTime = performance.now();
          console.log(
            `âŒ ${propertyKey} æ–¹æ³•æ‰§è¡Œå¤±è´¥ï¼Œè€—æ—¶: ${(endTime - startTime).toFixed(2)}ms`
          );
          throw error;
        });
    } else {
      const endTime = performance.now();
      console.log(
        `âœ… ${propertyKey} æ–¹æ³•æ‰§è¡Œå®Œæˆï¼Œè€—æ—¶: ${(endTime - startTime).toFixed(2)}ms`
      );
      return result;
    }
  };

  return descriptor;
}

// æ–¹æ³•è£…é¥°å™¨ï¼šç¼“å­˜
function cache(maxAge: number = 60000) {
  // é»˜è®¤1åˆ†é’Ÿç¼“å­˜
  return function (
    target: any,
    propertyKey: string,
    descriptor: PropertyDescriptor
  ) {
    const originalMethod = descriptor.value;
    const cacheMap = new Map<string, { value: any; timestamp: number }>();

    descriptor.value = function (...args: any[]) {
      const cacheKey = JSON.stringify(args);
      const cached = cacheMap.get(cacheKey);
      const now = Date.now();

      // æ£€æŸ¥ç¼“å­˜æ˜¯å¦æœ‰æ•ˆ
      if (cached && now - cached.timestamp < maxAge) {
        console.log(`ğŸ“¦ ä»ç¼“å­˜è·å– ${propertyKey} çš„ç»“æœ`);
        return cached.value;
      }

      const result = originalMethod.apply(this, args);

      // å¤„ç†å¼‚æ­¥æ–¹æ³•
      if (result instanceof Promise) {
        return result.then((data) => {
          cacheMap.set(cacheKey, { value: data, timestamp: now });
          console.log(`ğŸ’¾ ç¼“å­˜ ${propertyKey} çš„ç»“æœ`);
          return data;
        });
      } else {
        cacheMap.set(cacheKey, { value: result, timestamp: now });
        console.log(`ğŸ’¾ ç¼“å­˜ ${propertyKey} çš„ç»“æœ`);
        return result;
      }
    };

    return descriptor;
  };
}

// æ–¹æ³•è£…é¥°å™¨ï¼šé‡è¯•æœºåˆ¶
function retry(maxAttempts: number = 3, delay: number = 1000) {
  return function (
    target: any,
    propertyKey: string,
    descriptor: PropertyDescriptor
  ) {
    const originalMethod = descriptor.value;

    descriptor.value = async function (...args: any[]) {
      let lastError: Error;

      for (let attempt = 1; attempt <= maxAttempts; attempt++) {
        try {
          console.log(`ğŸ”„ ${propertyKey} ç¬¬ ${attempt} æ¬¡å°è¯•`);
          const result = await originalMethod.apply(this, args);

          if (attempt > 1) {
            console.log(`âœ… ${propertyKey} åœ¨ç¬¬ ${attempt} æ¬¡å°è¯•åæˆåŠŸ`);
          }

          return result;
        } catch (error) {
          lastError = error as Error;
          console.log(`âŒ ${propertyKey} ç¬¬ ${attempt} æ¬¡å°è¯•å¤±è´¥: ${error}`);

          if (attempt < maxAttempts) {
            console.log(`â³ ${delay}ms åé‡è¯•...`);
            await new Promise((resolve) => setTimeout(resolve, delay));
          }
        }
      }

      console.log(`ğŸ’¥ ${propertyKey} åœ¨ ${maxAttempts} æ¬¡å°è¯•åä»ç„¶å¤±è´¥`);
      throw lastError;
    };

    return descriptor;
  };
}

// åº”ç”¨è£…é¥°å™¨çš„æœåŠ¡ç±»
class DataService {
  @performanceMonitor
  @cache(30000) // 30ç§’ç¼“å­˜
  async fetchUserData(userId: string): Promise<any> {
    // æ¨¡æ‹ŸAPIè°ƒç”¨
    console.log(`ğŸŒ æ­£åœ¨ä»æœåŠ¡å™¨è·å–ç”¨æˆ· ${userId} çš„æ•°æ®...`);

    return new Promise((resolve) => {
      setTimeout(() => {
        resolve({
          id: userId,
          name: `User ${userId}`,
          email: `user${userId}@example.com`,
          lastLogin: new Date().toISOString(),
        });
      }, 1000);
    });
  }

  @performanceMonitor
  @retry(3, 500)
  async uploadFile(file: File): Promise<string> {
    console.log(`ğŸ“¤ æ­£åœ¨ä¸Šä¼ æ–‡ä»¶: ${file.name}`);

    // æ¨¡æ‹Ÿä¸ç¨³å®šçš„ç½‘ç»œè¿æ¥
    if (Math.random() < 0.6) {
      throw new Error("ç½‘ç»œè¿æ¥ä¸ç¨³å®š");
    }

    return new Promise((resolve) => {
      setTimeout(() => {
        resolve(`upload_${Date.now()}_${file.name}`);
      }, 800);
    });
  }

  @performanceMonitor
  calculateComplexData(input: number[]): number {
    console.log(`ğŸ§® æ­£åœ¨è®¡ç®—å¤æ‚æ•°æ®ï¼Œè¾“å…¥é•¿åº¦: ${input.length}`);

    // æ¨¡æ‹Ÿå¤æ‚è®¡ç®—
    let result = 0;
    for (let i = 0; i < input.length; i++) {
      for (let j = 0; j < 1000; j++) {
        result += Math.sqrt(input[i] * j);
      }
    }

    return result;
  }
}

// ä½¿ç”¨ç¤ºä¾‹
async function demonstrateDecorators() {
  const dataService = new DataService();

  console.log("=== æµ‹è¯•ç¼“å­˜è£…é¥°å™¨ ===");
  await dataService.fetchUserData("123");
  await dataService.fetchUserData("123"); // è¿™æ¬¡ä¼šä»ç¼“å­˜è·å–

  console.log("\n=== æµ‹è¯•é‡è¯•è£…é¥°å™¨ ===");
  const fakeFile = new File(["test content"], "test.txt", {
    type: "text/plain",
  });
  try {
    await dataService.uploadFile(fakeFile);
  } catch (error) {
    console.log("ä¸Šä¼ æœ€ç»ˆå¤±è´¥");
  }

  console.log("\n=== æµ‹è¯•æ€§èƒ½ç›‘æ§è£…é¥°å™¨ ===");
  const testData = Array.from({ length: 1000 }, (_, i) => i);
  dataService.calculateComplexData(testData);
}
```

## 4. æœ€ä½³å®è·µä¸æ³¨æ„äº‹é¡¹

### 1.4.1. è®¾è®¡æ¨¡å¼é€‰æ‹©æŒ‡å—

1. **å‘å¸ƒè®¢é˜…æ¨¡å¼**
   - âœ… é€‚ç”¨åœºæ™¯ï¼šç»„ä»¶é—´é€šä¿¡ã€çŠ¶æ€ç®¡ç†ã€äº‹ä»¶ç³»ç»Ÿ
   - âš ï¸ æ³¨æ„äº‹é¡¹ï¼šé¿å…è¿‡åº¦ä½¿ç”¨å¯¼è‡´è°ƒè¯•å›°éš¾ï¼ŒåŠæ—¶æ¸…ç†ç›‘å¬å™¨é˜²æ­¢å†…å­˜æ³„æ¼

2. **å•ä¾‹æ¨¡å¼**
   - âœ… é€‚ç”¨åœºæ™¯ï¼šå…¨å±€é…ç½®ã€ç¼“å­˜ç®¡ç†ã€æ—¥å¿—æœåŠ¡
   - âš ï¸ æ³¨æ„äº‹é¡¹ï¼šè°¨æ…ä½¿ç”¨ï¼Œå¯èƒ½å¯¼è‡´å…¨å±€çŠ¶æ€é—®é¢˜å’Œæµ‹è¯•å›°éš¾

3. **å·¥å‚æ¨¡å¼**
   - âœ… é€‚ç”¨åœºæ™¯ï¼šå¤æ‚å¯¹è±¡åˆ›å»ºã€å¤šå¹³å°å…¼å®¹ã€ä¾èµ–æ³¨å…¥
   - âš ï¸ æ³¨æ„äº‹é¡¹ï¼šé¿å…è¿‡åº¦æŠ½è±¡ï¼Œä¿æŒä»£ç çš„å¯è¯»æ€§

4. **ç­–ç•¥æ¨¡å¼**
   - âœ… é€‚ç”¨åœºæ™¯ï¼šç®—æ³•é€‰æ‹©ã€æ”¯ä»˜æ–¹å¼ã€æ•°æ®å¤„ç†ç­–ç•¥
   - âš ï¸ æ³¨æ„äº‹é¡¹ï¼šç¡®ä¿ç­–ç•¥æ¥å£è®¾è®¡åˆç†ï¼Œé¿å…ç­–ç•¥çˆ†ç‚¸

5. **è£…é¥°å™¨æ¨¡å¼**
   - âœ… é€‚ç”¨åœºæ™¯ï¼šåŠŸèƒ½å¢å¼ºã€AOPç¼–ç¨‹ã€æƒé™æ§åˆ¶
   - âš ï¸ æ³¨æ„äº‹é¡¹ï¼šæ³¨æ„æ‰§è¡Œé¡ºåºï¼Œé¿å…è£…é¥°å™¨é“¾è¿‡é•¿

### 1.4.2. æ€§èƒ½ä¼˜åŒ–å»ºè®®

```typescript
// 1. äº‹ä»¶ç›‘å¬å™¨ç®¡ç†
class OptimizedEventEmitter extends EventEmitter {
  private maxListeners = 10;

  on(eventName: string, handler: EventHandler): void {
    super.on(eventName, handler);

    const handlers = this.events[eventName];
    if (handlers && handlers.length > this.maxListeners) {
      console.warn(
        `Event ${eventName} has ${handlers.length} listeners, consider optimizing`
      );
    }
  }

  // æ‰¹é‡ç§»é™¤ç›‘å¬å™¨
  removeAllListeners(eventName?: string): void {
    if (eventName) {
      delete this.events[eventName];
    } else {
      this.events = {};
    }
  }
}

// 2. ç¼“å­˜ç­–ç•¥ä¼˜åŒ–
class LRUCache<K, V> {
  private cache = new Map<K, V>();
  private maxSize: number;

  constructor(maxSize: number = 100) {
    this.maxSize = maxSize;
  }

  get(key: K): V | undefined {
    const value = this.cache.get(key);
    if (value !== undefined) {
      // ç§»åˆ°æœ€æ–°ä½ç½®
      this.cache.delete(key);
      this.cache.set(key, value);
    }
    return value;
  }

  set(key: K, value: V): void {
    if (this.cache.has(key)) {
      this.cache.delete(key);
    } else if (this.cache.size >= this.maxSize) {
      // åˆ é™¤æœ€ä¹…æœªä½¿ç”¨çš„é¡¹
      const firstKey = this.cache.keys().next().value;
      this.cache.delete(firstKey);
    }

    this.cache.set(key, value);
  }
}
```

### 1.4.3. å¸¸è§é™·é˜±ä¸è§£å†³æ–¹æ¡ˆ

1. **å†…å­˜æ³„æ¼é—®é¢˜**

```typescript
// âŒ é”™è¯¯ç¤ºä¾‹ï¼šå¿˜è®°æ¸…ç†ç›‘å¬å™¨
class Component {
  constructor() {
    globalEventBus.on("data-update", this.handleUpdate);
  }

  handleUpdate = (data: any) => {
    // å¤„ç†æ›´æ–°
  };

  // ç»„ä»¶é”€æ¯æ—¶å¿˜è®°æ¸…ç†
}

// âœ… æ­£ç¡®ç¤ºä¾‹ï¼šåŠæ—¶æ¸…ç†
class Component {
  constructor() {
    globalEventBus.on("data-update", this.handleUpdate);
  }

  handleUpdate = (data: any) => {
    // å¤„ç†æ›´æ–°
  };

  destroy() {
    globalEventBus.off("data-update", this.handleUpdate);
  }
}
```

2. **è¿‡åº¦è®¾è®¡é—®é¢˜**

```typescript
// âŒ è¿‡åº¦æŠ½è±¡
interface Shape {
  draw(): void;
}

class ShapeFactory {
  createShape(type: string): Shape {
    // ä¸ºç®€å•å½¢çŠ¶åˆ›å»ºå¤æ‚å·¥å‚
  }
}

// âœ… é€‚åº¦æŠ½è±¡
class Rectangle {
  draw(): void {
    console.log("Drawing rectangle");
  }
}

class Circle {
  draw(): void {
    console.log("Drawing circle");
  }
}
```

## 5. å®é™…é¡¹ç›®åº”ç”¨æ¡ˆä¾‹

### 1.5.1. çŠ¶æ€ç®¡ç†ç³»ç»Ÿ

```typescript
// åŸºäºè®¾è®¡æ¨¡å¼çš„è½»é‡çº§çŠ¶æ€ç®¡ç†
class StateManager extends EventEmitter {
  private state: Record<string, any> = {};
  private middleware: Array<(action: Action, state: any) => void> = [];

  // ç­–ç•¥æ¨¡å¼ï¼šä¸åŒçš„çŠ¶æ€æ›´æ–°ç­–ç•¥
  private updateStrategies = {
    merge: (state: any, payload: any) => ({ ...state, ...payload }),
    replace: (state: any, payload: any) => payload,
    append: (state: any, payload: any) => [...state, ...payload],
  };

  dispatch(action: Action): void {
    // ä¸­é—´ä»¶å¤„ç†
    this.middleware.forEach((mw) => mw(action, this.state));

    const strategy = this.updateStrategies[action.strategy || "merge"];

    const oldState = { ...this.state };

    this.state = strategy(this.state, action.payload);

    // å‘å¸ƒçŠ¶æ€å˜åŒ–
    this.emit("state:change", {
      action,
      oldState,
      newState: this.state,
    });
  }

  getState(): any {
    return { ...this.state };
  }

  // è£…é¥°å™¨æ¨¡å¼ï¼šæ·»åŠ ä¸­é—´ä»¶
  addMiddleware(middleware: (action: Action, state: any) => void): void {
    this.middleware.push(middleware);
  }
}

interface Action {
  type: string;
  payload: any;

  strategy?: "merge" | "replace" | "append";
}

// ä½¿ç”¨ç¤ºä¾‹
const stateManager = new StateManager();

// æ·»åŠ æ—¥å¿—ä¸­é—´ä»¶
stateManager.addMiddleware((action, state) => {
  console.log(`Action: ${action.type}`, { action, state });
});

// ç›‘å¬çŠ¶æ€å˜åŒ–
stateManager.on("state:change", ({ action, oldState, newState }) => {
  console.log("State changed:", { action: action.type, oldState, newState });
});

// åˆ†å‘åŠ¨ä½œ
stateManager.dispatch({
  type: "SET_USER",
  payload: { id: 1, name: "John" },
  strategy: "merge",
});
```

## 6. æ€»ç»“ä¸æ‰©å±•

### 1.6.1. å…³é”®è¦ç‚¹å›é¡¾

1. **è®¾è®¡æ¨¡å¼ä¸æ˜¯é“¶å¼¹**ï¼šåˆç†é€‰æ‹©ï¼Œé¿å…è¿‡åº¦è®¾è®¡
2. **TypeScriptå¢å¼º**ï¼šåˆ©ç”¨ç±»å‹ç³»ç»Ÿæé«˜ä»£ç å®‰å…¨æ€§
3. **æ€§èƒ½è€ƒè™‘**ï¼šæ³¨æ„å†…å­˜ä½¿ç”¨å’Œæ‰§è¡Œæ•ˆç‡
4. **æµ‹è¯•å‹å¥½**ï¼šè®¾è®¡æ—¶è€ƒè™‘å¯æµ‹è¯•æ€§
5. **å›¢é˜Ÿåä½œ**ï¼šç»Ÿä¸€æ¨¡å¼ä½¿ç”¨è§„èŒƒ

### 1.6.2. è¿›é˜¶å­¦ä¹ æ–¹å‘

1. **æ›´å¤šè®¾è®¡æ¨¡å¼**ï¼šä»£ç†æ¨¡å¼ã€é€‚é…å™¨æ¨¡å¼ã€å»ºé€ è€…æ¨¡å¼ç­‰
2. **æ¶æ„æ¨¡å¼**ï¼šMVCã€MVPã€MVVMã€DDDç­‰
3. **å‡½æ•°å¼ç¼–ç¨‹æ¨¡å¼**ï¼šå‡½å­ã€å•å­ã€æŸ¯é‡ŒåŒ–ç­‰
4. **å“åº”å¼ç¼–ç¨‹**ï¼šRxJSã€çŠ¶æ€æµç®¡ç†ç­‰

### 1.6.3. æ¨èèµ„æº

- **ç»å…¸ä¹¦ç±**ï¼šã€Šè®¾è®¡æ¨¡å¼ï¼šå¯å¤ç”¨é¢å‘å¯¹è±¡è½¯ä»¶çš„åŸºç¡€ã€‹
- **ç°ä»£å®è·µ**ï¼šã€ŠJavaScriptè®¾è®¡æ¨¡å¼ä¸å¼€å‘å®è·µã€‹
- **TypeScriptå®˜æ–¹æ–‡æ¡£**ï¼šè£…é¥°å™¨ã€é«˜çº§ç±»å‹ä½¿ç”¨
- **å¼€æºé¡¹ç›®**ï¼šå­¦ä¹ ä¼˜ç§€å¼€æºé¡¹ç›®ä¸­çš„æ¨¡å¼åº”ç”¨

é€šè¿‡ç³»ç»Ÿå­¦ä¹ å’Œå®è·µè¿™äº›è®¾è®¡æ¨¡å¼ï¼Œä½ å°†èƒ½å¤Ÿç¼–å†™å‡ºæ›´åŠ ä¼˜é›…ã€å¯ç»´æŠ¤å’Œå¯æ‰©å±•çš„TypeScriptä»£ç ã€‚è®°ä½ï¼Œè®¾è®¡æ¨¡å¼æ˜¯å·¥å…·ï¼Œå…³é”®åœ¨äºåœ¨åˆé€‚çš„åœºæ™¯ä¸‹ä½¿ç”¨åˆé€‚çš„æ¨¡å¼ã€‚

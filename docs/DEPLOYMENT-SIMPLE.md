# Spring Lament åšå®¢ç³»ç»Ÿéƒ¨ç½²æŒ‡å—

## ğŸš€ å¿«é€Ÿéƒ¨ç½²ï¼ˆ10åˆ†é’Ÿå®Œæˆï¼‰

> åœ¨SSHç»ˆç«¯è¾“å…¥ä»¥ä¸‹å‘½ä»¤æ¥æŸ¥çœ‹é¢æ¿å…¥å£ï¼š`/etc/init.d/bt default`

### ç¯å¢ƒè¦æ±‚

- Node.js >= 18.0.0
- PM2 è¿›ç¨‹ç®¡ç†å™¨
- Nginx åå‘ä»£ç†
- MySQL/PostgreSQL æ•°æ®åº“

### 1. ä¸Šä¼ ä»£ç 

```bash
# ä¸Šä¼ åˆ°æœåŠ¡å™¨ç›®å½•
cd /www/wwwroot/my-next-app
```

### 2. å®‰è£…ä¾èµ–

```bash
npm install
```

### 3. é…ç½®ç¯å¢ƒå˜é‡

åˆ›å»º `.env.production` æ–‡ä»¶ï¼š

```bash
# æ•°æ®åº“è¿æ¥
DATABASE_URL="mysql://username:password@localhost:3306/spring_lament"

# NextAuth é…ç½®
NEXTAUTH_SECRET="your-very-secure-secret-key"
NEXTAUTH_URL="https://your-domain.com"

# ç®¡ç†å‘˜è´¦æˆ·
ADMIN_USERNAME="admin"
ADMIN_PASSWORD="your-secure-password"

# Node ç¯å¢ƒ
NODE_ENV="production"
```

### 4. æ•°æ®åº“åˆå§‹åŒ–

```bash
# ä¸€é”®å®Œæˆæ•°æ®åº“è®¾ç½®
npm run deploy:setup:prod
```

è¿™ä¼šè‡ªåŠ¨æ‰§è¡Œï¼š

- ç”Ÿæˆ Prisma Client
- æ¨é€æ•°æ®åº“ Schema
- åˆ›å»ºç§å­æ•°æ®ï¼ˆåˆå§‹ç®¡ç†å‘˜å’Œåˆ†ç±»/æ ‡ç­¾ï¼‰
- æ„å»ºé¡¹ç›®

**ç§å­æ•°æ®åŒ…æ‹¬ï¼š**

- ç®¡ç†å‘˜ç”¨æˆ·: admin (å¯†ç ç”± `ADMIN_PASSWORD` ç¯å¢ƒå˜é‡å†³å®š)
- 8ä¸ªé»˜è®¤åˆ†ç±»: AIã€å‰ç«¯ã€æºç è§£æã€ç¼–ç¨‹åŸºç¡€ã€è½¯æŠ€èƒ½ã€éšç¬”ã€AboutMe
- 17ä¸ªé»˜è®¤æ ‡ç­¾: HTMLã€CSSã€JavaScriptã€Reactã€Node.js ç­‰

**é‡å¤æ‰§è¡Œæ˜¯å®‰å…¨çš„ï¼š** ä½¿ç”¨ upsert æ“ä½œï¼Œä¸ä¼šäº§ç”Ÿé‡å¤æ•°æ®

### 5. æ„å»ºé¡¹ç›®

```bash
npm run build
```

### 6. å¯åŠ¨åº”ç”¨

```bash
# å¯åŠ¨ PM2 è¿›ç¨‹ç®¡ç†
pm2 start ecosystem.config.js

# ä¿å­˜é…ç½®
pm2 save
pm2 startup
```

### 7. é…ç½® Nginx

åœ¨å®å¡”é¢æ¿ä¸­æ·»åŠ ç«™ç‚¹ï¼Œé…ç½® SSL è¯ä¹¦ï¼Œè®¾ç½®åå‘ä»£ç†åˆ° 3000 ç«¯å£ã€‚

## ğŸ”§ å¸¸ç”¨ç»´æŠ¤å‘½ä»¤

```bash
# æŸ¥çœ‹åº”ç”¨çŠ¶æ€
pm2 status

# é‡å¯åº”ç”¨
pm2 restart spring-lament-blog

# æŸ¥çœ‹æ—¥å¿—
pm2 logs spring-lament-blog

# åœæ­¢åº”ç”¨
pm2 stop spring-lament-blog
```

## âš ï¸ é‡è¦æé†’

### ç¯å¢ƒå˜é‡æ–‡ä»¶

- **å¼€å‘ç¯å¢ƒ**: ä½¿ç”¨ `.env` æ–‡ä»¶
- **ç”Ÿäº§ç¯å¢ƒ**: ä½¿ç”¨ `.env.production` æ–‡ä»¶
- **Prisma å·¥å…·**: é»˜è®¤è¯»å– `.env` æ–‡ä»¶ï¼Œç”Ÿäº§ç¯å¢ƒè¯·ä½¿ç”¨ä¸“ç”¨å‘½ä»¤

### ç«¯å£é…ç½®

- **åº”ç”¨ç«¯å£**: 3000ï¼ˆå¯åœ¨ ecosystem.config.js ä¸­ä¿®æ”¹ï¼‰
- **Nginx ç«¯å£**: 80/443
- **å®å¡”é¢æ¿**: 8888

### æ–‡ä»¶æƒé™

ç¡®ä¿é¡¹ç›®ç›®å½•æƒé™æ­£ç¡®ï¼š

```bash
chmod -R 755 /www/wwwroot/your-domain.com
chown -R www:www /www/wwwroot/your-domain.com
```

## ğŸš¨ å¸¸è§é—®é¢˜é€ŸæŸ¥

| é—®é¢˜           | ç—‡çŠ¶                | è§£å†³æ–¹æ¡ˆ                        |
| -------------- | ------------------- | ------------------------------- |
| ç«¯å£å ç”¨       | `EADDRINUSE` é”™è¯¯   | `lsof -i :3000` â†’ `kill -9 PID` |
| åº”ç”¨æœªæ„å»º     | æ‰¾ä¸åˆ° `.next` ç›®å½• | `npm run build`                 |
| æ•°æ®åº“é”™è¯¯     | è¿æ¥å¤±è´¥            | æ£€æŸ¥ `DATABASE_URL` é…ç½®        |
| Nginx æ— æ³•å¯åŠ¨ | 80ç«¯å£è¢«å ç”¨        | æ£€æŸ¥å®å¡”é¢æ¿ç«¯å£è®¾ç½®            |
| åŸŸåæ— æ³•è®¿é—®   | æœ¬åœ°æ­£å¸¸            | æ£€æŸ¥ DNS è§£æå’Œé˜²ç«å¢™è®¾ç½®       |
| åˆ†ç±»/æ ‡ç­¾ç¼ºå¤±  | ç®¡ç†åå°ç©ºç™½        | `npm run db:seed:prod` é‡æ–°åˆ›å»º |

## ğŸ“‹ éƒ¨ç½²æ£€æŸ¥æ¸…å•

- [ ] Node.js å·²å®‰è£… (>= 18.0.0)
- [ ] é¡¹ç›®ä»£ç å·²ä¸Šä¼ 
- [ ] ä¾èµ–åŒ…å·²å®‰è£… (`npm install`)
- [ ] ç¯å¢ƒå˜é‡æ–‡ä»¶å·²é…ç½®
- [ ] æ•°æ®åº“å·²åˆå§‹åŒ– (`npm run deploy:setup:prod`)
- [ ] é¡¹ç›®å·²æ„å»º
- [ ] PM2 è¿›ç¨‹å·²å¯åŠ¨
- [ ] Nginx é…ç½®å·²å®Œæˆ
- [ ] SSL è¯ä¹¦å·²é…ç½®
- [ ] åŸŸåå¯ä»¥æ­£å¸¸è®¿é—®

## ğŸ” å¥åº·æ£€æŸ¥

æ‰§è¡Œå¥åº·æ£€æŸ¥è„šæœ¬ï¼š

```bash
./health-check.sh
```

æˆ–æ‰‹åŠ¨æ£€æŸ¥ï¼š

```bash
# æ£€æŸ¥åº”ç”¨çŠ¶æ€
curl http://localhost:3000

# æ£€æŸ¥ç«¯å£ç›‘å¬
netstat -tlnp | grep :3000

# æ£€æŸ¥ Nginx çŠ¶æ€
systemctl status nginx
```

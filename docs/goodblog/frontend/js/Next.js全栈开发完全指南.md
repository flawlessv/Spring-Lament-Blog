---
title: Next.jså…¨æ ˆå¼€å‘å®Œå…¨æŒ‡å—
slug: nextfullstack
published: true
featured: true
publishedAt: 2025-10-23T00:00:00.000Z
readingTime: 20
category: å‰ç«¯
tags:
  - js
coverImage: https://haowallpaper.com/link/common/file/previewFileImg/15691093812220224
---

> åŸºäºSpring Lament Blogé¡¹ç›®çš„å®æˆ˜ç»éªŒï¼Œå¸®åŠ©å‰ç«¯åŒå­¦å¿«é€ŸæŒæ¡å…¨æ ˆå¼€å‘æŠ€èƒ½

## å‰è¨€

æœ€è¿‘éƒ¨é—¨åœ¨å¤§åŠ›æ¨å…¨æ ˆå¼€å‘ï¼Œä½œä¸ºä¸€åå‰ç«¯å¼€å‘è€…ï¼Œæƒ³è¦å…¥é—¨å…¨æ ˆå¼€å‘ï¼Œé‚£ä¹ˆè¿™ä»½æŒ‡å—å°±æ˜¯ä¸ºä½ å‡†å¤‡çš„ã€‚æˆ‘ä»¬å°†é€šè¿‡ä¸€ä¸ªçœŸå®çš„åšå®¢é¡¹ç›®(Spring Lament Blog)ï¼Œä»é›¶å¼€å§‹å­¦ä¹ å¦‚ä½•ä½¿ç”¨Next.js 15æ„å»ºç°ä»£åŒ–çš„å…¨æ ˆåº”ç”¨ä»¥åŠåç«¯ã€æ•°æ®åº“ã€éƒ¨ç½²ç­‰ç›¸å…³çŸ¥è¯†ç®€ä»‹ã€‚

## æ–‡ç« å¤§çº²

**å­¦ä¹ è·¯å¾„ï¼šæ¦‚å¿µç†è§£ â†’ å·¥å…·æŒæ¡ â†’ å®æˆ˜åº”ç”¨**

### ğŸ“š æ¦‚å¿µç†è§£ç¯‡ï¼ˆæ‰“åŸºç¡€ï¼‰

1. **ç¬¬1ç« ï¼šåç«¯çš„æœ¬è´¨** - ç†è§£å‰åç«¯åˆ†å·¥å’Œå…¨æ ˆå¼€å‘ä»·å€¼
2. **ç¬¬2ç« ï¼šNode.jså…¥é—¨** - JavaScriptè¿è¡Œæ—¶å’ŒæœåŠ¡ç«¯èƒ½åŠ›
3. **ç¬¬3ç« ï¼šNext.jså…¨æ ˆæ¡†æ¶** - ç°ä»£åŒ–å…¨æ ˆå¼€å‘è§£å†³æ–¹æ¡ˆ

### ğŸ”§ å·¥å…·æŒæ¡ç¯‡ï¼ˆå­¦å·¥å…·ï¼‰

4. **ç¬¬4ç« ï¼šé¡¹ç›®ç»“æ„å…¨è§£æ** - ç†è§£æ–‡ä»¶ç»„ç»‡å’Œæ¶æ„è®¾è®¡
5. **ç¬¬5ç« ï¼šæ•°æ®åº“ä¸Prisma ORM** - æ•°æ®ç®¡ç†å’Œæ¨¡å‹è®¾è®¡
6. **ç¬¬6ç« ï¼šç”¨æˆ·è®¤è¯ç³»ç»Ÿ** - å®‰å…¨æ§åˆ¶å’Œæƒé™ç®¡ç†

### ğŸš€ å®æˆ˜åº”ç”¨ç¯‡ï¼ˆåšé¡¹ç›®ï¼‰

7. **ç¬¬7ç« ï¼šéƒ¨ç½²ä¸è¿ç»´** - ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²å’Œè‡ªåŠ¨åŒ–
8. **ç¬¬8ç« ï¼šæ€§èƒ½ä¼˜åŒ–** - æå‡åº”ç”¨æ€§èƒ½å’Œç”¨æˆ·ä½“éªŒ

---

## ç¬¬1ç« ï¼šåç«¯çš„æœ¬è´¨

TODO:ç”»ä¸€ä¸ªå‰åç«¯äº¤äº’çš„æµç¨‹å›¾

### ä»€ä¹ˆæ˜¯åç«¯ï¼Ÿ

**åç«¯(Backend)**æ˜¯åº”ç”¨ç¨‹åºçš„æœåŠ¡å™¨ç«¯éƒ¨åˆ†ï¼Œè´Ÿè´£å¤„ç†ä¸šåŠ¡é€»è¾‘ã€æ•°æ®ç®¡ç†å’ŒæœåŠ¡å™¨é€šä¿¡ã€‚ç®€å•æ¥è¯´ï¼Œåç«¯å°±æ˜¯"ç®¡æ•°æ®çš„"ã€‚

### å‰åç«¯èŒè´£åˆ’åˆ†

**å‰ç«¯èŒè´£ï¼š**

- ç”¨æˆ·ç•Œé¢å±•ç¤ºã€ç”¨æˆ·äº¤äº’ã€æ•°æ®å±•ç¤ºã€ç”¨æˆ·ä½“éªŒ

**åç«¯èŒè´£ï¼š**

- æ•°æ®å­˜å‚¨ã€ä¸šåŠ¡é€»è¾‘ã€APIæ¥å£ã€å®‰å…¨æ§åˆ¶

### ä¸ºä»€ä¹ˆå‰ç«¯åŒå­¦è¦å­¦åç«¯ï¼Ÿ

1. **å¤§åŠ¿æ‰€è¶‹**ï¼šç›®å‰Vibe Codingç››è¡Œï¼ŒAIå…¨æ ˆå¼€å‘å·¥ç¨‹å¸ˆå¯èƒ½æ˜¯æœªæ¥è¶‹åŠ¿
2. **èŒä¸šå‘å±•**ï¼šå…¨æ ˆå¼€å‘è€…æ›´å—å¸‚åœºæ¬¢è¿
3. **é¡¹ç›®ç†è§£**ï¼šçŸ¥é“æ•°æ®å¦‚ä½•æµè½¬ï¼Œå†™å‡ºæ›´å¥½çš„å‰ç«¯ä»£ç 
4. **ç‹¬ç«‹å¼€å‘**ï¼šå¯ä»¥ç‹¬ç«‹å®Œæˆæ•´ä¸ªé¡¹ç›®

### Next.jså…¨æ ˆå¼€å‘ä¼˜åŠ¿

ä¼ ç»Ÿå¼€å‘éœ€è¦å‰ç«¯é¡¹ç›®+åç«¯é¡¹ç›®+æ•°æ®åº“ï¼Œè€ŒNext.jså…¨æ ˆæ¡†æ¶å¯ä»¥ï¼š

- ä¸€ä¸ªé¡¹ç›®åŒ…å«å‰åç«¯
- ç»Ÿä¸€çš„ä»£ç åº“å’Œéƒ¨ç½²æµç¨‹
- æ›´å¥½çš„å¼€å‘ä½“éªŒå’Œæ€§èƒ½ä¼˜åŒ–

---

## ç¬¬2ç« ï¼šNode.jså…¥é—¨

### JavaScript Runtimeè¿è¡Œæ—¶

åœ¨å¼€å§‹å­¦ä¹ Node.jsä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦ç†è§£ä¸€ä¸ªæ ¸å¿ƒæ¦‚å¿µï¼š**Runtime(è¿è¡Œæ—¶)**ã€‚

ä¸€æ®µJavaScriptä»£ç æœ¬è´¨ä¸Šå°±æ˜¯å­—ç¬¦ä¸²ï¼š

```javascript
console.log("hello world");
```

è¿™æ®µå­—ç¬¦ä¸²èƒ½è¢«æ‰§è¡Œå—ï¼Ÿä¸èƒ½ï¼Œå®ƒéœ€è¦è¿è¡Œç¯å¢ƒã€‚

**Runtimeå°±æ˜¯ä»£ç çš„æ‰§è¡Œç¯å¢ƒ**ã€‚æ²¡æœ‰Runtimeï¼Œä»£ç å°±æ— æ³•æ‰§è¡Œï¼Œå°±æ˜¯ä¸€å †å­—ç¬¦ä¸²ã€‚

### æµè§ˆå™¨ vs Node.js

**æµè§ˆå™¨Runtimeï¼š**

- å†…ç½®JavaScriptè§£é‡Šå™¨
- æä¾›DOMã€BOMç­‰æµè§ˆå™¨API
- åªèƒ½è¿è¡Œåœ¨æµè§ˆå™¨ä¸­
- ä¸»è¦ç”¨äºç”¨æˆ·ç•Œé¢å¼€å‘

**Node.js Runtimeï¼š**

- åŸºäºChrome V8å¼•æ“
- æä¾›æ–‡ä»¶ç³»ç»Ÿã€HTTPç­‰æœåŠ¡å™¨API
- å¯ä»¥è¿è¡Œåœ¨ä»»ä½•æ“ä½œç³»ç»Ÿ
- ä¸»è¦ç”¨äºæœåŠ¡å™¨ç«¯å¼€å‘

### Node.jsçš„æ ¸å¿ƒèƒ½åŠ›

Node.jsä½œä¸ºæœåŠ¡å™¨ç«¯JavaScriptè¿è¡Œæ—¶ï¼Œæä¾›äº†ä»¥ä¸‹æ ¸å¿ƒèƒ½åŠ›ï¼š

#### 1. æ–‡ä»¶ç³»ç»Ÿæ“ä½œ

```javascript
const fs = require("fs");
const path = require("path");

// è¯»å–æ–‡ä»¶
const data = fs.readFileSync("data.txt", "utf8");
console.log(data);

// å†™å…¥æ–‡ä»¶
fs.writeFileSync("output.txt", "Hello Node.js", "utf8");
```

#### 2. HTTPæœåŠ¡å™¨

```javascript
const http = require("http");

const server = http.createServer((req, res) => {
  res.setHeader("Content-Type", "application/json");
  res.end(JSON.stringify({ message: "Hello from Node.js" }));
});

server.listen(3000, () => {
  console.log("æœåŠ¡å™¨è¿è¡Œåœ¨ http://localhost:3000");
});
```

#### 3. æ•°æ®åº“æ“ä½œ

```javascript
// ä½¿ç”¨Prisma ORMæ“ä½œæ•°æ®åº“
const { PrismaClient } = require("@prisma/client");
const prisma = new PrismaClient();

// åˆ›å»ºç”¨æˆ·
await prisma.user.create({
  data: {
    name: "å¼ ä¸‰",
    email: "zhang@example.com",
  },
});

// æŸ¥è¯¢ç”¨æˆ·
const users = await prisma.user.findMany();
```

#### 4. ç¬¬ä¸‰æ–¹APIè°ƒç”¨

```javascript
// è°ƒç”¨å¤–éƒ¨API
const response = await fetch("https://api.example.com/data");
const data = await response.json();
```

### ä¸ºä»€ä¹ˆé€‰æ‹©Node.jsï¼Ÿ

å¯¹äºå‰ç«¯åŒå­¦æ¥è¯´ï¼Œé€‰æ‹©Node.jså­¦ä¹ åç«¯æœ‰ä»¥ä¸‹ä¼˜åŠ¿ï¼š

1. **è¯­è¨€ç»Ÿä¸€**ï¼šå‰åç«¯éƒ½ç”¨JavaScriptï¼Œæ— éœ€å­¦ä¹ æ–°è¯­è¨€
2. **ç”Ÿæ€ä¸°å¯Œ**ï¼šnpmåŒ…ç®¡ç†å™¨ï¼Œæµ·é‡ç¬¬ä¸‰æ–¹åº“
3. **æ€§èƒ½ä¼˜ç§€**ï¼šåŸºäºV8å¼•æ“ï¼Œæ‰§è¡Œæ•ˆç‡é«˜
4. **ç¤¾åŒºæ´»è·ƒ**ï¼šå¤§é‡æ•™ç¨‹å’Œå¼€æºé¡¹ç›®

### å­¦ä¹ ç›®æ ‡

é€šè¿‡æœ¬ç« ï¼Œä½ åº”è¯¥ç†è§£ï¼š

- Runtimeæ˜¯ä»£ç çš„æ‰§è¡Œç¯å¢ƒ
- Node.jsæä¾›äº†æœåŠ¡å™¨ç«¯JavaScriptè¿è¡Œèƒ½åŠ›
- Node.jsçš„æ ¸å¿ƒåŠŸèƒ½ï¼šæ–‡ä»¶æ“ä½œã€HTTPæœåŠ¡ã€æ•°æ®åº“æ“ä½œ
- ä¸ºä»€ä¹ˆå‰ç«¯åŒå­¦é€‰æ‹©Node.jså­¦ä¹ åç«¯æœ€åˆé€‚

åœ¨ä¸‹ä¸€ç« ï¼Œæˆ‘ä»¬å°†å­¦ä¹ Next.jsï¼Œè¿™æ˜¯ä¸€ä¸ªåŸºäºNode.jsçš„å…¨æ ˆæ¡†æ¶ï¼Œè®©å…¨æ ˆå¼€å‘å˜å¾—æ›´åŠ ç®€å•ã€‚

---

## ç¬¬3ç« ï¼šNext.jså…¨æ ˆæ¡†æ¶

### ä¼ ç»Ÿå¼€å‘æ–¹å¼çš„ç—›ç‚¹

åœ¨ä¼ ç»Ÿçš„Webå¼€å‘ä¸­ï¼Œæˆ‘ä»¬éœ€è¦ç»´æŠ¤å¤šä¸ªç‹¬ç«‹çš„é¡¹ç›®ï¼š

```
é¡¹ç›®ç»“æ„ï¼š
â”œâ”€â”€ frontend/          # Reactå‰ç«¯é¡¹ç›®
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ components/  # Reactç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ pages/      # é¡µé¢ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ hooks/      # è‡ªå®šä¹‰Hook
â”‚   â”‚   â”œâ”€â”€ utils/      # å·¥å…·å‡½æ•°
â”‚   â”‚   â”œâ”€â”€ services/   # APIè°ƒç”¨
â”‚   â”‚   â”œâ”€â”€ store/      # çŠ¶æ€ç®¡ç†
â”‚   â”‚   â””â”€â”€ types/      # TypeScriptç±»å‹
â”‚   â”œâ”€â”€ public/         # é™æ€èµ„æº
â”‚   â”œâ”€â”€ package.json
â”‚   â””â”€â”€ ...
â”œâ”€â”€ backend/           # Node.jsåç«¯é¡¹ç›®
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ controllers/ # æ§åˆ¶å™¨
â”‚   â”‚   â”œâ”€â”€ services/   # ä¸šåŠ¡é€»è¾‘
â”‚   â”‚   â”œâ”€â”€ models/     # æ•°æ®æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ routes/     # è·¯ç”±å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ middleware/ # ä¸­é—´ä»¶
â”‚   â”‚   â”œâ”€â”€ utils/      # å·¥å…·å‡½æ•°
â”‚   â”‚   â””â”€â”€ config/     # é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ package.json
â”‚   â””â”€â”€ ...
â””â”€â”€ database/          # æ•°æ®åº“
    â”œâ”€â”€ migrations/     # æ•°æ®åº“è¿ç§»
    â”œâ”€â”€ seeds/         # åˆå§‹æ•°æ®
    â””â”€â”€ schema.sql     # æ•°æ®åº“æ¶æ„
```

**è¿™ç§æ–¹å¼çš„ç¼ºç‚¹ï¼š**

- **å¼€å‘å¤æ‚**ï¼šéœ€è¦åŒæ—¶ç»´æŠ¤å¤šä¸ªé¡¹ç›®
- **éƒ¨ç½²å¤æ‚**ï¼šéœ€è¦åˆ†åˆ«éƒ¨ç½²å‰ç«¯å’Œåç«¯
- **åè°ƒå›°éš¾**ï¼šå‰åç«¯æ¥å£éœ€è¦åå•†
- **ç±»å‹å®‰å…¨**ï¼šå‰åç«¯æ•°æ®ç±»å‹ä¸ä¸€è‡´

### Next.jsçš„è§£å†³æ–¹æ¡ˆ

Next.jsæ˜¯Vercelå¼€å‘çš„Reactå…¨æ ˆæ¡†æ¶ï¼Œä¸€ä¸ªé¡¹ç›®è§£å†³æ‰€æœ‰é—®é¢˜ï¼š

```
Next.jsé¡¹ç›®ç»“æ„ï¼š
â”œâ”€â”€ app/               # é¡µé¢å’ŒAPIè·¯ç”±
â”‚   â”œâ”€â”€ page.tsx      # å‰ç«¯é¡µé¢
â”‚   â”œâ”€â”€ api/          # åç«¯API
â”‚   â””â”€â”€ layout.tsx    # å¸ƒå±€ç»„ä»¶
â”œâ”€â”€ components/       # Reactç»„ä»¶
â”œâ”€â”€ lib/              # å·¥å…·å‡½æ•°
â””â”€â”€ prisma/          # æ•°æ®åº“
```

### Next.jsçš„æ ¸å¿ƒä¼˜åŠ¿

#### 0. Turbopackæ„å»ºç³»ç»Ÿ

Next.js 15å¼•å…¥äº†åŸºäºRustçš„Turbopackæ„å»ºç³»ç»Ÿï¼Œç›¸æ¯”ä¼ ç»Ÿçš„Webpackæœ‰æ˜¾è‘—ä¼˜åŠ¿ï¼š

**Turbopackä¼˜åŠ¿ï¼š**

- **å¯åŠ¨é€Ÿåº¦å¿«**ï¼šå¼€å‘ç¯å¢ƒå¯åŠ¨é€Ÿåº¦æ¯”Webpackå¿«10å€
- **å¢é‡ç¼–è¯‘**ï¼šåªç¼–è¯‘å˜æ›´çš„éƒ¨åˆ†ï¼Œå¼€å‘æ—¶å‡ ä¹ç¬æ—¶æ›´æ–°
- **å†…å­˜å ç”¨ä½**ï¼šæ›´é«˜æ•ˆçš„å†…å­˜ä½¿ç”¨ï¼Œå‡å°‘å†…å­˜æ³„æ¼
- **åŸç”Ÿæ”¯æŒ**ï¼šåŸç”Ÿæ”¯æŒTypeScriptã€JSXã€CSSç­‰
- **æœªæ¥æ¶æ„**ï¼šåŸºäºRustï¼Œä¸ºNext.jsæœªæ¥å‘å±•å¥ å®šåŸºç¡€

#### 1. æ–‡ä»¶ç³»ç»Ÿè·¯ç”±

æ–‡ä»¶å³è·¯ç”±ï¼Œéå¸¸ç›´è§‚ï¼š

```
app/
â”œâ”€â”€ page.tsx          â†’ /
â”œâ”€â”€ about/page.tsx   â†’ /about
â”œâ”€â”€ posts/
â”‚   â”œâ”€â”€ page.tsx     â†’ /posts
â”‚   â””â”€â”€ [slug]/page.tsx â†’ /posts/hello-world
â””â”€â”€ api/posts/route.ts â†’ /api/posts
```

#### 2. ç‰¹æ®Šæ–‡ä»¶çº¦å®š

Next.jsä½¿ç”¨ç‰¹æ®Šæ–‡ä»¶åå®šä¹‰ä¸åŒåŠŸèƒ½ï¼š

```typescript
// app/posts/page.tsx - é¡µé¢ç»„ä»¶
export default function PostsPage() {
  return <div>æ–‡ç« åˆ—è¡¨é¡µé¢</div>
}

// app/api/posts/route.ts - APIè·¯ç”±
export async function GET() {
  return Response.json({ message: "è·å–æ–‡ç« åˆ—è¡¨" });
}

// app/layout.tsx - å¸ƒå±€ç»„ä»¶
export default function RootLayout({ children }: { children: React.ReactNode }) {
  return (
    <html lang="zh">
      <body>
        <header>ç½‘ç«™å¤´éƒ¨</header>
        {children}
        <footer>ç½‘ç«™åº•éƒ¨</footer>
      </body>
    </html>
  )
}

// app/loading.tsx - åŠ è½½çŠ¶æ€
export default function Loading() {
  return <div>åŠ è½½ä¸­...</div>
}
```

#### 3. Server Componentsä¸Client Components

**Server Componentsï¼ˆé»˜è®¤ï¼‰**ï¼šåœ¨æœåŠ¡å™¨æ‰§è¡Œï¼Œå¯ç›´æ¥è®¿é—®æ•°æ®åº“

```typescript
// æœåŠ¡ç«¯ç»„ä»¶ - é»˜è®¤
export default async function PostsPage() {
  const posts = await prisma.post.findMany() // ç›´æ¥æ•°æ®åº“æŸ¥è¯¢
  return <div>{posts.map(post => <div key={post.id}>{post.title}</div>)}</div>
}
```

**Client Components**ï¼šåœ¨æµè§ˆå™¨æ‰§è¡Œï¼Œå¤„ç†äº¤äº’

```typescript
// å®¢æˆ·ç«¯ç»„ä»¶ - éœ€è¦'use client'å£°æ˜
'use client'
import { useState } from 'react'

export default function PostForm() {
  const [title, setTitle] = useState('')
  return <input value={title} onChange={(e) => setTitle(e.target.value)} />
}
```

#### 4. å¤šç§æ¸²æŸ“æ¨¡å¼

- **SSG**ï¼šé™æ€ç”Ÿæˆï¼Œæ„å»ºæ—¶ç”ŸæˆHTMLï¼Œæ€§èƒ½æœ€ä½³
- **SSR**ï¼šæœåŠ¡ç«¯æ¸²æŸ“ï¼Œè¯·æ±‚æ—¶ç”ŸæˆHTMLï¼ŒSEOå‹å¥½
- **ISR**ï¼šå¢é‡é™æ€å†ç”Ÿï¼Œå¹³è¡¡æ€§èƒ½å’Œæ›´æ–°

#### 5. ç±»å‹å®‰å…¨

å‰åç«¯å…±äº«TypeScriptç±»å‹ï¼š

```typescript
// å…±äº«ç±»å‹å®šä¹‰
interface Post {
  id: string;
  title: string;
  content: string;
}

// å‰ç«¯ä½¿ç”¨
const [posts, setPosts] = useState<Post[]>([]);

// APIè·¯ç”±ä½¿ç”¨
export async function GET(): Promise<Response> {
  const posts: Post[] = await prisma.post.findMany();
  return Response.json(posts);
}
```

### ä¸ºä»€ä¹ˆé€‰æ‹©Next.jsï¼Ÿ

1. **å­¦ä¹ æˆæœ¬ä½**ï¼šåŸºäºReactï¼Œå‰ç«¯åŒå­¦å®¹æ˜“ä¸Šæ‰‹
2. **å¼€å‘æ•ˆç‡é«˜**ï¼šçº¦å®šå¤§äºé…ç½®ï¼Œå‡å°‘æ ·æ¿ä»£ç 
3. **æ€§èƒ½ä¼˜ç§€**ï¼šè‡ªåŠ¨ä»£ç åˆ†å‰²ã€å›¾ç‰‡ä¼˜åŒ–ã€ç¼“å­˜ç­–ç•¥
4. **ç±»å‹å®‰å…¨**ï¼šå‰åç«¯ç»Ÿä¸€çš„TypeScriptæ”¯æŒ
5. **éƒ¨ç½²ç®€å•**ï¼šæ”¯æŒVercelä¸€é”®éƒ¨ç½²

### å­¦ä¹ ç›®æ ‡

é€šè¿‡æœ¬ç« ï¼Œä½ åº”è¯¥ç†è§£ï¼š

- ä¼ ç»Ÿå‰åç«¯åˆ†ç¦»å¼€å‘çš„ç—›ç‚¹
- Next.jså¦‚ä½•ç”¨ä¸€ä¸ªé¡¹ç›®è§£å†³æ‰€æœ‰é—®é¢˜
- æ–‡ä»¶ç³»ç»Ÿè·¯ç”±å’Œç‰¹æ®Šæ–‡ä»¶çº¦å®š
- Server Componentså’ŒClient Componentsçš„åŒºåˆ«
- Next.jsçš„æ ¸å¿ƒä¼˜åŠ¿å’Œé€‰æ‹©ç†ç”±

åœ¨ä¸‹ä¸€ç« ï¼Œæˆ‘ä»¬å°†äº†è§£å…·ä½“çš„é¡¹ç›®ç»“æ„ï¼Œçœ‹çœ‹æ–‡ä»¶æ˜¯å¦‚ä½•ç»„ç»‡çš„ã€‚

---

## ç¬¬4ç« ï¼šé¡¹ç›®ç»“æ„å…¨è§£æ

### é¡¹ç›®ç›®å½•ç»“æ„

Spring Lament Blogé‡‡ç”¨Next.js 15çš„App Routeræ¶æ„ï¼Œç›®å½•ç»“æ„å¦‚ä¸‹ï¼š

```
Spring-Lament-Blog/
â”œâ”€â”€ src/                          # æºä»£ç ç›®å½•
â”‚   â”œâ”€â”€ app/                      # Next.js App Router
â”‚   â”‚   â”œâ”€â”€ admin/                # ç®¡ç†åå°é¡µé¢
â”‚   â”‚   â”‚   â”œâ”€â”€ layout.tsx        # åå°å¸ƒå±€
â”‚   â”‚   â”‚   â”œâ”€â”€ page.tsx          # åå°é¦–é¡µ
â”‚   â”‚   â”‚   â””â”€â”€ posts/            # æ–‡ç« ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ api/                  # APIè·¯ç”±
â”‚   â”‚   â”‚   â”œâ”€â”€ admin/            # åå°API
â”‚   â”‚   â”‚   â”œâ”€â”€ auth/             # è®¤è¯API
â”‚   â”‚   â”‚   â””â”€â”€ posts/            # å…¬å¼€API
â”‚   â”‚   â”œâ”€â”€ posts/                # æ–‡ç« å±•ç¤ºé¡µé¢
â”‚   â”‚   â”‚   â””â”€â”€ [slug]/           # æ–‡ç« è¯¦æƒ…
â”‚   â”‚   â”œâ”€â”€ login/                # ç™»å½•é¡µé¢
â”‚   â”‚   â”œâ”€â”€ layout.tsx            # æ ¹å¸ƒå±€
â”‚   â”‚   â””â”€â”€ page.tsx              # é¦–é¡µ
â”‚   â”œâ”€â”€ components/               # Reactç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ admin/                # åå°ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ ui/                   # shadcn/uiç»„ä»¶
â”‚   â”‚   â””â”€â”€ layout/               # å¸ƒå±€ç»„ä»¶
â”‚   â”œâ”€â”€ lib/                      # å·¥å…·å‡½æ•°åº“
â”‚   â”‚   â”œâ”€â”€ auth.ts               # NextAuthé…ç½®
â”‚   â”‚   â”œâ”€â”€ prisma.ts             # Prismaå®¢æˆ·ç«¯
â”‚   â”‚   â””â”€â”€ utils.ts              # é€šç”¨å·¥å…·
â”‚   â””â”€â”€ types/                    # TypeScriptç±»å‹
â”œâ”€â”€ prisma/                       # æ•°æ®åº“ç›¸å…³
â”‚   â”œâ”€â”€ schema.prisma             # æ•°æ®æ¨¡å‹å®šä¹‰
â”‚   â”œâ”€â”€ seed.ts                   # åˆå§‹æ•°æ®
â”‚   â””â”€â”€ dev.db                    # SQLiteæ•°æ®åº“
â”œâ”€â”€ public/                       # é™æ€èµ„æº
â”œâ”€â”€ package.json                  # é¡¹ç›®é…ç½®
â”œâ”€â”€ next.config.js                # Next.jsé…ç½®
â”œâ”€â”€ tailwind.config.ts            # Tailwindé…ç½®
â””â”€â”€ tsconfig.json                 # TypeScripté…ç½®
```

### æ ¸å¿ƒç›®å½•è¯¦è§£

#### 1. src/app/ - é¡µé¢å’ŒAPIè·¯ç”±

**é¡µé¢è·¯ç”±ç¤ºä¾‹ï¼š**

```typescript
// app/page.tsx - é¦–é¡µ
export default function HomePage() {
  return <div>åšå®¢é¦–é¡µ</div>
}

// app/posts/[slug]/page.tsx - æ–‡ç« è¯¦æƒ…é¡µ
interface Props {
  params: { slug: string }
}

export default async function PostPage({ params }: Props) {
  return <div>æ–‡ç« : {params.slug}</div>
}
```

**APIè·¯ç”±ç¤ºä¾‹ï¼š**

```typescript
// app/api/posts/route.ts - æ–‡ç« API
export async function GET() {
  return Response.json({ message: "è·å–æ–‡ç« åˆ—è¡¨" });
}

export async function POST(request: Request) {
  const data = await request.json();
  return Response.json({ message: "åˆ›å»ºæ–‡ç« ", data });
}
```

### æ–‡ä»¶å‘½åçº¦å®š

| æ–‡ä»¶å        | ä½œç”¨     | ç¤ºä¾‹                                     |
| ------------- | -------- | ---------------------------------------- |
| `page.tsx`    | é¡µé¢ç»„ä»¶ | `/app/posts/page.tsx` â†’ `/posts`         |
| `layout.tsx`  | å¸ƒå±€ç»„ä»¶ | `/app/layout.tsx` â†’ å…¨å±€å¸ƒå±€             |
| `route.ts`    | APIç«¯ç‚¹  | `/app/api/posts/route.ts` â†’ `/api/posts` |
| `loading.tsx` | åŠ è½½çŠ¶æ€ | `/app/posts/loading.tsx` â†’ åŠ è½½ä¸­...     |
| `error.tsx`   | é”™è¯¯å¤„ç† | `/app/posts/error.tsx` â†’ é”™è¯¯é¡µé¢        |

### æ•°æ®æµè½¬è¿‡ç¨‹

ç†è§£æ•°æ®åœ¨Next.jsåº”ç”¨ä¸­çš„æµè½¬è¿‡ç¨‹æ˜¯å…¨æ ˆå¼€å‘çš„å…³é”®ã€‚è®©æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªå…·ä½“ä¾‹å­æ¥çœ‹çœ‹ï¼š

#### ç”¨æˆ·è®¿é—®æ–‡ç« è¯¦æƒ…é¡µçš„å®Œæ•´æµç¨‹

**1. ç”¨æˆ·è®¿é—®URL**

```
ç”¨æˆ·è®¿é—®ï¼š/posts/nextjs-guide
```

**2. Next.jsè·¯ç”±åŒ¹é…**

```
app/posts/[slug]/page.tsx
```

**3. æœåŠ¡ç«¯ç»„ä»¶æ‰§è¡Œ**

```typescript
// app/posts/[slug]/page.tsx
import { prisma } from '@/lib/prisma'

export default async function PostPage({ params }: { params: { slug: string } }) {
  // æœåŠ¡ç«¯ç›´æ¥æŸ¥è¯¢æ•°æ®åº“
  const post = await prisma.post.findUnique({
    where: { slug: params.slug },
    include: { author: true, category: true }
  })

  return (
    <article>
      <h1>{post.title}</h1>
      <div>ä½œè€…ï¼š{post.author.name}</div>
    </article>
  )
}
```

**4. å“åº”è¿”å›**

- æœåŠ¡ç«¯æ¸²æŸ“å®Œæˆ
- è¿”å›å®Œæ•´HTMLç»™æµè§ˆå™¨
- ç”¨æˆ·çœ‹åˆ°å®Œæ•´é¡µé¢ï¼ˆSEOå‹å¥½ï¼‰

**æ ¸å¿ƒä¼˜åŠ¿ï¼š**

- **é›¶APIè°ƒç”¨**ï¼šæœåŠ¡ç«¯ç»„ä»¶ç›´æ¥è®¿é—®æ•°æ®åº“
- **é¦–å±é€Ÿåº¦å¿«**ï¼šæœåŠ¡ç«¯æ¸²æŸ“ï¼Œæ— éœ€ç­‰å¾…å®¢æˆ·ç«¯è¯·æ±‚
- **SEOå‹å¥½**ï¼šæœç´¢å¼•æ“å¯ä»¥ç›´æ¥æŠ“å–å®Œæ•´å†…å®¹

### å­¦ä¹ ç›®æ ‡

é€šè¿‡æœ¬ç« ï¼Œä½ åº”è¯¥ç†è§£ï¼š

- Next.jsé¡¹ç›®çš„å®Œæ•´ç›®å½•ç»“æ„
- å„ä¸ªç›®å½•å’Œæ–‡ä»¶çš„ä½œç”¨
- é¡µé¢è·¯ç”±å’ŒAPIè·¯ç”±çš„ç»„ç»‡æ–¹å¼
- æ•°æ®åœ¨Next.jsåº”ç”¨ä¸­çš„æµè½¬è¿‡ç¨‹
- æœåŠ¡ç«¯ç»„ä»¶çš„æ•°æ®è·å–æ–¹å¼
- ç»„ä»¶åº“çš„å±‚æ¬¡ç»“æ„
- é…ç½®æ–‡ä»¶çš„ä½œç”¨

åœ¨ä¸‹ä¸€ç« ï¼Œæˆ‘ä»¬å°†å­¦ä¹ æ•°æ®åº“å’ŒPrisma ORMï¼Œäº†è§£å¦‚ä½•ç®¡ç†åº”ç”¨çš„æ•°æ®ã€‚

---

## ç¬¬5ç« ï¼šæ•°æ®åº“ä¸Prisma ORM

### ä»€ä¹ˆæ˜¯ORMï¼Ÿ

**ORM(Object-Relational Mapping)**æ˜¯å¯¹è±¡å…³ç³»æ˜ å°„ï¼Œè®©æˆ‘ä»¬å¯ä»¥ç”¨é¢å‘å¯¹è±¡çš„æ–¹å¼æ“ä½œæ•°æ®åº“ï¼Œè€Œä¸éœ€è¦å†™SQLè¯­å¥ã€‚

### ä¼ ç»ŸSQL vs Prismaå¯¹æ¯”

#### ä¼ ç»ŸSQLæ–¹å¼

```sql
-- åˆ›å»ºç”¨æˆ·
INSERT INTO users (name, email, password)
VALUES ('å¼ ä¸‰', 'zhang@example.com', 'hashed_password');

-- æŸ¥è¯¢ç”¨æˆ·
SELECT * FROM users WHERE email = 'zhang@example.com';
```

#### Prismaæ–¹å¼

```typescript
// åˆ›å»ºç”¨æˆ·
await prisma.user.create({
  data: {
    name: "å¼ ä¸‰",
    email: "zhang@example.com",
    password: "hashed_password",
  },
});

// æŸ¥è¯¢ç”¨æˆ·
const user = await prisma.user.findUnique({
  where: { email: "zhang@example.com" },
});
```

### Prismaå®Œæ•´ä½¿ç”¨æµç¨‹

**1. å®‰è£…Prisma**

```bash
npm install prisma @prisma/client
```

**2. åˆå§‹åŒ–Prisma**

```bash
npx prisma init
```

**3. ç¼–å†™Schema**

ç¼–è¾‘`prisma/schema.prisma`æ–‡ä»¶å®šä¹‰æ•°æ®æ¨¡å‹

**4. ç”ŸæˆPrisma Client**

```bash
npx prisma generate
```

**5. æ¨é€Schemaåˆ°æ•°æ®åº“**

```bash
npx prisma db push  # å¼€å‘ç¯å¢ƒ
npx prisma migrate dev  # ç”Ÿäº§ç¯å¢ƒ
```

### åšå®¢æ•°æ®æ¨¡å‹è®¾è®¡

#### æ ¸å¿ƒå®ä½“å…³ç³»

```
User (ç”¨æˆ·) 1:N Post (æ–‡ç« )
Post (æ–‡ç« ) N:1 Category (åˆ†ç±»)
Post (æ–‡ç« ) N:M Tag (æ ‡ç­¾)
```

#### Schemaå®šä¹‰

```prisma
// prisma/schema.prisma
// Prismaå®¢æˆ·ç«¯ç”Ÿæˆå™¨é…ç½®ï¼ŒæŒ‡å®šç”ŸæˆJavaScript/TypeScriptå®¢æˆ·ç«¯
generator client {
  provider = "prisma-client-js"
}
// æ•°æ®åº“è¿æ¥é…ç½®ï¼ŒæŒ‡å®šæ•°æ®åº“ç±»å‹å’Œè¿æ¥URL
datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}
// ç”¨æˆ·æ•°æ®æ¨¡å‹å®šä¹‰
model User {
  id        String   @id @default(cuid())
  email     String   @unique
  name      String?
  password  String
  role      Role     @default(USER)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  posts    Post[]
  profile  Profile?

  @@map("users")
}

// æ–‡ç« æ¨¡å‹
model Post {
  id          String   @id @default(cuid())
  title       String
  slug        String   @unique
  content     String
  published   Boolean  @default(false)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  authorId String
// @relationè£…é¥°å™¨ç”¨äºå®šä¹‰è¡¨ä¹‹é—´çš„å…³è”å…³ç³»ï¼ŒæŒ‡å®šå¤–é”®å­—æ®µå’Œå¼•ç”¨å­—æ®µ
  author   User   @relation(fields: [authorId], references: [id])

  categoryId String?
  category   Category? @relation(fields: [categoryId], references: [id])

  tags PostTag[]

  @@map("posts")
}




```

### åŸºç¡€CRUDæ“ä½œ

#### 1. åˆ›å»ºæ•°æ®

```typescript
// åˆ›å»ºç”¨æˆ·
const user = await prisma.user.create({
  data: {
    name: "å¼ ä¸‰",
    email: "zhang@example.com",
    password: "hashed_password",
  },
});

// åˆ›å»ºæ–‡ç« ï¼ˆåŒ…å«å…³è”ï¼‰
const post = await prisma.post.create({
  data: {
    title: "Next.jså…¨æ ˆå¼€å‘æŒ‡å—",
    slug: "nextjs-fullstack-guide",
    content: "# æŒ‡å—å†…å®¹...",
    authorId: user.id,
    categoryId: category.id,
  },
});
```

#### 2. æŸ¥è¯¢æ•°æ®

```typescript
// æŸ¥è¯¢æ‰€æœ‰æ–‡ç« 
const posts = await prisma.post.findMany();

// æ¡ä»¶æŸ¥è¯¢
const publishedPosts = await prisma.post.findMany({
  where: { published: true },
});

// å…³è”æŸ¥è¯¢ - ä¸€æ¬¡æ€§è·å–æ–‡ç« åŠå…¶å…³è”æ•°æ®
const postsWithRelations = await prisma.post.findMany({
  include: {
    author: true,
    category: true,
    tags: { include: { tag: true } },
  },
});
```

#### 3. æ›´æ–°æ•°æ®

```typescript
// æ›´æ–°æ–‡ç« 
const updatedPost = await prisma.post.update({
  where: { id: postId },
  data: { title: "æ–°æ ‡é¢˜" },
});
```

#### 4. åˆ é™¤æ•°æ®

```typescript
// åˆ é™¤æ–‡ç« 
await prisma.post.delete({
  where: { id: postId },
});
```

### å¤æ‚æŸ¥è¯¢ç¤ºä¾‹

#### åˆ†é¡µæŸ¥è¯¢

```typescript
const posts = await prisma.post.findMany({
  where: { published: true },
  include: {
    author: { select: { name: true } },
    category: true,
  },
  orderBy: { createdAt: "desc" },
  skip: (page - 1) * limit, // è·³è¿‡å‰é¢çš„è®°å½•æ•°ï¼Œå®ç°åˆ†é¡µ
  take: limit, // é™åˆ¶è¿”å›çš„è®°å½•æ•°é‡
});
```

#### æŒ‰åˆ†ç±»ç­›é€‰

```typescript
const postsByCategory = await prisma.post.findMany({
  where: {
    published: true,
    category: { slug: "frontend" },
  },
});
```

### æ•°æ®åº“å®¢æˆ·ç«¯é…ç½®

```typescript
// lib/prisma.ts
import { PrismaClient } from "@prisma/client";

const globalForPrisma = globalThis as unknown as {
  prisma: PrismaClient | undefined;
};

export const prisma = globalForPrisma.prisma ?? new PrismaClient();

if (process.env.NODE_ENV !== "production") {
  globalForPrisma.prisma = prisma;
}
```

### å­¦ä¹ ç›®æ ‡

é€šè¿‡æœ¬ç« ï¼Œä½ åº”è¯¥ç†è§£ï¼š

- ORMçš„æ¦‚å¿µå’Œä¼˜åŠ¿
- Prismaçš„å®Œæ•´ä½¿ç”¨æµç¨‹
- åšå®¢ç³»ç»Ÿçš„æ•°æ®æ¨¡å‹è®¾è®¡
- å„ç§å…³è”å…³ç³»çš„å®ç°
- åŸºæœ¬çš„CRUDæ“ä½œå’Œå¤æ‚æŸ¥è¯¢

åœ¨ä¸‹ä¸€ç« ï¼Œæˆ‘ä»¬å°†å­¦ä¹ ç”¨æˆ·è®¤è¯ç³»ç»Ÿï¼Œä¿æŠ¤åº”ç”¨çš„å®‰å…¨ã€‚

---

## ç¬¬6ç« ï¼šç”¨æˆ·è®¤è¯ç³»ç»Ÿ

### ä¸ºä»€ä¹ˆéœ€è¦è®¤è¯ç³»ç»Ÿï¼Ÿ

è®¤è¯ç³»ç»Ÿåœ¨ç°ä»£Webåº”ç”¨ä¸­æ˜¯å¿…ä¸å¯å°‘çš„å®‰å…¨åŸºç¡€è®¾æ–½ã€‚æ— è®ºæ˜¯ç”µå•†å¹³å°ã€ç¤¾äº¤åª’ä½“ã€åœ¨çº¿é“¶è¡Œè¿˜æ˜¯åšå®¢ç³»ç»Ÿï¼Œéƒ½éœ€è¦è®¤è¯ç³»ç»Ÿæ¥ä¿æŠ¤ç”¨æˆ·æ•°æ®å’Œä¸šåŠ¡é€»è¾‘ã€‚

#### é€šç”¨åç«¯è®¤è¯ç³»ç»Ÿçš„æ ¸å¿ƒä»·å€¼ï¼š

**1. èº«ä»½éªŒè¯(Authentication)**

- ç¡®è®¤ç”¨æˆ·èº«ä»½ï¼šéªŒè¯"ä½ æ˜¯è°"
- é˜²æ­¢æœªæˆæƒè®¿é—®ï¼šåªæœ‰åˆæ³•ç”¨æˆ·æ‰èƒ½ç™»å½•ç³»ç»Ÿ
- ä¿æŠ¤ç”¨æˆ·éšç§ï¼šä¸ªäººæ•°æ®åªå¯¹æœ¬äººå¯è§

**2. æƒé™æ§åˆ¶(Authorization)**

- è§’è‰²ç®¡ç†ï¼šä¸åŒç”¨æˆ·æœ‰ä¸åŒæƒé™çº§åˆ«
- èµ„æºä¿æŠ¤ï¼šæ•æ„Ÿæ“ä½œéœ€è¦ç‰¹å®šæƒé™
- ä¸šåŠ¡éš”ç¦»ï¼šç¡®ä¿ç”¨æˆ·åªèƒ½è®¿é—®è‡ªå·±çš„æ•°æ®

**3. å®‰å…¨å®¡è®¡**

- æ“ä½œè®°å½•ï¼šè¿½è¸ªè°åœ¨ä»€ä¹ˆæ—¶å€™åšäº†ä»€ä¹ˆ
- å¼‚å¸¸æ£€æµ‹ï¼šå‘ç°å¯ç–‘ç™»å½•æˆ–æ“ä½œè¡Œä¸º
- åˆè§„è¦æ±‚ï¼šæ»¡è¶³æ•°æ®ä¿æŠ¤æ³•è§„è¦æ±‚

**4. ç”¨æˆ·ä½“éªŒ**

- ä¸ªæ€§åŒ–æœåŠ¡ï¼šæ ¹æ®ç”¨æˆ·èº«ä»½æä¾›å®šåˆ¶åŒ–å†…å®¹
- çŠ¶æ€ä¿æŒï¼šç”¨æˆ·æ— éœ€åå¤ç™»å½•
- è·¨è®¾å¤‡åŒæ­¥ï¼šå¤šè®¾å¤‡é—´ä¿æŒä¸€è‡´çš„ç”¨æˆ·çŠ¶æ€

#### åœ¨æˆ‘ä»¬çš„åšå®¢ç³»ç»Ÿä¸­çš„å…·ä½“åº”ç”¨ï¼š

- **æ™®é€šç”¨æˆ·**ï¼šåªèƒ½æŸ¥çœ‹æ–‡ç« ï¼Œä¸èƒ½ç¼–è¾‘
- **ç®¡ç†å‘˜**ï¼šå¯ä»¥ç®¡ç†æ–‡ç« ã€åˆ†ç±»ã€æ ‡ç­¾
- **æœªç™»å½•ç”¨æˆ·**ï¼šåªèƒ½è®¿é—®å…¬å¼€å†…å®¹

è®¤è¯ç³»ç»Ÿç¡®ä¿åªæœ‰æˆæƒç”¨æˆ·æ‰èƒ½è®¿é—®å—ä¿æŠ¤çš„èµ„æºã€‚

### NextAuth.jsç®€ä»‹

NextAuth.jsæ˜¯Next.jsç”Ÿæ€ä¸­æœ€æµè¡Œçš„è®¤è¯è§£å†³æ–¹æ¡ˆï¼Œæ”¯æŒå¤šç§è®¤è¯æ–¹å¼ï¼š

- **Credentials Provider**ï¼šç”¨æˆ·åå¯†ç ç™»å½•
- **OAuth Providers**ï¼šGoogleã€GitHubç­‰ç¬¬ä¸‰æ–¹ç™»å½•
- **JWT Sessions**ï¼šJWTä»¤ç‰Œç®¡ç†

### è®¤è¯é…ç½®

#### åŸºç¡€é…ç½® (lib/auth.ts)

```typescript
// lib/auth.ts
import { NextAuthOptions } from "next-auth";
import CredentialsProvider from "next-auth/providers/credentials";
import { prisma } from "./prisma";
import bcrypt from "bcryptjs";

export const authOptions: NextAuthOptions = {
  providers: [
    CredentialsProvider({
      name: "credentials",
      credentials: {
        email: { label: "é‚®ç®±", type: "email" },
        password: { label: "å¯†ç ", type: "password" },
      },
      async authorize(credentials) {
        if (!credentials?.email || !credentials?.password) {
          return null;
        }

        const user = await prisma.user.findUnique({
          where: { email: credentials.email },
        });

        if (!user) return null;

        const isPasswordValid = await bcrypt.compare(
          credentials.password,
          user.password
        );

        if (!isPasswordValid) return null;

        return {
          id: user.id,
          email: user.email,
          name: user.name,
          role: user.role,
        };
      },
    }),
  ],
  session: {
    strategy: "jwt",
  },
  pages: {
    signIn: "/login",
  },
};
```

#### å¯†ç åŠ å¯†

```typescript
// æ³¨å†Œæ—¶åŠ å¯†å¯†ç 
const hashedPassword = await bcrypt.hash(password, 10);

// ç™»å½•æ—¶éªŒè¯å¯†ç 
const isPasswordValid = await bcrypt.compare(password, user.password);
```

### Middlewareè·¯ç”±ä¿æŠ¤

#### è·¯ç”±ä¿æŠ¤ (middleware.ts)

Next.jsçš„Middlewareå¯ä»¥åœ¨è¯·æ±‚åˆ°è¾¾é¡µé¢å‰è¿›è¡Œæ‹¦æˆªå’ŒéªŒè¯ï¼š

```typescript
// middleware.ts
import { withAuth } from "next-auth/middleware";

export default withAuth({
  pages: {
    signIn: "/login",
  },
  callbacks: {
    authorized({ req, token }) {
      // æ£€æŸ¥æ˜¯å¦è®¿é—®åå°è·¯ç”±
      if (req.nextUrl.pathname.startsWith("/admin")) {
        return token?.role === "ADMIN";
      }
      return !!token;
    },
  },
});

export const config = {
  matcher: ["/admin/:path*", "/api/admin/:path*"],
};
```

**å·¥ä½œåŸç†ï¼š**

- ç”¨æˆ·è®¿é—®`/admin/*`è·¯ç”±æ—¶
- Middlewareæ£€æŸ¥æ˜¯å¦æœ‰æœ‰æ•ˆçš„session
- æ£€æŸ¥ç”¨æˆ·è§’è‰²æ˜¯å¦ä¸ºADMIN
- å¦‚æœéªŒè¯å¤±è´¥ï¼Œé‡å®šå‘åˆ°ç™»å½•é¡µ

### è·å–ç”¨æˆ·ä¿¡æ¯

#### åœ¨æœåŠ¡ç«¯ç»„ä»¶ä¸­

```typescript
import { getServerSession } from "next-auth";
import { authOptions } from "@/lib/auth";

const session = await getServerSession(authOptions);
console.log(session?.user); // { id, email, name, role }
```

#### åœ¨å®¢æˆ·ç«¯ç»„ä»¶ä¸­

```typescript
"use client";
import { useSession } from "next-auth/react";

const { data: session, status } = useSession();
if (status === "authenticated") {
  console.log(session.user);
}
```

### å®é™…åº”ç”¨åœºæ™¯

#### ä¿æŠ¤APIè·¯ç”±

```typescript
// app/api/admin/posts/route.ts
import { getServerSession } from "next-auth";
import { authOptions } from "@/lib/auth";

export async function POST(request: Request) {
  const session = await getServerSession(authOptions);

  if (!session || session.user.role !== "ADMIN") {
    return Response.json({ error: "æœªæˆæƒ" }, { status: 401 });
  }

  // ç»§ç»­å¤„ç†è¯·æ±‚...
}
```

### å­¦ä¹ ç›®æ ‡

é€šè¿‡æœ¬ç« ï¼Œä½ åº”è¯¥ç†è§£ï¼š

- è®¤è¯ç³»ç»Ÿçš„å¿…è¦æ€§å’Œå·¥ä½œåŸç†
- NextAuth.jsçš„é…ç½®å’Œä½¿ç”¨
- å¯†ç åŠ å¯†å’ŒéªŒè¯æµç¨‹
- Middlewareå¦‚ä½•ä¿æŠ¤è·¯ç”±
- å¦‚ä½•åœ¨æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯è·å–ç”¨æˆ·ä¿¡æ¯
- å¦‚ä½•ä¿æŠ¤APIè·¯ç”±å’Œå®ç°æƒé™æ§åˆ¶

åœ¨ä¸‹ä¸€ç« ï¼Œæˆ‘ä»¬å°†å­¦ä¹ å¦‚ä½•å°†åº”ç”¨éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒã€‚

---

---

## ç¬¬7ç« ï¼šéƒ¨ç½²ä¸è¿ç»´

### ç¯å¢ƒæ¦‚å¿µ

åœ¨å®é™…å¼€å‘ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸éœ€è¦åŒºåˆ†ä¸åŒçš„è¿è¡Œç¯å¢ƒï¼š

#### å¼€å‘ç¯å¢ƒ vs ç”Ÿäº§ç¯å¢ƒ

| ç¯å¢ƒç±»å‹     | ä½ç½®       | ç«¯å£ | æ•°æ®åº“            | é…ç½®æ–‡ä»¶        | ç‰¹ç‚¹               |
| ------------ | ---------- | ---- | ----------------- | --------------- | ------------------ |
| **å¼€å‘ç¯å¢ƒ** | æœ¬åœ°ç”µè„‘   | 7777 | SQLite (dev.db)   | .env.local      | çƒ­æ›´æ–°ï¼Œè°ƒè¯•æ¨¡å¼   |
| **ç”Ÿäº§ç¯å¢ƒ** | è¿œç¨‹æœåŠ¡å™¨ | 3000 | SQLite/PostgreSQL | .env.production | ä¼˜åŒ–æ„å»ºï¼Œç¨³å®šè¿è¡Œ |

### æ•°æ®åº“é€‰æ‹©

| æ•°æ®åº“         | ä¼˜åŠ¿                     | åŠ£åŠ¿         | é€‚ç”¨åœºæ™¯           |
| -------------- | ------------------------ | ------------ | ------------------ |
| **SQLite**     | æ— éœ€å®‰è£…ï¼Œè½»é‡çº§ï¼Œé›¶é…ç½® | å¹¶å‘æ€§èƒ½è¾ƒå¼± | ä¸ªäººåšå®¢ï¼Œå°å‹é¡¹ç›® |
| **PostgreSQL** | æ€§èƒ½å¼ºï¼ŒåŠŸèƒ½å®Œå–„ï¼Œé«˜å¹¶å‘ | éœ€è¦ç‹¬ç«‹éƒ¨ç½² | ä¸­å¤§å‹åº”ç”¨         |
| **MySQL**      | ç”Ÿæ€å¥½ï¼Œæˆç†Ÿç¨³å®š         | é…ç½®ç›¸å¯¹å¤æ‚ | é€šç”¨åœºæ™¯           |

**é¡¹ç›®é€‰æ‹©**: SQLiteï¼ˆå¼€å‘å’Œç”Ÿäº§éƒ½å¯ä»¥ç”¨ï¼Œé€‚åˆåšå®¢ç³»ç»Ÿï¼‰

### éƒ¨ç½²æ–¹å¼å¯¹æ¯”

#### 1. Vercel (æœ€ç®€å•)

**ä¼˜ç‚¹:**

- ä¸€é”®éƒ¨ç½²ï¼Œè‡ªåŠ¨CI/CD
- å…¨çƒCDNï¼Œå…è´¹é¢åº¦
- ä¸Next.jså®Œç¾é›†æˆ

**ç¼ºç‚¹:**

- ä¸æ”¯æŒSQLiteæ–‡ä»¶å­˜å‚¨
- Serverlessé™åˆ¶
- éœ€è¦å¤–éƒ¨æ•°æ®åº“

#### 2. å®å¡”+PM2 (æ¨è)

**ä¼˜ç‚¹:**

- å®Œå…¨æ§åˆ¶ï¼Œæ”¯æŒSQLite
- æ— Serverlessé™åˆ¶
- ç¨³å®šå¯é ï¼Œæ˜“äºç®¡ç†

**ç¼ºç‚¹:**

- éœ€è¦VPSæœåŠ¡å™¨
- é…ç½®ç¨å¤æ‚

### å®å¡”+PM2éƒ¨ç½²å®æˆ˜

#### æ­¥éª¤1: æœåŠ¡å™¨å‡†å¤‡

```bash
# 1. è´­ä¹°VPS (é˜¿é‡Œäº‘/è…¾è®¯äº‘)
# 2. å®‰è£…å®å¡”é¢æ¿
wget -O install.sh http://download.bt.cn/install/install-ubuntu_6.0.sh
sudo bash install.sh

# 3. åœ¨å®å¡”é¢æ¿å®‰è£… Node.js 18+
```

#### æ­¥éª¤2: ä¸Šä¼ ä»£ç 

```bash
# åœ¨æœåŠ¡å™¨ä¸Š
cd /www/wwwroot
git clone https://github.com/your-repo/Spring-Lament-Blog.git
cd Spring-Lament-Blog
npm install
```

#### æ­¥éª¤3: é…ç½®ç¯å¢ƒå˜é‡

```bash
# .env.production
DATABASE_URL="file:./prisma/prod.db"
NEXTAUTH_SECRET="your-production-secret-min-32-chars"
NEXTAUTH_URL="http://your-domain.com"
NODE_ENV="production"
```

#### æ­¥éª¤4: åˆå§‹åŒ–æ•°æ®åº“

```bash
npm run db:push
npm run db:seed
```

#### æ­¥éª¤5: æ„å»ºé¡¹ç›®

```bash
npm run build
```

#### æ­¥éª¤6: PM2é…ç½®

åˆ›å»º`ecosystem.config.js`ï¼š

```javascript
module.exports = {
  apps: [
    {
      name: "spring-lament-blog",
      script: "node_modules/next/dist/bin/next",
      args: "start -p 3000",
      env: {
        NODE_ENV: "production",
      },
      error_file: "./logs/err.log",
      out_file: "./logs/out.log",
      log_file: "./logs/combined.log",
    },
  ],
};
```

å¯åŠ¨åº”ç”¨ï¼š

```bash
npm install -g pm2
pm2 start ecosystem.config.js
pm2 save
pm2 startup
```

#### æ­¥éª¤7: Nginxé…ç½®

```nginx
server {
    listen 80;
    server_name your-domain.com;

    location / {
        proxy_pass http://localhost:3000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_cache_bypass $http_upgrade;
    }
}
```

### å¸¸è§é—®é¢˜è§£å†³

#### 1. ç«¯å£å ç”¨

```bash
# æ£€æŸ¥ç«¯å£å ç”¨
lsof -i :3000
# æ€æ­»è¿›ç¨‹
kill -9 PID
```

#### 2. æƒé™é—®é¢˜

```bash
# è®¾ç½®æ–‡ä»¶æƒé™
chmod -R 755 /www/wwwroot/Spring-Lament-Blog
chown -R www:www /www/wwwroot/Spring-Lament-Blog
```

#### 3. æ•°æ®åº“æƒé™

```bash
# SQLiteæ–‡ä»¶æƒé™
chmod 664 prisma/prod.db
chown www:www prisma/prod.db
```

### è¿ç»´ç®¡ç†

#### PM2å¸¸ç”¨å‘½ä»¤

```bash
pm2 list                # æŸ¥çœ‹è¿›ç¨‹
pm2 restart app-name    # é‡å¯åº”ç”¨
pm2 stop app-name       # åœæ­¢åº”ç”¨
pm2 logs app-name       # æŸ¥çœ‹æ—¥å¿—
pm2 monit              # ç›‘æ§é¢æ¿
```

#### æ—¥å¿—ç®¡ç†

```bash
# æŸ¥çœ‹åº”ç”¨æ—¥å¿—
pm2 logs spring-lament-blog

# Nginxæ—¥å¿—
tail -f /var/log/nginx/access.log
tail -f /var/log/nginx/error.log
```

### å­¦ä¹ ç›®æ ‡

é€šè¿‡æœ¬ç« ï¼Œä½ åº”è¯¥ç†è§£ï¼š

- å¼€å‘ç¯å¢ƒå’Œç”Ÿäº§ç¯å¢ƒçš„åŒºåˆ«
- ä¸åŒéƒ¨ç½²æ–¹å¼çš„ä¼˜åŠ£
- å®å¡”+PM2çš„å®Œæ•´éƒ¨ç½²æµç¨‹
- GitHub Actionsè‡ªåŠ¨åŒ–éƒ¨ç½²
- å¸¸è§é—®é¢˜çš„æ’æŸ¥æ–¹æ³•
- åŸºæœ¬çš„è¿ç»´ç®¡ç†æ“ä½œ

åœ¨ä¸‹ä¸€ç« ï¼Œæˆ‘ä»¬å°†å­¦ä¹ æ€§èƒ½ä¼˜åŒ–æŠ€æœ¯ï¼Œæå‡åº”ç”¨çš„è¿è¡Œæ•ˆç‡ã€‚

---

## ç¬¬8ç« ï¼šæ€§èƒ½ä¼˜åŒ–

### Next.jsæ€§èƒ½ä¼˜åŒ–

#### 1. æ¸²æŸ“æ¨¡å¼ä¼˜åŒ–

**SSG (Static Site Generation)** - é™æ€ç«™ç‚¹ç”Ÿæˆï¼š
åœ¨æ„å»ºæ—¶é¢„å…ˆç”ŸæˆHTMLé¡µé¢ï¼Œç”¨æˆ·è®¿é—®æ—¶ç›´æ¥è¿”å›é™æ€æ–‡ä»¶ï¼Œé€Ÿåº¦æå¿«ã€‚

**ISR (Incremental Static Regeneration)** - å¢é‡é™æ€å†ç”Ÿï¼š
åœ¨SSGåŸºç¡€ä¸Šï¼Œå…è®¸é¡µé¢åœ¨è¿è¡Œæ—¶æŒ‰éœ€æ›´æ–°ï¼Œæ—¢ä¿è¯äº†æ€§èƒ½åˆä¿è¯äº†å†…å®¹çš„æ—¶æ•ˆæ€§ã€‚

**ä¸‰ç§æ¸²æŸ“æ¨¡å¼å¯¹æ¯”ï¼š**

| æ¸²æŸ“æ¨¡å¼ | ç”Ÿæˆæ—¶æœº      | ä¼˜åŠ¿               | åŠ£åŠ¿                 | é€‚ç”¨åœºæ™¯                 |
| -------- | ------------- | ------------------ | -------------------- | ------------------------ |
| **SSG**  | æ„å»ºæ—¶        | æ€§èƒ½æœ€ä½³ï¼ŒSEOå‹å¥½  | å†…å®¹æ›´æ–°éœ€è¦é‡æ–°æ„å»º | é™æ€å†…å®¹ï¼Œå¦‚æ–‡æ¡£ã€åšå®¢   |
| **ISR**  | æ„å»ºæ—¶+è¿è¡Œæ—¶ | æ€§èƒ½å¥½ï¼Œå†…å®¹å¯æ›´æ–° | é…ç½®ç›¸å¯¹å¤æ‚         | åŠé™æ€å†…å®¹ï¼Œå¦‚æ–°é—»ã€å•†å“ |
| **SSR**  | è¯·æ±‚æ—¶        | å†…å®¹å®æ—¶ï¼Œäº¤äº’æ€§å¥½ | æœåŠ¡å™¨å‹åŠ›å¤§         | åŠ¨æ€å†…å®¹ï¼Œå¦‚ç”¨æˆ·é¢æ¿     |

**å®é™…åº”ç”¨ï¼š**

```typescript
// app/posts/[slug]/page.tsx
// ä½¿ç”¨SSGç”Ÿæˆé™æ€é¡µé¢
export async function generateStaticParams() {
  const posts = await prisma.post.findMany({
    where: { published: true },
    select: { slug: true },
  });

  return posts.map((post) => ({ slug: post.slug }));
}

// ä½¿ç”¨ISRå®šæœŸæ›´æ–°
export const revalidate = 3600; // æ¯å°æ—¶é‡æ–°ç”Ÿæˆ
```

#### 2. å›¾ç‰‡ä¼˜åŒ–

```typescript
import Image from 'next/image'

// ä¼˜åŒ–å‰
<img src="/blog-cover.jpg" alt="å°é¢" />

// ä¼˜åŒ–å
<Image
  src="/blog-cover.jpg"
  alt="å°é¢"
  width={800}
  height={400}
  priority={isFirstPost}  // é¦–å±å›¾ç‰‡ä¼˜å…ˆåŠ è½½
  placeholder="blur"      // æ¨¡ç³Šå ä½ç¬¦
  sizes="(max-width: 768px) 100vw, 50vw"  // å“åº”å¼å°ºå¯¸
/>
```

#### 3. ä»£ç åˆ†å‰²

```typescript
// åŠ¨æ€å¯¼å…¥ï¼Œå‡å°‘é¦–å±åŠ è½½æ—¶é—´
import dynamic from 'next/dynamic'

const AdminPanel = dynamic(() => import('@/components/AdminPanel'), {
  loading: () => <div>åŠ è½½ä¸­...</div>,
  ssr: false, // ä»…å®¢æˆ·ç«¯æ¸²æŸ“
})

// è·¯ç”±çº§åˆ«çš„ä»£ç åˆ†å‰²ï¼ˆè‡ªåŠ¨ï¼‰
// app/admin/page.tsx ä¼šè‡ªåŠ¨åˆ†å‰²ä¸ºç‹¬ç«‹çš„chunk
```

### æ•°æ®åº“æŸ¥è¯¢ä¼˜åŒ–

#### 1. åªæŸ¥è¯¢éœ€è¦çš„å­—æ®µ

```typescript
// âŒ ä¸å¥½ - æŸ¥è¯¢æ‰€æœ‰å­—æ®µ
const users = await prisma.user.findMany();

// âœ… å¥½ - åªæŸ¥è¯¢éœ€è¦çš„å­—æ®µ
const users = await prisma.user.findMany({
  select: { id: true, name: true, email: true },
});
```

#### 2. ä½¿ç”¨æ•°æ®åº“ç´¢å¼•

```prisma
model Post {
  slug String @unique  // è‡ªåŠ¨åˆ›å»ºç´¢å¼•
  published Boolean
  createdAt DateTime

  @@index([published, createdAt])  // å¤åˆç´¢å¼•
  @@index([authorId])              // å¤–é”®ç´¢å¼•
}
```

### å­¦ä¹ ç›®æ ‡

é€šè¿‡æœ¬ç« ï¼Œä½ åº”è¯¥ç†è§£ï¼š

- Next.jsçš„æ¸²æŸ“æ¨¡å¼ä¼˜åŒ–ç­–ç•¥
- å›¾ç‰‡å’Œä»£ç åˆ†å‰²çš„æœ€ä½³å®è·µ
- æ•°æ®åº“æŸ¥è¯¢ä¼˜åŒ–æŠ€æœ¯

æ­å–œä½ ï¼é€šè¿‡å‰é¢8ç« çš„å­¦ä¹ ï¼Œä½ å·²ç»æŒæ¡äº†Next.jså…¨æ ˆå¼€å‘çš„æ ¸å¿ƒæŠ€èƒ½ï¼Œå¯ä»¥ç‹¬ç«‹æ„å»ºç°ä»£åŒ–çš„Webåº”ç”¨äº†ã€‚

---

## æ€»ç»“

é€šè¿‡è¿™ä»½æŒ‡å—,ä½ å·²ç»å­¦ä¹ äº†ï¼š

âœ… åç«¯çš„æœ¬è´¨å’ŒNode.jsåŸºç¡€
âœ… Next.js 15å…¨æ ˆå¼€å‘
âœ… é¡¹ç›®ç»“æ„å’Œæ–‡ä»¶ç»„ç»‡
âœ… Prismaæ•°æ®åº“æ“ä½œ
âœ… NextAuthè®¤è¯ç³»ç»Ÿ
âœ… ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²
âœ… æ€§èƒ½ä¼˜åŒ–æŠ€æœ¯

**æ­å–œä½ ï¼ä½ å·²ç»å…·å¤‡äº†å…¨æ ˆå¼€å‘çš„åŸºç¡€èƒ½åŠ›ã€‚**

æ¥ä¸‹æ¥,å»ºè®®ä½ ï¼š

1. åŠ¨æ‰‹å®è·µ,æ­å»ºè‡ªå·±çš„é¡¹ç›®
2. é˜…è¯»Next.jså’ŒPrismaå®˜æ–¹æ–‡æ¡£
3. å‚ä¸å¼€æºé¡¹ç›®
4. æŒç»­å­¦ä¹ æ–°æŠ€æœ¯

è®°ä½:**å®è·µæ˜¯æœ€å¥½çš„è€å¸ˆ,åŠ¨æ‰‹å†™ä»£ç æ‰èƒ½çœŸæ­£æŒæ¡å…¨æ ˆå¼€å‘ï¼**

---

## å‚è€ƒèµ„æº

- [Next.jså®˜æ–¹æ–‡æ¡£](https://nextjs.org/docs)
- [Prismaå®˜æ–¹æ–‡æ¡£](https://www.prisma.io/docs)
- [NextAuth.jsæ–‡æ¡£](https://next-auth.js.org/)
- [shadcn/uiç»„ä»¶åº“](https://ui.shadcn.com/)
- [Spring Lament Blogæºç ](https://github.com/flawlessv/Spring-Lament-Blog)

**ç¥ä½ å…¨æ ˆå¼€å‘ä¹‹è·¯é¡ºåˆ©ï¼** ğŸš€

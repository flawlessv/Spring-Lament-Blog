è¿™ç¯‡åšå®¢çš„å¤§è‡´æ€è·¯ï¼šnodejsç®€å•ä»‹ç»ã€nextç®€å•ä»‹ç»ã€sqlliteæ•°æ®åº“ç®€å•ä»‹ç»ã€éƒ¨ç½²çš„ä»‹ç»

# ğŸš€ Spring Lament Blog éƒ¨ç½²æŒ‡å—

> åŸºäºå®å¡”é¢æ¿ + Next.js + Prisma çš„ç°ä»£åŒ–åšå®¢ç³»ç»Ÿå®Œæ•´éƒ¨ç½²æŒ‡å—

---

## ğŸ“¦ æœåŠ¡å™¨ç¯å¢ƒå‡†å¤‡ï¼ˆå®å¡”é¢æ¿ç”¨æˆ·ï¼‰

> å¦‚æœä½ ä½¿ç”¨å®å¡”é¢æ¿ç®¡ç†æœåŠ¡å™¨ï¼ŒæŒ‰ä»¥ä¸‹æ­¥éª¤å‡†å¤‡ç¯å¢ƒ
> ç™»é™†å®å¡”é¢æ¿æ–¹æ³•ï¼š
> åœ¨SSHç»ˆç«¯è¾“å…¥ä»¥ä¸‹ä¸€ç§å‘½ä»¤æ¥è§£å†³1.æŸ¥çœ‹é¢æ¿å…¥å£ï¼š/etc/init.d/bt default

### 1. å®‰è£… Node ç‰ˆæœ¬ç®¡ç†å™¨

1. ç™»å½•å®å¡”é¢æ¿
2. å·¦ä¾§èœå• â†’ **è½¯ä»¶å•†åº—**
3. æœç´¢ "**Node ç‰ˆæœ¬ç®¡ç†å™¨**"
4. ç‚¹å‡» **å®‰è£…**

### 2. å®‰è£… Node.js 20.x

1. æ‰“å¼€ **Node ç‰ˆæœ¬ç®¡ç†å™¨**
2. ç‚¹å‡» **æ›´æ–°ç‰ˆæœ¬åˆ—è¡¨**ï¼ˆè·å–æœ€æ–° Node.js ç‰ˆæœ¬ï¼‰
3. é€‰æ‹© **v20.x.x**ï¼ˆæœ€æ–°ç¨³å®šç‰ˆï¼‰
4. ç‚¹å‡» **å®‰è£…**
5. å®‰è£…å®Œæˆåï¼Œå°† **å‘½ä»¤è¡Œç‰ˆæœ¬** è®¾ç½®ä¸º v20.x.x

**éªŒè¯å®‰è£…**ï¼š

```bash
# SSH ç™»å½•æœåŠ¡å™¨å
node -v   # åº”æ˜¾ç¤º v20.x.x
npm -v    # åº”æ˜¾ç¤ºå¯¹åº”çš„ npm ç‰ˆæœ¬
```

### 3. å®‰è£… PM2ï¼ˆè¿›ç¨‹ç®¡ç†å™¨ï¼‰

**æ–¹æ³•ä¸€ï¼šé€šè¿‡å®å¡”é¢æ¿å®‰è£…**

1. æ‰“å¼€ **Node ç‰ˆæœ¬ç®¡ç†å™¨**
2. ç‚¹å‡» **PM2 ç®¡ç†å™¨** æ ‡ç­¾
3. ç‚¹å‡» **å®‰è£… PM2**

**æ–¹æ³•äºŒï¼šé€šè¿‡å‘½ä»¤è¡Œå®‰è£…**

```bash
npm install -g pm2
pm2 -v  # éªŒè¯å®‰è£…
```

### 4. åˆ›å»ºé¡¹ç›®ç›®å½•

**æ–¹æ³•ä¸€ï¼šé€šè¿‡å®å¡”é¢æ¿**

1. å·¦ä¾§èœå• â†’ **æ–‡ä»¶**
2. è¿›å…¥ `/www/wwwroot/` ç›®å½•
3. ç‚¹å‡» **æ–°å»ºæ–‡ä»¶å¤¹**
4. è¾“å…¥åç§°ï¼š`my-next-app`
5. è®¾ç½®æƒé™ä¸º `755`

**æ–¹æ³•äºŒï¼šé€šè¿‡å‘½ä»¤è¡Œ**

```bash
mkdir -p /www/wwwroot/my-next-app
cd /www/wwwroot/my-next-app
```

---

## ğŸ”‘ GitHub ä»“åº“å’Œ SSH é…ç½®

### 1. åˆ›å»º GitHub ä»“åº“

1. æ‰“å¼€ [GitHub](https://github.com)ï¼Œç™»å½•è´¦å·
2. ç‚¹å‡»å³ä¸Šè§’ **+** â†’ **New repository**
3. å¡«å†™ï¼š
   - **Repository name**ï¼š`Spring-Lament-Blog`ï¼ˆæˆ–è‡ªå®šä¹‰åç§°ï¼‰
   - **Description**ï¼šä¸ªäººåšå®¢ç³»ç»Ÿ
   - **Public** æˆ– **Private**ï¼šæ ¹æ®éœ€æ±‚é€‰æ‹©
4. **ä¸è¦** å‹¾é€‰ "Initialize with README"
5. ç‚¹å‡» **Create repository**

### 2. æœ¬åœ°é¡¹ç›®æ¨é€åˆ° GitHub

åœ¨**æœ¬åœ°é¡¹ç›®ç›®å½•**è¿è¡Œï¼ˆé¦–æ¬¡æ¨é€ï¼‰ï¼š

```bash
# åˆå§‹åŒ– Git ä»“åº“
git init

# æ·»åŠ æ‰€æœ‰æ–‡ä»¶
git add .

# æäº¤
git commit -m "é¦–æ¬¡æäº¤"

# è®¾ç½®ä¸»åˆ†æ”¯åç§°
git branch -M main

# å…³è”è¿œç¨‹ä»“åº“ï¼ˆæ›¿æ¢ä¸ºä½ çš„ä»“åº“åœ°å€ï¼‰
git remote add origin https://github.com/ä½ çš„ç”¨æˆ·å/Spring-Lament-Blog.git

# æ¨é€ä»£ç 
git push -u origin main
```

**åç»­æäº¤ä»£ç **ï¼š

```bash
git add .
git commit -m "æè¿°ä½ çš„ä¿®æ”¹"
git push origin main
```

### 3. é…ç½®æœåŠ¡å™¨ SSH å¯†é’¥ï¼ˆè®©æœåŠ¡å™¨èƒ½æ‹‰å–ä»£ç ï¼‰

#### ä¸ºä»€ä¹ˆéœ€è¦è¿™æ­¥ï¼Ÿ

æœåŠ¡å™¨éœ€è¦ SSH å¯†é’¥æ‰èƒ½ä» GitHub æ‹‰å–ç§æœ‰ä»“åº“ä»£ç ã€‚

#### åœ¨æœåŠ¡å™¨ä¸Šç”Ÿæˆ SSH å¯†é’¥

```bash
# 1. SSH ç™»å½•æœåŠ¡å™¨
ssh root@42.193.227.185

# 2. ç”Ÿæˆ SSH å¯†é’¥ï¼ˆä¸€è·¯å›è½¦ï¼Œä¸è®¾ç½®å¯†ç ï¼‰
ssh-keygen -t rsa -b 4096 -C "github-deploy"

# è¾“å‡ºç¤ºä¾‹ï¼š
# Generating public/private rsa key pair.
# Enter file in which to save the key (/root/.ssh/id_rsa): [ç›´æ¥å›è½¦]
# Enter passphrase (empty for no passphrase): [ç›´æ¥å›è½¦]
# Enter same passphrase again: [ç›´æ¥å›è½¦]

# 3. æŸ¥çœ‹å…¬é’¥
cat ~/.ssh/id_rsa.pub
```

#### å°†å…¬é’¥æ·»åŠ åˆ° GitHub

1. **å¤åˆ¶** ä¸Šä¸€æ­¥æ˜¾ç¤ºçš„å…¬é’¥å†…å®¹ï¼ˆå®Œæ•´çš„ `ssh-rsa ...` å¼€å¤´çš„ä¸€å¤§æ®µï¼‰
2. æ‰“å¼€ GitHubï¼Œç‚¹å‡»å³ä¸Šè§’å¤´åƒ â†’ **Settings**
3. å·¦ä¾§èœå• â†’ **SSH and GPG keys**
4. ç‚¹å‡» **New SSH key**
5. å¡«å†™ï¼š
   - **Title**ï¼š`æœåŠ¡å™¨éƒ¨ç½²å¯†é’¥`ï¼ˆæˆ–ä»»æ„åç§°ï¼‰
   - **Key**ï¼šç²˜è´´åˆšæ‰å¤åˆ¶çš„å…¬é’¥
6. ç‚¹å‡» **Add SSH key**

#### æµ‹è¯•è¿æ¥

```bash
# åœ¨æœåŠ¡å™¨ä¸Šè¿è¡Œ
ssh -T git@github.com

# æˆåŠŸè¾“å‡ºï¼š
# Hi ä½ çš„ç”¨æˆ·å! You've successfully authenticated...
```

### 4. é…ç½® GitHub Actions çš„ SSH å¯†é’¥ï¼ˆè‡ªåŠ¨éƒ¨ç½²ç”¨ï¼‰

> è¿™ä¸€æ­¥æ˜¯ä¸ºäº†è®© GitHub Actions èƒ½é€šè¿‡ SSH è¿æ¥åˆ°ä½ çš„æœåŠ¡å™¨è¿›è¡Œè‡ªåŠ¨éƒ¨ç½²

#### ç”Ÿæˆä¸“ç”¨å¯†é’¥å¯¹

```bash
# åœ¨æœåŠ¡å™¨ä¸Šè¿è¡Œ
ssh-keygen -t rsa -b 4096 -C "github-actions-deploy" -f ~/.ssh/github_actions_rsa

# ä¸€è·¯å›è½¦ï¼Œä¸è®¾ç½®å¯†ç 

# å°†å…¬é’¥æ·»åŠ åˆ°æˆæƒåˆ—è¡¨
cat ~/.ssh/github_actions_rsa.pub >> ~/.ssh/authorized_keys
chmod 600 ~/.ssh/authorized_keys

# æŸ¥çœ‹ç§é’¥ï¼ˆç”¨äºæ·»åŠ åˆ° GitHub Secretsï¼‰
cat ~/.ssh/github_actions_rsa
```

#### å¤åˆ¶ç§é’¥å†…å®¹

å¤åˆ¶**å®Œæ•´çš„ç§é’¥å†…å®¹**ï¼ŒåŒ…æ‹¬ï¼š

```
-----BEGIN OPENSSH PRIVATE KEY-----
ï¼ˆä¸­é—´å¾ˆå¤šè¡Œï¼‰
-----END OPENSSH PRIVATE KEY-----
```

è¿™ä¸ªç§é’¥ç¨åä¼šç”¨äºé…ç½® `SERVER_SSH_KEY` Secretï¼ˆè§åç»­ç« èŠ‚ï¼‰ã€‚

---

## ğŸ“‹ é¦–æ¬¡éƒ¨ç½²

### 1. å…‹éš†ä»£ç 

```bash
ssh root@42.193.227.185
cd /www/wwwroot/my-next-app
git clone https://github.com/ä½ çš„ç”¨æˆ·å/Spring-Lament-Blog.git .
npm install
```

### 2. é…ç½®ç¯å¢ƒå˜é‡

åˆ›å»º `.env.production` æ–‡ä»¶ï¼š

```bash
nano .env.production
```

å¡«å…¥å†…å®¹ï¼š

```env
# æ•°æ®åº“ï¼ˆSQLite ç®€å•ï¼ŒPostgreSQL ç”Ÿäº§æ¨èï¼‰
DATABASE_URL="file:./prod.db"

# NextAuth å¯†é’¥ï¼ˆç”Ÿæˆå‘½ä»¤ï¼šopenssl rand -base64 32ï¼‰
NEXTAUTH_SECRET="ç²˜è´´ç”Ÿæˆçš„å¯†é’¥"

# ç½‘ç«™åœ°å€ï¼ˆä¸è¦åŠ æ–œæ ï¼‰
NEXTAUTH_URL="http://powder.icu"

NODE_ENV="production"
```

ä¿å­˜å¹¶è®¾ç½®æƒé™ï¼š

```bash
chmod 600 .env.production
```

### 4. åˆå§‹åŒ–æ•°æ®åº“

```bash
npm run db:generate
npm run db:push
npm run db:seed
```

### 5. æ„å»ºå’Œå¯åŠ¨

```bash
npm run build
mkdir -p logs
pm2 start ecosystem.config.js
pm2 save
pm2 startup  # è®¾ç½®å¼€æœºè‡ªå¯ï¼Œæ‰§è¡Œè¾“å‡ºçš„å‘½ä»¤
```

### 6. éªŒè¯éƒ¨ç½²

```bash
pm2 status                      # åº”è¯¥æ˜¾ç¤º online
curl http://localhost:3000      # æµ‹è¯•è®¿é—®
```

æµè§ˆå™¨è®¿é—®ï¼š

- é¦–é¡µï¼šhttp://powder.icu
- åå°ï¼šhttp://powder.icu/admin
- è´¦å·ï¼š`admin` / `0919`

---

## ğŸ¯ Nginx åå‘ä»£ç†é…ç½®

åœ¨å®å¡”é¢æ¿ â†’ ç½‘ç«™è®¾ç½® â†’ é…ç½®æ–‡ä»¶ï¼Œæ·»åŠ ï¼š

```nginx
server {
    listen 80;
    server_name powder.icu;
    client_max_body_size 50M;

    location / {
        proxy_pass http://127.0.0.1:3000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_cache_bypass $http_upgrade;
    }
}
```

é…ç½®å®Œæˆåé‡å¯ Nginx å³å¯é€šè¿‡åŸŸåè®¿é—®ã€‚

---

## ğŸ› ï¸ å¸¸ç”¨ç®¡ç†å‘½ä»¤

### PM2 è¿›ç¨‹ç®¡ç†

#### å‘½ä»¤è¡Œæ–¹å¼

```bash
pm2 status                      # æŸ¥çœ‹çŠ¶æ€
pm2 logs spring-lament-blog     # æŸ¥çœ‹æ—¥å¿—
pm2 restart spring-lament-blog  # é‡å¯
pm2 stop spring-lament-blog     # åœæ­¢
pm2 delete spring-lament-blog   # åˆ é™¤
pm2 monit                       # ç›‘æ§
```

#### å®å¡”é¢æ¿å›¾å½¢åŒ–ç®¡ç†ï¼ˆæ¨èæ–°æ‰‹ â­ï¼‰

å¦‚æœä½ ä½¿ç”¨å®å¡”é¢æ¿ï¼Œå¯ä»¥é€šè¿‡å¯è§†åŒ–ç•Œé¢ç®¡ç† PM2ï¼š

**æ·»åŠ  Node é¡¹ç›®**ï¼š

1. æ‰“å¼€ **Node ç‰ˆæœ¬ç®¡ç†å™¨**
2. ç‚¹å‡» **PM2 ç®¡ç†å™¨** æ ‡ç­¾
3. ç‚¹å‡» **æ·»åŠ é¡¹ç›®**
4. é€‰æ‹© **ä»æ–‡ä»¶/å†…å®¹æ·»åŠ **
5. **é…ç½®æ–‡ä»¶è·¯å¾„**ï¼š`/www/wwwroot/my-next-app/ecosystem.config.js`
6. ç‚¹å‡» **æäº¤**

**ç®¡ç†é¡¹ç›®**ï¼ˆå¯åŠ¨åï¼‰ï¼š

- ğŸ”„ **é‡å¯**ï¼šç‚¹å‡»é¡¹ç›®å³ä¾§çš„é‡å¯æŒ‰é’®
- â¸ï¸ **åœæ­¢**ï¼šç‚¹å‡»åœæ­¢æŒ‰é’®
- ğŸ“Š **æŸ¥çœ‹æ—¥å¿—**ï¼šç‚¹å‡»"æ—¥å¿—"æŒ‰é’®æŸ¥çœ‹å®æ—¶æ—¥å¿—
- ğŸ“ˆ **æŸ¥çœ‹çŠ¶æ€**ï¼šæŸ¥çœ‹ CPUã€å†…å­˜å ç”¨
- ğŸŒ **ç»‘å®šåŸŸå**ï¼šç‚¹å‡»"æ˜ å°„"è®¾ç½®å¤–ç½‘è®¿é—®

**å¼€å¯å¤–ç½‘æ˜ å°„**ï¼ˆè®©å¤–éƒ¨èƒ½è®¿é—®ï¼‰ï¼š

1. åœ¨é¡¹ç›®åˆ—è¡¨ä¸­æ‰¾åˆ° `spring-lament-blog`
2. ç‚¹å‡» **æ˜ å°„** æŒ‰é’®
3. å‹¾é€‰ **å¼€å¯å¤–ç½‘æ˜ å°„**
4. å¡«å†™åŸŸåï¼š`powder.icu`
5. å†…ç½‘ç«¯å£ï¼š`3000`
6. å¤–ç½‘ç«¯å£ï¼š`80`
7. ä¿å­˜

### æ•°æ®åº“ç®¡ç†

```bash
npm run db:generate  # ç”Ÿæˆ Prisma Client
npm run db:push      # åŒæ­¥æ•°æ®åº“ç»“æ„
npm run db:seed      # åˆ›å»ºåˆå§‹æ•°æ®
npm run db:studio    # æ•°æ®åº“ç®¡ç†ç•Œé¢
```

---

## ğŸ”„ ä»£ç æ›´æ–°ï¼ˆä¸‰ç§æ–¹å¼ï¼‰

### æ–¹æ³• 1ï¼šä½¿ç”¨è„šæœ¬ï¼ˆæ¨è â­ï¼‰

**ä¼˜åŠ¿**ï¼š

- âœ… ä¸€æ¡å‘½ä»¤å®Œæˆæ‰€æœ‰æ­¥éª¤
- âœ… è‡ªåŠ¨å¤‡ä»½å½“å‰ç‰ˆæœ¬
- âœ… å‡ºé—®é¢˜å¯ä»¥å¿«é€Ÿå›æ»š

**æ­¥éª¤**ï¼š

```bash
# 1. SSH ç™»å½•æœåŠ¡å™¨
ssh root@42.193.227.185

# 2. è¿›å…¥é¡¹ç›®ç›®å½•
cd /www/wwwroot/my-next-app

# 3. è¿è¡Œæ›´æ–°è„šæœ¬
bash scripts/update-deploy.sh
```

**è„šæœ¬è‡ªåŠ¨æ‰§è¡Œ**ï¼š

- ğŸ“¦ å¤‡ä»½å½“å‰ç‰ˆæœ¬åˆ° `../backups/backup-YYYYMMDD-HHMMSS/`
- ğŸ“¥ æ‹‰å–æœ€æ–°ä»£ç  `git pull`
- ğŸ“¦ æ›´æ–°ä¾èµ– `npm ci --production`
- â“ è¯¢é—®æ˜¯å¦éœ€è¦æ›´æ–°æ•°æ®åº“
- ğŸ”¨ é‡æ–°æ„å»º `npm run build`
- ğŸ”„ é‡å¯åº”ç”¨ `pm2 restart`

**å¦‚æœæ›´æ–°å¤±è´¥ï¼Œå›æ»š**ï¼š

```bash
# è„šæœ¬ä¼šæ˜¾ç¤ºå¤‡ä»½ä½ç½®ï¼Œä¾‹å¦‚ï¼š
# å¤‡ä»½å®Œæˆ: ../backups/backup-20251010-143000

# å¤åˆ¶å¤‡ä»½å›æ¥
cp -r ../backups/backup-20251010-143000/* /www/wwwroot/my-next-app/
pm2 restart spring-lament-blog
```

---

### æ–¹æ³• 2ï¼šGitHub Actions è‡ªåŠ¨éƒ¨ç½²ï¼ˆæœ€æ–¹ä¾¿ â­â­â­ï¼‰

**ä¼˜åŠ¿**ï¼š

- ğŸš€ å®Œå…¨è‡ªåŠ¨åŒ–ï¼Œæ¨é€ä»£ç å³éƒ¨ç½²
- ğŸ¯ ä¸éœ€è¦ç™»å½•æœåŠ¡å™¨
- ğŸ“Š GitHub å¯è§†åŒ–æŸ¥çœ‹éƒ¨ç½²çŠ¶æ€å’Œæ—¥å¿—
- â±ï¸ èŠ‚çœå¤§é‡æ—¶é—´
- ğŸ **å·²ä¼˜åŒ–**ï¼šåªä¸Šä¼ æ„å»ºäº§ç‰©ï¼Œé€Ÿåº¦å¿« 10-20 å€

**å‰ææ¡ä»¶**ï¼šå·²é…ç½®å¥½ GitHub Secretsï¼ˆè§ä¸‹é¢çš„è¯¦ç»†è¯´æ˜ï¼‰

**ä½¿ç”¨æ­¥éª¤**ï¼š

```bash
# 1. åœ¨æœ¬åœ°ä¿®æ”¹ä»£ç 
git add .
git commit -m "æ·»åŠ æ–°åŠŸèƒ½"

# 2. æ¨é€åˆ° GitHub
git push origin main

# 3. è‡ªåŠ¨éƒ¨ç½²å¼€å§‹ï¼
# GitHub Actions ä¼šè‡ªåŠ¨ï¼š
# - æ£€å‡ºä»£ç 
# - å®‰è£…ä¾èµ–å¹¶æ„å»ºé¡¹ç›®ï¼ˆåœ¨ GitHub æœåŠ¡å™¨ä¸Šï¼‰
# - åªä¸Šä¼ æ„å»ºåçš„ .nextã€é…ç½®æ–‡ä»¶ç­‰å¿…è¦æ–‡ä»¶ï¼ˆä¸åŒ…æ‹¬ node_modulesï¼‰
# - åœ¨æœåŠ¡å™¨ä¸Šå®‰è£…ç”Ÿäº§ä¾èµ–
# - æ¨é€æ•°æ®åº“å˜æ›´
# - é‡å¯åº”ç”¨
```

**âš¡ æ€§èƒ½ä¼˜åŒ–è¯´æ˜**ï¼š

æˆ‘ä»¬çš„éƒ¨ç½²é…ç½®å·²ç»è¿‡ä¼˜åŒ–ï¼Œ**ä¸ä¼šä¸Šä¼  node_modules**ï¼ˆæ•°ä¸‡ä¸ªå°æ–‡ä»¶ï¼‰ï¼Œè€Œæ˜¯ï¼š

1. åœ¨ GitHub Actions æœåŠ¡å™¨ä¸Šæ„å»º
2. åªä¸Šä¼ æ„å»ºäº§ç‰©ï¼ˆ`.next`ã€`prisma` ç­‰å¿…è¦æ–‡ä»¶ï¼‰
3. åœ¨æœåŠ¡å™¨ä¸Šé€šè¿‡ `npm ci --production` å®‰è£…ç”Ÿäº§ä¾èµ–

**éƒ¨ç½²æ—¶é—´å¯¹æ¯”**ï¼š

- âŒ æ—§æ–¹æ³•ï¼ˆä¸Šä¼ å…¨éƒ¨æ–‡ä»¶ï¼‰ï¼š60-90 åˆ†é’Ÿ
- âœ… æ–°æ–¹æ³•ï¼ˆåªä¸Šä¼ æ„å»ºäº§ç‰©ï¼‰ï¼š3-5 åˆ†é’Ÿ

**æŸ¥çœ‹éƒ¨ç½²çŠ¶æ€**ï¼š

1. æ‰“å¼€ GitHub ä»“åº“é¡µé¢
2. ç‚¹å‡»é¡¶éƒ¨ **Actions** æ ‡ç­¾
3. æŸ¥çœ‹æœ€æ–°çš„å·¥ä½œæµè¿è¡ŒçŠ¶æ€
   - ğŸŸ¢ ç»¿è‰²å¯¹å‹¾ = éƒ¨ç½²æˆåŠŸ
   - ğŸ”´ çº¢è‰²å‰å· = éƒ¨ç½²å¤±è´¥ï¼Œç‚¹å‡»æŸ¥çœ‹é”™è¯¯æ—¥å¿—
   - ğŸŸ¡ é»„è‰²åœ†åœˆ = æ­£åœ¨éƒ¨ç½²ä¸­

**é¦–æ¬¡éƒ¨ç½²æ³¨æ„**ï¼š

- ç¬¬ä¸€æ¬¡éƒ¨ç½²æ—¶ï¼ŒæœåŠ¡å™¨éœ€è¦å®‰è£…æ‰€æœ‰ä¾èµ–ï¼Œå¯èƒ½éœ€è¦ 5-10 åˆ†é’Ÿ
- åç»­éƒ¨ç½²å¦‚æœ `package-lock.json` æ²¡å˜åŒ–ï¼Œä¼šè·³è¿‡ä¾èµ–å®‰è£…ï¼Œåªéœ€ 1-2 åˆ†é’Ÿ

---

### æ–¹æ³• 3ï¼šæ‰‹åŠ¨æ›´æ–°ï¼ˆå®Œå…¨æ‰‹åŠ¨æ§åˆ¶ï¼‰

**ä¼˜åŠ¿**ï¼š

- ğŸ¯ ç²¾ç¡®æ§åˆ¶æ¯ä¸€æ­¥
- ğŸ” é€‚åˆå­¦ä¹ ç†è§£éƒ¨ç½²æµç¨‹
- ğŸ†˜ è‡ªåŠ¨è„šæœ¬å‡ºé—®é¢˜æ—¶çš„å¤‡ç”¨æ–¹æ¡ˆ

**å®Œæ•´æ­¥éª¤**ï¼š

```bash
# 1. SSH ç™»å½•æœåŠ¡å™¨
ssh root@42.193.227.185

# 2. è¿›å…¥é¡¹ç›®ç›®å½•
cd /www/wwwroot/my-next-app

# 3. æ‹‰å–æœ€æ–°ä»£ç 
git pull origin main

# å¦‚æœæç¤ºå†²çªï¼Œå¼ºåˆ¶è¦†ç›–æœ¬åœ°ä¿®æ”¹ï¼š
git fetch origin
git reset --hard origin/main

# 4. æ›´æ–°ä¾èµ–ï¼ˆå¦‚æœ package.json æœ‰å˜åŒ–ï¼‰
npm install

# 5. å¦‚æœä¿®æ”¹äº†æ•°æ®åº“ç»“æ„
# âš ï¸ é‡è¦ï¼šå…ˆåˆ é™¤ .env æ–‡ä»¶
rm .env
npm run db:push

# 6. é‡æ–°æ„å»º
npm run build

# 7. é‡å¯åº”ç”¨ï¼ˆå¦‚æœä¿®æ”¹äº† .env.productionï¼‰
pm2 delete spring-lament-blog
pm2 start ecosystem.config.js
pm2 save

# æˆ–è€…åªæ˜¯é‡å¯ï¼ˆæ²¡æœ‰ä¿®æ”¹ç¯å¢ƒå˜é‡ï¼‰
pm2 restart spring-lament-blog

# 8. éªŒè¯
pm2 status
pm2 logs spring-lament-blog --lines 20
```

---

### ğŸ“Š ä¸‰ç§æ–¹æ³•å¯¹æ¯”

| ç‰¹æ€§         | è„šæœ¬æ›´æ–° | GitHub Actions | æ‰‹åŠ¨æ›´æ–° |
| ------------ | -------- | -------------- | -------- |
| **éš¾åº¦**     | â­ ç®€å•  | â­â­ ä¸­ç­‰      | â­â­â­   |
| **é€Ÿåº¦**     | å¿«       | è¾ƒå¿«           | æ…¢       |
| **è‡ªåŠ¨åŒ–**   | åŠè‡ªåŠ¨   | å…¨è‡ªåŠ¨         | æ‰‹åŠ¨     |
| **éœ€ç™»å½•**   | æ˜¯       | å¦             | æ˜¯       |
| **è‡ªåŠ¨å¤‡ä»½** | æ˜¯       | å¦             | å¦       |
| **æ¨èåº¦**   | â­â­â­â­ | â­â­â­â­â­     | â­â­     |

**å»ºè®®**ï¼š

- æ—¥å¸¸å¼€å‘ï¼šä½¿ç”¨ **GitHub Actions**ï¼ˆæœ€çœå¿ƒï¼‰
- ç´§æ€¥ä¿®å¤ï¼šä½¿ç”¨ **è„šæœ¬æ›´æ–°**ï¼ˆæœ‰å¤‡ä»½æ›´å®‰å…¨ï¼‰
- å­¦ä¹ è°ƒè¯•ï¼šä½¿ç”¨ **æ‰‹åŠ¨æ›´æ–°**ï¼ˆç†è§£æ¯ä¸€æ­¥ï¼‰

---

## ğŸ¤– GitHub Actions é…ç½®

### é…ç½® 7 ä¸ª GitHub Secrets

> è‡ªåŠ¨éƒ¨ç½²éœ€è¦åœ¨ GitHub ä»“åº“é…ç½®è¿™ 7 ä¸ªå¯†é’¥

#### æ·»åŠ  Secrets çš„ä½ç½®

`ä½ çš„ä»“åº“` â†’ `Settings` â†’ `Secrets and variables` â†’ `Actions` â†’ `New repository secret`

---

### 1ï¸âƒ£ SERVER_HOSTï¼ˆæœåŠ¡å™¨ IPï¼‰

**å€¼**ï¼š`42.193.227.185`

**å¦‚ä½•è·å–**ï¼š

- è¿™æ˜¯ä½ çš„**è…¾è®¯äº‘æœåŠ¡å™¨ IP åœ°å€**
- åœ¨è…¾è®¯äº‘æ§åˆ¶å° â†’ äº‘æœåŠ¡å™¨ â†’ å®ä¾‹åˆ—è¡¨ä¸­æŸ¥çœ‹
- æˆ–è€…åœ¨å®å¡”é¢æ¿å³ä¸Šè§’å¯ä»¥çœ‹åˆ°æœåŠ¡å™¨ IP

---

### 2ï¸âƒ£ SERVER_USERï¼ˆSSH ç”¨æˆ·åï¼‰

**å€¼**ï¼š`root`

**è¯´æ˜**ï¼š

- æœåŠ¡å™¨çš„ SSH ç™»å½•ç”¨æˆ·å
- é€šå¸¸æ˜¯ `root`ï¼ˆLinux æœ€é«˜æƒé™ç”¨æˆ·ï¼‰
- å¦‚æœä½¿ç”¨å…¶ä»–ç”¨æˆ·ï¼Œå¡«å†™å¯¹åº”çš„ç”¨æˆ·å

---

### 3ï¸âƒ£ SERVER_SSH_KEYï¼ˆSSH ç§é’¥ï¼‰

> ğŸ’¡ **å¦‚ä½•è·å–**ï¼šå‚è€ƒå‰é¢ [ğŸ”‘ GitHub ä»“åº“å’Œ SSH é…ç½® â†’ 4. é…ç½® GitHub Actions çš„ SSH å¯†é’¥](#ğŸ”‘-github-ä»“åº“å’Œ-ssh-é…ç½®) ç« èŠ‚

**ç®€è¦æ­¥éª¤**ï¼š

```bash
# åœ¨æœåŠ¡å™¨ä¸ŠæŸ¥çœ‹å·²ç”Ÿæˆçš„ç§é’¥
cat ~/.ssh/github_actions_rsa

# å¦‚æœè¿˜æ²¡ç”Ÿæˆï¼Œè¿è¡Œï¼š
ssh-keygen -t rsa -b 4096 -C "github-actions-deploy" -f ~/.ssh/github_actions_rsa
cat ~/.ssh/github_actions_rsa.pub >> ~/.ssh/authorized_keys
chmod 600 ~/.ssh/authorized_keys
```

**éœ€è¦å¤åˆ¶çš„å†…å®¹æ ¼å¼**ï¼š

```
-----BEGIN OPENSSH PRIVATE KEY-----
ï¼ˆå®Œæ•´çš„ç§é’¥å†…å®¹ï¼ŒåŒ…æ‹¬æ‰€æœ‰è¡Œï¼‰
-----END OPENSSH PRIVATE KEY-----
```

**âš ï¸ é‡è¦**ï¼š

- å¿…é¡»å¤åˆ¶**å®Œæ•´å†…å®¹**ï¼ŒåŒ…æ‹¬ç¬¬ä¸€è¡Œå’Œæœ€åä¸€è¡Œ
- è¿™æ˜¯å‰é¢ç”Ÿæˆçš„ `github_actions_rsa` **ç§é’¥**ï¼ˆä¸æ˜¯å…¬é’¥ï¼‰

---

### 4ï¸âƒ£ SERVER_PORTï¼ˆSSH ç«¯å£ï¼‰

**å€¼**ï¼š`22`

**è¯´æ˜**ï¼š

- SSH é»˜è®¤ç«¯å£æ˜¯ `22`
- å¦‚æœä½ ä¿®æ”¹è¿‡ SSH ç«¯å£ï¼Œå¡«å†™ä¿®æ”¹åçš„ç«¯å£å·
- åœ¨æœåŠ¡å™¨ä¸ŠæŸ¥çœ‹ï¼š`cat /etc/ssh/sshd_config | grep Port`

---

### 5ï¸âƒ£ DATABASE_URLï¼ˆæ•°æ®åº“è¿æ¥ï¼‰

**SQLiteï¼ˆç®€å•ï¼‰**ï¼š

```
file:./prod.db
```

**PostgreSQLï¼ˆæ¨èç”Ÿäº§ï¼‰**ï¼š

```
postgresql://ç”¨æˆ·å:å¯†ç @localhost:5432/æ•°æ®åº“å?schema=public
```

**ç¤ºä¾‹**ï¼š

```
postgresql://blog_user:MyStr0ngP@ssw0rd@localhost:5432/spring_lament_blog?schema=public
```

**å¦‚ä½•è·å–**ï¼š

- è¿™æ˜¯ä½ åœ¨æœåŠ¡å™¨ä¸Šåˆ›å»ºæ•°æ®åº“æ—¶è®¾ç½®çš„
- ç”¨æˆ·åå’Œå¯†ç æ˜¯ä½ è‡ªå·±å®šä¹‰çš„
- å¦‚æœå¿˜è®°äº†ï¼Œå¯ä»¥åœ¨æœåŠ¡å™¨çš„ `.env.production` æ–‡ä»¶ä¸­æŸ¥çœ‹

---

### 6ï¸âƒ£ NEXTAUTH_SECRETï¼ˆNextAuth å¯†é’¥ï¼‰

**å¦‚ä½•ç”Ÿæˆ**ï¼š

åœ¨**æœåŠ¡å™¨ä¸Š**æˆ–**æœ¬åœ°ç»ˆç«¯**è¿è¡Œï¼š

```bash
openssl rand -base64 32
```

**è¾“å‡ºç¤ºä¾‹**ï¼š

```
Xk7pQ9vR2mN5hJ8fD3sA6wE1yT4uI0oP2lK9nM7bV6cX
```

**âš ï¸ æ³¨æ„**ï¼š

- è¿™æ˜¯ä¸€ä¸ªéšæœºç”Ÿæˆçš„å¼ºå¯†é’¥
- ç”¨äºåŠ å¯†ç”¨æˆ·ä¼šè¯ï¼Œå¿…é¡»ä¿å¯†
- å¤åˆ¶ç”Ÿæˆçš„å­—ç¬¦ä¸²ä½œä¸º Secret å€¼

---

### 7ï¸âƒ£ NEXTAUTH_URLï¼ˆç½‘ç«™åœ°å€ï¼‰

**å€¼**ï¼š`http://powder.icu`

**è¯´æ˜**ï¼š

- ä½ çš„ç½‘ç«™å®Œæ•´åœ°å€
- HTTP ç‰ˆæœ¬ï¼š`http://powder.icu`
- HTTPS ç‰ˆæœ¬ï¼ˆé…ç½® SSL åï¼‰ï¼š`https://powder.icu`
- **âš ï¸ æœ«å°¾ä¸è¦åŠ æ–œæ ï¼**

---

### ğŸ“ æ·»åŠ  Secrets çš„æ­¥éª¤

1. æ‰“å¼€ GitHub ä»“åº“é¡µé¢
2. ç‚¹å‡» `Settings`ï¼ˆè®¾ç½®ï¼‰
3. å·¦ä¾§èœå•ç‚¹å‡» `Secrets and variables` â†’ `Actions`
4. ç‚¹å‡» `New repository secret` æŒ‰é’®
5. å¡«å†™ï¼š
   - **Name**ï¼šSecret åç§°ï¼ˆå¦‚ `SERVER_HOST`ï¼‰
   - **Secret**ï¼šå¯¹åº”çš„å€¼ï¼ˆå¦‚ `42.193.227.185`ï¼‰
6. ç‚¹å‡» `Add secret` ä¿å­˜
7. é‡å¤ä»¥ä¸Šæ­¥éª¤ï¼Œæ·»åŠ æ‰€æœ‰ 7 ä¸ª Secrets

---

### âœ… é…ç½®å®Œæˆæ£€æŸ¥

æ·»åŠ å®Œæ‰€æœ‰ Secrets åï¼Œä½ åº”è¯¥çœ‹åˆ°ï¼š

```
SERVER_HOST
SERVER_USER
SERVER_SSH_KEY
SERVER_PORT
DATABASE_URL
NEXTAUTH_SECRET
NEXTAUTH_URL
```

**æµ‹è¯•è‡ªåŠ¨éƒ¨ç½²**ï¼š

```bash
git add .
git commit -m "test: æµ‹è¯•è‡ªåŠ¨éƒ¨ç½²"
git push origin main
```

ç„¶ååœ¨ GitHub ä»“åº“çš„ **Actions** æ ‡ç­¾æŸ¥çœ‹éƒ¨ç½²çŠ¶æ€ï¼

---

## ğŸ› å¸¸è§é—®é¢˜æ’æŸ¥

### GitHub Actions éƒ¨ç½²å¤±è´¥ âŒ

**å¦‚ä½•æŸ¥çœ‹è¯¦ç»†é”™è¯¯**ï¼š

1. æ‰“å¼€ GitHub ä»“åº“ â†’ **Actions** æ ‡ç­¾
2. ç‚¹å‡»å¤±è´¥çš„å·¥ä½œæµï¼ˆçº¢è‰²å‰å·ï¼‰
3. ç‚¹å‡» **build-and-deploy** ä»»åŠ¡
4. å±•å¼€å¤±è´¥çš„æ­¥éª¤ï¼ŒæŸ¥çœ‹é”™è¯¯ä¿¡æ¯

**å¸¸è§é”™è¯¯åŠè§£å†³æ–¹æ¡ˆ**ï¼š

#### 1. SSH è¿æ¥å¤±è´¥

```
Error: connect ECONNREFUSED
```

**åŸå› **ï¼šæœåŠ¡å™¨ IPã€ç«¯å£æˆ– SSH å¯†é’¥é…ç½®é”™è¯¯

**è§£å†³æ–¹æ¡ˆ**ï¼š

- æ£€æŸ¥ GitHub Secrets ä¸­çš„ `SERVER_HOST`ã€`SERVER_PORT`ã€`SERVER_SSH_KEY` æ˜¯å¦æ­£ç¡®
- ç¡®ä¿æœåŠ¡å™¨é˜²ç«å¢™å…è®¸ SSH è¿æ¥ï¼ˆç«¯å£ 22ï¼‰
- æµ‹è¯• SSH è¿æ¥ï¼š`ssh root@ä½ çš„æœåŠ¡å™¨IP`

#### 2. æƒé™è¢«æ‹’ç»

```
Permission denied (publickey)
```

**åŸå› **ï¼šSSH ç§é’¥æœªæ­£ç¡®æ·»åŠ åˆ°æœåŠ¡å™¨

**è§£å†³æ–¹æ¡ˆ**ï¼š

```bash
# åœ¨æœåŠ¡å™¨ä¸Šè¿è¡Œ
cat ~/.ssh/github_actions_rsa.pub >> ~/.ssh/authorized_keys
chmod 600 ~/.ssh/authorized_keys
chmod 700 ~/.ssh
```

#### 3. npm ci å¤±è´¥

```
npm error code ELIFECYCLE
```

**åŸå› **ï¼šä¾èµ–å®‰è£…å¤±è´¥æˆ– Node ç‰ˆæœ¬ä¸åŒ¹é…

**è§£å†³æ–¹æ¡ˆ**ï¼š

```bash
# ç™»å½•æœåŠ¡å™¨
ssh root@ä½ çš„æœåŠ¡å™¨IP
cd /www/wwwroot/my-next-app

# æ¸…ç†å¹¶é‡æ–°å®‰è£…
rm -rf node_modules package-lock.json
npm install
npm run build
pm2 restart spring-lament-blog
```

#### 4. æ•°æ®åº“é”™è¯¯

```
Error: P1001: Can't reach database server
```

**åŸå› **ï¼šæœåŠ¡å™¨ä¸Šçš„ `.env.production` æ–‡ä»¶ä¸å­˜åœ¨æˆ–é…ç½®é”™è¯¯

**è§£å†³æ–¹æ¡ˆ**ï¼š

```bash
# ç™»å½•æœåŠ¡å™¨ï¼Œæ£€æŸ¥ç¯å¢ƒå˜é‡æ–‡ä»¶
cd /www/wwwroot/my-next-app
cat .env.production  # æŸ¥çœ‹é…ç½®

# å¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ›å»ºå®ƒ
nano .env.production
# æŒ‰ç…§å‰é¢ç« èŠ‚çš„è¯´æ˜å¡«å…¥é…ç½®
```

### 502 Bad Gateway

```bash
pm2 status
pm2 logs spring-lament-blog --err --lines 50
pm2 restart spring-lament-blog
```

### æ•°æ®åº“è¿æ¥å¤±è´¥

```bash
cat .env.production  # æ£€æŸ¥é…ç½®
npm run db:push      # æµ‹è¯•è¿æ¥
```

### ç«¯å£ 80 è¢«å ç”¨

```bash
lsof -i :80          # æŸ¥çœ‹å ç”¨è¿›ç¨‹
kill -9 [PID]        # ç»“æŸè¿›ç¨‹
```

### npm install å¤±è´¥

```bash
rm -rf node_modules .next
npm cache clean --force
npm install
```

### GitHub Actions éƒ¨ç½²å¾ˆæ…¢ï¼ˆè¶…è¿‡ 10 åˆ†é’Ÿï¼‰

**åŸå› **ï¼šå¯èƒ½æ˜¯ç½‘ç»œé—®é¢˜æˆ–é…ç½®æœªä¼˜åŒ–

**æ£€æŸ¥è¦ç‚¹**ï¼š

1. ç¡®ä¿ `.github/workflows/deploy.yml` ä¸­çš„ `source` å‚æ•°**ä¸åŒ…å« `node_modules`**
2. åº”è¯¥åªä¸Šä¼ ï¼š`.next,package.json,package-lock.json,prisma,public,...`
3. æ£€æŸ¥æœåŠ¡å™¨ç£ç›˜ç©ºé—´ï¼š`df -h`
4. æ£€æŸ¥æœåŠ¡å™¨å†…å­˜ï¼š`free -h`

**å¦‚æœä»ç„¶å¾ˆæ…¢**ï¼š

```bash
# ç™»å½•æœåŠ¡å™¨ï¼Œæ‰‹åŠ¨æ¸…ç†æ—§æ–‡ä»¶
cd /www/wwwroot/my-next-app
rm -rf .next.backup node_modules/.cache
```

---

## âœ… éƒ¨ç½²æ£€æŸ¥æ¸…å•

### ğŸ”§ æœåŠ¡å™¨ç¯å¢ƒå‡†å¤‡

- [ ] æœåŠ¡å™¨å·²å®‰è£… Node.js 20.xï¼ˆé€šè¿‡å®å¡”é¢æ¿æˆ–å‘½ä»¤è¡Œï¼‰
- [ ] æœåŠ¡å™¨å·²å®‰è£… PM2
- [ ] å·²åˆ›å»ºé¡¹ç›®ç›®å½• `/www/wwwroot/my-next-app`
- [ ] åŸŸåå·²è§£æåˆ°æœåŠ¡å™¨ IP

### ğŸ”‘ GitHub å’Œ SSH é…ç½®

- [ ] å·²åˆ›å»º GitHub ä»“åº“
- [ ] æœ¬åœ°ä»£ç å·²æ¨é€åˆ° GitHub
- [ ] æœåŠ¡å™¨ SSH å¯†é’¥å·²ç”Ÿæˆ
- [ ] æœåŠ¡å™¨å…¬é’¥å·²æ·»åŠ åˆ° GitHubï¼ˆç”¨äºæ‹‰å–ä»£ç ï¼‰
- [ ] GitHub Actions SSH å¯†é’¥å·²ç”Ÿæˆï¼ˆç”¨äºè‡ªåŠ¨éƒ¨ç½²ï¼‰
- [ ] 7 ä¸ª GitHub Secrets å·²é…ç½®ï¼ˆå¦‚æœä½¿ç”¨è‡ªåŠ¨éƒ¨ç½²ï¼‰

### ğŸ“¦ é¦–æ¬¡éƒ¨ç½²

- [ ] ä»£ç å·²å…‹éš†åˆ°æœåŠ¡å™¨
- [ ] `.env.production` å·²åˆ›å»ºå¹¶é…ç½®
- [ ] ç¡®è®¤æ²¡æœ‰ `.env` æ–‡ä»¶ï¼ˆå·²åˆ é™¤ï¼‰
- [ ] ä¾èµ–å·²å®‰è£…ï¼ˆ`npm install`ï¼‰
- [ ] Prisma Client å·²ç”Ÿæˆï¼ˆ`npm run db:generate`ï¼‰
- [ ] æ•°æ®åº“å·²åˆå§‹åŒ–ï¼ˆ`npm run db:push` å’Œ `npm run db:seed`ï¼‰
- [ ] é¡¹ç›®å·²æ„å»ºï¼ˆ`npm run build`ï¼‰
- [ ] PM2 å·²å¯åŠ¨ï¼ˆ`pm2 start ecosystem.config.js`ï¼‰
- [ ] PM2 å·²ä¿å­˜ï¼ˆ`pm2 save`ï¼‰
- [ ] PM2 å¼€æœºè‡ªå¯å·²è®¾ç½®ï¼ˆ`pm2 startup`ï¼‰

### âœ… éªŒè¯æµ‹è¯•

- [ ] PM2 çŠ¶æ€ä¸º onlineï¼ˆ`pm2 status`ï¼‰
- [ ] æœ¬åœ°æµ‹è¯•å¯è®¿é—®ï¼ˆ`curl http://localhost:3000`ï¼‰
- [ ] ç½‘ç«™é¦–é¡µå¯ä»¥è®¿é—®ï¼ˆhttp://powder.icuï¼‰
- [ ] åå°å¯ä»¥è®¿é—®ï¼ˆhttp://powder.icu/adminï¼‰
- [ ] å¯ä»¥ç™»å½•åå°ï¼ˆè´¦å·ï¼šadmin / 0919ï¼‰
- [ ] å·²ä¿®æ”¹é»˜è®¤ç®¡ç†å‘˜å¯†ç 

### ğŸš€ å¯é€‰ä¼˜åŒ–

- [ ] Nginx åå‘ä»£ç†å·²é…ç½®
- [ ] SSL è¯ä¹¦å·²é…ç½®ï¼ˆHTTPSï¼‰
- [ ] GitHub Actions è‡ªåŠ¨éƒ¨ç½²å·²æµ‹è¯•
- [ ] å®å¡”é¢æ¿ PM2 ç®¡ç†ç•Œé¢å·²é…ç½®
- [ ] å¤–ç½‘æ˜ å°„å·²å¼€å¯ï¼ˆå®å¡”é¢æ¿ï¼‰

---

## âš ï¸ å…³é”®æ³¨æ„äº‹é¡¹

### 1. ç¯å¢ƒå˜é‡æ–‡ä»¶ç®¡ç†

> **ğŸ”´ é‡è¦ï¼šç”Ÿäº§ç¯å¢ƒä¸è¦æœ‰ `.env` æ–‡ä»¶ï¼**

- **æœ¬åœ°å¼€å‘**ï¼šä½¿ç”¨ `.env.local`
- **ç”Ÿäº§ç¯å¢ƒ**ï¼šåªç”¨ `.env.production`

**åŸå› **ï¼šPrisma ä¼˜å…ˆè¯»å– `.env`ï¼Œå¦‚æœå­˜åœ¨ä¼šå¿½ç•¥ `.env.production`ï¼Œå¯¼è‡´æ•°æ®åº“æ“ä½œé”™è¯¯ã€‚

```bash
# æœåŠ¡å™¨ä¸Šæ£€æŸ¥
cd /www/wwwroot/my-next-app
ls -la .env*       # åº”è¯¥åªæœ‰ .env.production
rm .env            # å¦‚æœå­˜åœ¨å°±åˆ é™¤
```

### 2. NextAuth URL é…ç½®

- âœ… æ­£ç¡®ï¼š`NEXTAUTH_URL="http://powder.icu"`ï¼ˆæœ«å°¾ä¸è¦åŠ æ–œæ ï¼‰
- âŒ é”™è¯¯ï¼š`NEXTAUTH_URL="http://powder.icu/"`

### 3. PM2 ç¯å¢ƒå˜é‡æ›´æ–°

ä¿®æ”¹ `.env.production` åï¼Œå¿…é¡»**å®Œå…¨é‡å¯**ï¼š

```bash
pm2 delete spring-lament-blog
pm2 start ecosystem.config.js
pm2 save
```

**ä¸è¦ç”¨** `pm2 restart`ï¼å› ä¸º restart ä¸ä¼šé‡æ–°åŠ è½½ç¯å¢ƒå˜é‡ã€‚

### 4. æ•°æ®åº“è¿ç§»æ³¨æ„

å¦‚æœä¿®æ”¹äº† Prisma schemaï¼Œæ›´æ–°æ—¶éœ€è¦ï¼š

```bash
npm run db:generate  # ç”Ÿæˆæ–°çš„ Prisma Client
npm run db:push      # æ¨é€æ•°æ®åº“å˜æ›´
npm run build        # é‡æ–°æ„å»º
pm2 restart spring-lament-blog
```

### 5. æ–‡ä»¶ä¸Šä¼ å¤§å°é™åˆ¶

å¦‚æœéœ€è¦ä¸Šä¼ å¤§æ–‡ä»¶ï¼Œè®°å¾—åœ¨ Nginx é…ç½®ä¸­è®¾ç½®ï¼š

```nginx
client_max_body_size 50M;  # æ ¹æ®éœ€æ±‚è°ƒæ•´
```

---

## ğŸ‰ å®Œæˆï¼

**è®¿é—®åœ°å€**ï¼š

- é¦–é¡µï¼šhttp://powder.icu
- åå°ï¼šhttp://powder.icu/admin
- é»˜è®¤è´¦å·ï¼š`admin` / `0919`

**ä¸‹ä¸€æ­¥å»ºè®®**ï¼š

1. âš¡ ä¿®æ”¹é»˜è®¤ç®¡ç†å‘˜å¯†ç 
2. ğŸ”’ é…ç½® SSL è¯ä¹¦ï¼ˆæ¨èä½¿ç”¨ Let's Encrypt å…è´¹è¯ä¹¦ï¼‰
3. ğŸ¤– æµ‹è¯• GitHub Actions è‡ªåŠ¨éƒ¨ç½²
4. ğŸ“ æ’°å†™ç¬¬ä¸€ç¯‡åšå®¢æ–‡ç« 
5. ğŸ¨ è‡ªå®šä¹‰åšå®¢æ ·å¼å’Œè®¾ç½®

**éœ€è¦å¸®åŠ©ï¼Ÿ**

- æŸ¥çœ‹æ—¥å¿—ï¼š`pm2 logs spring-lament-blog`
- çŠ¶æ€æ£€æŸ¥ï¼š`bash scripts/check-status.sh`
- å®æ—¶ç›‘æ§ï¼š`pm2 monit`

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [Next.js å®˜æ–¹æ–‡æ¡£](https://nextjs.org/docs)
- [Prisma å®˜æ–¹æ–‡æ¡£](https://www.prisma.io/docs)
- [PM2 å®˜æ–¹æ–‡æ¡£](https://pm2.keymetrics.io/docs)
- [å®å¡”é¢æ¿æ–‡æ¡£](https://www.bt.cn/bbs/forum-39-1.html)

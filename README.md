# ğŸŒ¸ Spring Lament Blog

> ä¸€ä¸ªåŸºäº Next.js 15 çš„ç°ä»£åŒ–å…¨æ ˆåšå®¢ç³»ç»Ÿï¼Œä¸“æ³¨äºä¼˜é›…çš„å†™ä½œä½“éªŒå’Œæµç•…çš„é˜…è¯»æ„Ÿå—ã€‚

## âœ¨ ç‰¹æ€§

### å‰å°åŠŸèƒ½

- ğŸ“ **Markdown æ¸²æŸ“** - æ”¯æŒä»£ç é«˜äº®ã€æ•°å­¦å…¬å¼ã€Mermaid å›¾è¡¨
- ğŸ“– **é˜…è¯»ä½“éªŒ** - è‡ªåŠ¨ç”Ÿæˆç›®å½•ã€é˜…è¯»è¿›åº¦æ¡ã€å“åº”å¼è®¾è®¡
- ğŸ” **å†…å®¹ç»„ç»‡** - åˆ†ç±»æµè§ˆã€æ ‡ç­¾ç­›é€‰ã€å…¨æ–‡æœç´¢
- ğŸ¨ **ç°ä»£ UI** - åŸºäº Tailwind CSS å’Œ shadcn/ui çš„ç²¾ç¾ç•Œé¢

### åå°ç®¡ç†

- âœï¸ **å¼ºå¤§ç¼–è¾‘å™¨** - Monaco Editorï¼Œå®æ—¶é¢„è§ˆï¼Œæ”¯æŒå›¾ç‰‡ä¸Šä¼ 
- ğŸ“Š **å†…å®¹ç®¡ç†** - æ–‡ç«  CRUDã€è‰ç¨¿/å‘å¸ƒçŠ¶æ€ã€æ‰¹é‡æ“ä½œ
- ğŸ·ï¸ **åˆ†ç±»æ ‡ç­¾** - çµæ´»çš„åˆ†ç±»å’Œæ ‡ç­¾ç³»ç»Ÿï¼Œæ”¯æŒé¢œè‰²å’Œå›¾æ ‡
- ğŸ“ˆ **æ•°æ®ç»Ÿè®¡** - æ–‡ç« æ•°é‡ã€åˆ†ç±»ç»Ÿè®¡ã€æ ‡ç­¾ç»Ÿè®¡

### æŠ€æœ¯äº®ç‚¹

- âš¡ **æ€§èƒ½ä¼˜åŒ–** - SSG + ISRï¼Œå¿«é€Ÿé¡µé¢åŠ è½½
- ğŸ” **å®‰å…¨è®¤è¯** - NextAuth.js v4ï¼ŒJWT session
- ğŸ’¾ **çµæ´»æ•°æ®åº“** - SQLiteï¼ˆå¼€å‘/ç”Ÿäº§å‡å¯ï¼‰ï¼Œæ”¯æŒ PostgreSQL/MySQL
- ğŸš€ **è‡ªåŠ¨éƒ¨ç½²** - GitHub Actions CI/CDï¼Œä¸€é”®éƒ¨ç½²

## ğŸ› ï¸ æŠ€æœ¯æ ˆ

### æ ¸å¿ƒæ¡†æ¶

- **[Next.js 15](https://nextjs.org/)** - React å…¨æ ˆæ¡†æ¶ï¼ˆApp Routerï¼‰
- **[TypeScript](https://www.typescriptlang.org/)** - ç±»å‹å®‰å…¨
- **[Prisma](https://www.prisma.io/)** - ç°ä»£ ORM

### UI & æ ·å¼

- **[Tailwind CSS](https://tailwindcss.com/)** - åŸå­åŒ– CSS æ¡†æ¶
- **[shadcn/ui](https://ui.shadcn.com/)** - é«˜è´¨é‡ React ç»„ä»¶åº“
- **[Lucide Icons](https://lucide.dev/)** - ç°ä»£å›¾æ ‡åº“

### è®¤è¯ & æ•°æ®åº“

- **[NextAuth.js](https://next-auth.js.org/)** - è®¤è¯è§£å†³æ–¹æ¡ˆ
- **[SQLite](https://www.sqlite.org/)** - è½»é‡çº§æ•°æ®åº“ï¼ˆé»˜è®¤ï¼‰
- **[bcryptjs](https://github.com/dcodeIO/bcrypt.js)** - å¯†ç åŠ å¯†

### å¼€å‘å·¥å…·

- **[ESLint](https://eslint.org/)** - ä»£ç è§„èŒƒ
- **[Prettier](https://prettier.io/)** - ä»£ç æ ¼å¼åŒ–
- **[Husky](https://typicode.github.io/husky/)** - Git hooks
- **[lint-staged](https://github.com/okonet/lint-staged)** - æš‚å­˜åŒºæ–‡ä»¶æ£€æŸ¥

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

- Node.js >= 18.17.0
- npm >= 9.0.0

### æœ¬åœ°å¼€å‘

1. **å…‹éš†é¡¹ç›®**

   ```bash
   git clone https://github.com/flawlessv/Spring-Lament-Blog.git
   cd Spring-Lament-Blog
   ```

2. **å®‰è£…ä¾èµ–**

   ```bash
   npm install
   ```

3. **é…ç½®ç¯å¢ƒå˜é‡**

   åˆ›å»º `.env.local` æ–‡ä»¶ï¼ˆå¼€å‘ç¯å¢ƒï¼‰ï¼š

   ```env
   # æ•°æ®åº“é…ç½®ï¼ˆSQLiteï¼‰
   DATABASE_URL="file:./dev.db"

   # NextAuth é…ç½®
   NEXTAUTH_SECRET="your-secret-key-min-32-characters"
   NEXTAUTH_URL="http://localhost:7777"

   # ç®¡ç†å‘˜è´¦å·ï¼ˆç”¨äºæ•°æ®åº“ç§å­ï¼‰
   ADMIN_USERNAME="admin"
   ADMIN_PASSWORD="0919"
   ```

4. **åˆå§‹åŒ–æ•°æ®åº“**

   ```bash
   # æ¨é€æ•°æ®åº“ schema
   npm run db:push

   # å¡«å……åˆå§‹æ•°æ®ï¼ˆç®¡ç†å‘˜è´¦å· + ç¤ºä¾‹å†…å®¹ï¼‰
   npm run db:seed
   ```

5. **å¯åŠ¨å¼€å‘æœåŠ¡å™¨**

   ```bash
   npm run dev
   ```

6. **è®¿é—®åº”ç”¨**
   - å‰å°ï¼šhttp://localhost:7777
   - åå°ï¼šhttp://localhost:7777/admin
   - é»˜è®¤ç®¡ç†å‘˜è´¦å·ï¼š`admin` / `0919`

## ğŸ“ é¡¹ç›®ç»“æ„

```
Spring-Lament-Blog/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ app/                    # Next.js App Router
â”‚   â”‚   â”œâ”€â”€ admin/              # åå°ç®¡ç†é¡µé¢
â”‚   â”‚   â”œâ”€â”€ api/                # API è·¯ç”±
â”‚   â”‚   â”œâ”€â”€ posts/              # æ–‡ç« é¡µé¢
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”œâ”€â”€ components/             # React ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ admin/              # åå°ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ markdown/           # Markdown æ¸²æŸ“ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ ui/                 # UI ç»„ä»¶åº“ï¼ˆshadcn/uiï¼‰
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”œâ”€â”€ lib/                    # å·¥å…·å‡½æ•°
â”‚   â”‚   â”œâ”€â”€ auth.ts             # NextAuth é…ç½®
â”‚   â”‚   â”œâ”€â”€ prisma.ts           # Prisma å®¢æˆ·ç«¯
â”‚   â”‚   â””â”€â”€ utils.ts            # é€šç”¨å·¥å…·
â”‚   â””â”€â”€ types/                  # TypeScript ç±»å‹å®šä¹‰
â”œâ”€â”€ prisma/
â”‚   â”œâ”€â”€ schema.prisma           # æ•°æ®åº“æ¨¡å‹
â”‚   â”œâ”€â”€ seed.ts                 # æ•°æ®åº“ç§å­æ–‡ä»¶
â”‚   â””â”€â”€ dev.db                  # SQLite æ•°æ®åº“ï¼ˆå¼€å‘ï¼‰
â”œâ”€â”€ .github/
â”‚   â””â”€â”€ workflows/              # GitHub Actions CI/CD
â”œâ”€â”€ docs/                       # é¡¹ç›®æ–‡æ¡£
â”‚   â””â”€â”€ éƒ¨ç½²æŒ‡å—.md             # éƒ¨ç½²æ–‡æ¡£
â”œâ”€â”€ ecosystem.config.js         # PM2 é…ç½®
â”œâ”€â”€ package.json
â””â”€â”€ README.md
```

## ğŸ“¦ å¯ç”¨è„šæœ¬

```bash
# å¼€å‘
npm run dev              # å¯åŠ¨å¼€å‘æœåŠ¡å™¨ï¼ˆç«¯å£ 7777ï¼‰
npm run build            # æ„å»ºç”Ÿäº§ç‰ˆæœ¬
npm start                # å¯åŠ¨ç”Ÿäº§æœåŠ¡å™¨ï¼ˆç«¯å£ 3000ï¼‰

# æ•°æ®åº“ï¼ˆå¼€å‘ç¯å¢ƒï¼‰
npm run db:push          # æ¨é€ schema åˆ°æ•°æ®åº“
npm run db:migrate       # åˆ›å»ºæ•°æ®åº“è¿ç§»
npm run db:seed          # å¡«å……åˆå§‹æ•°æ®
npm run db:studio        # æ‰“å¼€ Prisma Studio
npm run db:generate      # ç”Ÿæˆ Prisma Client

# æ•°æ®åº“ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰
npm run db:generate:prod # ç”Ÿæˆ Prisma Clientï¼ˆè¯»å– .env.productionï¼‰
npm run db:push:prod     # æ¨é€ schemaï¼ˆè¯»å– .env.productionï¼‰
npm run db:seed:prod     # å¡«å……åˆå§‹æ•°æ®ï¼ˆè¯»å– .env.productionï¼‰
npm run deploy:setup:prod # ä¸€é”®å®Œæˆæ‰€æœ‰åˆå§‹åŒ–å’Œæ„å»º

# ä»£ç è´¨é‡
npm run lint             # è¿è¡Œ ESLint
npm run type-check       # TypeScript ç±»å‹æ£€æŸ¥
npm run format           # æ ¼å¼åŒ–ä»£ç 

# PM2ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰
npm run pm2:start        # å¯åŠ¨åº”ç”¨
npm run pm2:restart      # é‡å¯åº”ç”¨
npm run pm2:stop         # åœæ­¢åº”ç”¨
npm run pm2:delete       # åˆ é™¤åº”ç”¨
```

## ğŸš€ éƒ¨ç½²

æœ¬é¡¹ç›®æ”¯æŒå¤šç§éƒ¨ç½²æ–¹å¼ï¼š

### 1. å®å¡”é¢æ¿ + PM2 éƒ¨ç½²ï¼ˆæ¨èï¼‰

ğŸ“š **å®Œæ•´æ–‡æ¡£**ï¼š[DEPLOYMENT.md](./docs/DEPLOYMENT.md)

é€‚åˆä½¿ç”¨å®å¡”é¢æ¿ç®¡ç†æœåŠ¡å™¨çš„ç”¨æˆ·ï¼Œé›†æˆäº†è¯¦ç»†çš„æ•…éšœæ’æŸ¥æŒ‡å—ã€‚

**å¿«é€Ÿéƒ¨ç½²æ­¥éª¤ï¼š**

```bash
# 1. æœåŠ¡å™¨ä¸Šå…‹éš†é¡¹ç›®
git clone https://github.com/flawlessv/Spring-Lament-Blog.git
cd Spring-Lament-Blog

# 2. å®‰è£…ä¾èµ–
npm install

# 3. é…ç½®ç”Ÿäº§ç¯å¢ƒå˜é‡
cat > .env.production << EOF
DATABASE_URL="file:./prisma/prod.db"
NEXTAUTH_SECRET="your-production-secret-min-32-chars"
NEXTAUTH_URL="http://your-domain.com"
ADMIN_USERNAME="admin"
ADMIN_PASSWORD="your-password"
NODE_ENV="production"
EOF

# 4. åˆå§‹åŒ–æ•°æ®åº“ï¼ˆä½¿ç”¨ç”Ÿäº§ç¯å¢ƒä¸“ç”¨å‘½ä»¤ï¼‰
npm run db:generate:prod
npm run db:push:prod
npm run db:seed:prod

# 5. æ„å»ºé¡¹ç›®
npm run build

# 6. ä½¿ç”¨ PM2 å¯åŠ¨
npm run pm2:start

# 7. å¥åº·æ£€æŸ¥
bash scripts/health-check.sh
```

**å¸¸è§é—®é¢˜å¿«é€Ÿå‚è€ƒï¼š**

| é—®é¢˜                | è§£å†³æ–¹æ¡ˆ                               |
| ------------------- | -------------------------------------- |
| PM2 åº”ç”¨ errored    | æŸ¥çœ‹æ—¥å¿— `pm2 logs spring-lament-blog` |
| ç«¯å£å ç”¨            | `lsof -i :3000` æ‰¾åˆ°è¿›ç¨‹å¹¶ kill        |
| åŸŸåæ— æ³•è®¿é—®        | æ£€æŸ¥ Nginx é…ç½®å’ŒåŸŸåè§£æ              |
| å®å¡”å ç”¨ 80 ç«¯å£    | ä¿®æ”¹å®å¡”ç«¯å£ä¸º 8888                    |
| DATABASE_URL æ‰¾ä¸åˆ° | ä½¿ç”¨ `:prod` åç¼€çš„å‘½ä»¤                |

è¯¦ç»†çš„æ•…éšœæ’æŸ¥æµç¨‹å’Œè§£å†³æ–¹æ¡ˆè¯·å‚è€ƒ [DEPLOYMENT.md](./docs/DEPLOYMENT.md)

### 2. GitHub Actions è‡ªåŠ¨éƒ¨ç½²

æ¨é€åˆ° `main` åˆ†æ”¯æ—¶è‡ªåŠ¨éƒ¨ç½²åˆ°æœåŠ¡å™¨ã€‚

**é…ç½® GitHub Secretsï¼š**

åœ¨ä»“åº“çš„ `Settings` â†’ `Secrets and variables` â†’ `Actions` ä¸­æ·»åŠ ï¼š

| Secret åç§°       | è¯´æ˜          | ç¤ºä¾‹                     |
| ----------------- | ------------- | ------------------------ |
| `SERVER_HOST`     | æœåŠ¡å™¨ IP     | `42.193.227.185`         |
| `SERVER_USER`     | SSH ç”¨æˆ·å    | `root`                   |
| `SERVER_SSH_KEY`  | SSH ç§é’¥      | å®Œæ•´çš„ç§é’¥å†…å®¹           |
| `SERVER_PORT`     | SSH ç«¯å£      | `22`                     |
| `DATABASE_URL`    | æ•°æ®åº“åœ°å€    | `file:./prod.db`         |
| `NEXTAUTH_SECRET` | NextAuth å¯†é’¥ | 32+ å­—ç¬¦éšæœºå­—ç¬¦ä¸²       |
| `NEXTAUTH_URL`    | ç½‘ç«™åœ°å€      | `http://your-domain.com` |

### 3. Docker éƒ¨ç½²ï¼ˆå³å°†æ”¯æŒï¼‰

```bash
# å³å°†æ¨å‡º
docker-compose up -d
```

## ğŸ”§ é…ç½®è¯´æ˜

### ç¯å¢ƒå˜é‡

| å˜é‡å            | å¿…å¡« | é»˜è®¤å€¼        | è¯´æ˜                          |
| ----------------- | ---- | ------------- | ----------------------------- |
| `DATABASE_URL`    | âœ…   | -             | æ•°æ®åº“è¿æ¥åœ°å€                |
| `NEXTAUTH_SECRET` | âœ…   | -             | NextAuth åŠ å¯†å¯†é’¥ï¼ˆ32+ å­—ç¬¦ï¼‰ |
| `NEXTAUTH_URL`    | âœ…   | -             | ç½‘ç«™å®Œæ•´åœ°å€                  |
| `ADMIN_USERNAME`  | âŒ   | `admin`       | é»˜è®¤ç®¡ç†å‘˜ç”¨æˆ·å              |
| `ADMIN_PASSWORD`  | âŒ   | `0919`        | é»˜è®¤ç®¡ç†å‘˜å¯†ç                 |
| `NODE_ENV`        | âŒ   | `development` | è¿è¡Œç¯å¢ƒ                      |
| `PORT`            | âŒ   | `3000`        | ç”Ÿäº§ç«¯å£                      |

### æ•°æ®åº“é…ç½®

**SQLiteï¼ˆé»˜è®¤ï¼Œæ¨èç”¨äºä¸­å°å‹åšå®¢ï¼‰ï¼š**

```env
DATABASE_URL="file:./prod.db"
```

**PostgreSQLï¼š**

```env
DATABASE_URL="postgresql://user:password@localhost:5432/database"
```

**MySQLï¼š**

```env
DATABASE_URL="mysql://user:password@localhost:3306/database"
```

ä¿®æ”¹ `prisma/schema.prisma` ä¸­çš„ `provider` ä¸ºå¯¹åº”æ•°æ®åº“ç±»å‹ã€‚

## ğŸ“ æ•°æ®åº“æ¨¡å‹

### ä¸»è¦æ¨¡å‹

- **User** - ç”¨æˆ·ï¼ˆç®¡ç†å‘˜ï¼‰
- **Profile** - ä¸ªäººèµ„æ–™
- **Post** - æ–‡ç« 
- **Category** - åˆ†ç±»
- **Tag** - æ ‡ç­¾
- **PostTag** - æ–‡ç« æ ‡ç­¾å…³è”

### é»˜è®¤åˆ†ç±»

- ğŸ¨ å‰ç«¯æŠ€æœ¯ï¼ˆfrontendï¼‰
- ğŸ¤– äººå·¥æ™ºèƒ½ï¼ˆaiï¼‰
- ğŸ“Š ç®—æ³•æ•°æ®ç»“æ„ï¼ˆalgorithmï¼‰
- ğŸŒˆ ç”Ÿæ´»éšç¬”ï¼ˆhappyLifeï¼‰

## ğŸ› å¸¸è§é—®é¢˜

<details>
<summary><strong>Q: å¦‚ä½•ä¿®æ”¹ç®¡ç†å‘˜å¯†ç ï¼Ÿ</strong></summary>

**æ–¹æ³• 1ï¼šä½¿ç”¨åå°ä¿®æ”¹**

1. ç™»å½•åå° `/admin/profile`
2. åœ¨ä¸ªäººèµ„æ–™é¡µé¢ä¿®æ”¹å¯†ç 

**æ–¹æ³• 2ï¼šç›´æ¥ä¿®æ”¹æ•°æ®åº“**

```bash
# åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œ
node -e "const bcrypt = require('bcryptjs'); console.log(bcrypt.hashSync('new-password', 12));"
# å¤åˆ¶è¾“å‡ºçš„å“ˆå¸Œå€¼ï¼Œæ›´æ–°æ•°æ®åº“
```

</details>

<details>
<summary><strong>Q: ç™»å½•æ—¶æŠ¥ CredentialsSignin é”™è¯¯ï¼Ÿ</strong></summary>

å¯èƒ½åŸå› ï¼š

1. ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯
2. `NEXTAUTH_SECRET` é…ç½®ä¸æ­£ç¡®
3. `NEXTAUTH_URL` é…ç½®ä¸æ­£ç¡®ï¼ˆæ³¨æ„ä¸è¦æœ‰å°¾éƒ¨æ–œæ ï¼‰
4. æ•°æ®åº“è¿æ¥å¤±è´¥

**è§£å†³æ–¹æ³•ï¼š**

- æ£€æŸ¥ `.env.production` é…ç½®
- ç¡®ä¿ PM2 é‡å¯æ—¶ä½¿ç”¨ `--update-env` æ›´æ–°ç¯å¢ƒå˜é‡
- æŸ¥çœ‹åº”ç”¨æ—¥å¿—ï¼š`pm2 logs spring-lament-blog`
</details>

<details>
<summary><strong>Q: å¦‚ä½•åˆ‡æ¢æ•°æ®åº“ç±»å‹ï¼Ÿ</strong></summary>

1. ä¿®æ”¹ `prisma/schema.prisma`ï¼š

   ```prisma
   datasource db {
     provider = "postgresql"  // æˆ– "mysql"
     url      = env("DATABASE_URL")
   }
   ```

2. æ›´æ–° `DATABASE_URL`
3. é‡æ–°æ¨é€ schemaï¼š`npm run db:push`
4. é‡æ–°å¡«å……æ•°æ®ï¼š`npm run db:seed`
</details>

<details>
<summary><strong>Q: npm install å¤ªæ…¢æ€ä¹ˆåŠï¼Ÿ</strong></summary>

ä½¿ç”¨æ·˜å®é•œåƒï¼ˆé¡¹ç›®å·²é…ç½® `.npmrc`ï¼‰ï¼š

```bash
npm config get registry
# åº”è¯¥æ˜¾ç¤ºï¼šhttps://registry.npmmirror.com
```

å¦‚æœä¸æ˜¯ï¼Œæ‰‹åŠ¨è®¾ç½®ï¼š

```bash
npm config set registry https://registry.npmmirror.com
```

</details>

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼

### å¼€å‘æµç¨‹

1. Fork æœ¬ä»“åº“
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯ï¼š`git checkout -b feature/your-feature`
3. æäº¤æ›´æ”¹ï¼š`git commit -m 'Add some feature'`
4. æ¨é€åˆ†æ”¯ï¼š`git push origin feature/your-feature`
5. æäº¤ Pull Request

### ä»£ç è§„èŒƒ

- ä½¿ç”¨ TypeScript
- éµå¾ª ESLint è§„åˆ™
- æäº¤å‰ä¼šè‡ªåŠ¨è¿è¡Œ Prettier å’Œ ESLint
- æäº¤ä¿¡æ¯éµå¾ª [Conventional Commits](https://www.conventionalcommits.org/)

## ğŸ“„ è®¸å¯è¯

MIT License Â© 2024 [flawlessv](https://github.com/flawlessv)

---

<div align="center">
  <p>å¦‚æœè¿™ä¸ªé¡¹ç›®å¯¹ä½ æœ‰å¸®åŠ©ï¼Œæ¬¢è¿ â­ Star æ”¯æŒä¸€ä¸‹ï¼</p>
  <p>Made with â¤ï¸ by <a href="https://github.com/flawlessv">flawlessv</a></p>
</div>
